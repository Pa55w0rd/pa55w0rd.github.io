
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

  

  <title>HTTPS 安全最佳实践（转发） | Pa55w0rd &#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文：https:&#x2F;&#x2F;blog.myssl.com&#x2F;ssl-and-tls-deployment-best-practices&#x2F;  0x00 前言SSL&#x2F;TLS 是一种简单易懂的技术，它很容易部署及运行。但想要部署的安全通常是不容易的。这也使系统管理员和开发者不得不去了解 SSL 和 TLS 相关的技术，掌握如何配置一个安全的 web 服务器或应用。无疑会耗费很大的精力去看相关的技术文档，乏味且">
<meta property="og:type" content="article">
<meta property="og:title" content="HTTPS 安全最佳实践（转发）">
<meta property="og:url" content="http://www.pa55w0rd.online/2018/12/12/https-sec-deploy/index.html">
<meta property="og:site_name" content="Pa55w0rd &#39;s Blog">
<meta property="og:description" content="原文：https:&#x2F;&#x2F;blog.myssl.com&#x2F;ssl-and-tls-deployment-best-practices&#x2F;  0x00 前言SSL&#x2F;TLS 是一种简单易懂的技术，它很容易部署及运行。但想要部署的安全通常是不容易的。这也使系统管理员和开发者不得不去了解 SSL 和 TLS 相关的技术，掌握如何配置一个安全的 web 服务器或应用。无疑会耗费很大的精力去看相关的技术文档，乏味且">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-12-12T10:39:23.000Z">
<meta property="article:modified_time" content="2018-12-12T09:23:02.140Z">
<meta property="article:author" content="Pa55w0rd">
<meta property="article:tag" content="web安全">
<meta property="article:tag" content="HTTPS">
<meta name="twitter:card" content="summary">

  

  


  
    <meta name="baidu-site-verification" content="d4d7b60d81cad7436bcab57af5cf84c7" />
  


  
    <meta name="google-site-verification" content="google4b1aaf5aa71b9f3c.html" />
  



  
    <link rel="alternative" href="/atom.xml" title="Pa55w0rd &#39;s Blog" type="application/atom+xml">
  


  
    <link rel="icon" href="/img/favicon.ico">
  


  
<link rel="stylesheet" href="/css/style.css">

  <!-- <link href="/css/show.ua.css" rel="stylesheet" type="text/css" > -->
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script><![endif]-->
  <!-- <link href="/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" /> -->

  <link href="/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

  <script src="/js/ua-parser.min.js" type="text/javascript"></script>
  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/scrollReveal.js" type="text/javascript"></script>
  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia-search.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
  
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-126660308-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->







  
  
  <!-- 
  
  
  
  
  
   -->


  <script>
   var CONFIG = {
    root: '/',
    algolia: {
          applicationID: "W1CAX1W2FZ",
          apiKey: "0a71809a146dcea950631aea9ef44f9c",
          adminApiKey: "432573b0a0ab3afd374bd04484251a9b",
          indexName: "Blog",
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
        }
  };
  </script>
<!--
<script>
    (function(){
      if('{{ page.password }}'){
        if (prompt('请输入文章密码') !== '{{ page.password }}'){
          alert('密码错误！');
          history.back();
        }
      }
    })();
  </script>
-->
<meta name="generator" content="Hexo 5.4.0"></head>



<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div data-scroll-reveal="enter top"  id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pa55w0rd &#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
        
          <a class="main-nav-link" href="/comments"><i class="fa fa-comments" aria-hidden="true"></i>留言</a>
        
          <a class="main-nav-link" href="/404.html"><i class="fa fa-heart" aria-hidden="true"></i>公益404</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a  class="nav-icon" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss" aria-hidden="true"></i></a>
        
        <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>
      </nav>
        <div id="local-search-input"></div>
      <!-- 百度搜索 -->
     <!-- <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.pa55w0rd.online">
        </form>
      </div>
      -->
   
    </div>
  </div>
</header>

    <div class="outer">
      <section id="main"><article   id="post-https-sec-deploy" class="article article-type-post" itemscope itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s"  class="article-meta">
    <a  href="/2018/12/12/https-sec-deploy/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time  datetime="2018-12-12T10:39:23.000Z" itemprop="datePublished">2018-12-12</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%AE%89%E5%85%A8/">web安全</a>
  </div>


  </div>
  <div class="article-inner"  >
    
    

      <header class="article-header">

        
  
    <h1 class="article-title" itemprop="name">
      <i class="fa fa-pencil-square-o  article-title-icon"></i>HTTPS 安全最佳实践（转发）
    </h1>
  



      </header>
    
    <!-- 目录内容 -->

  <p class="show-toc-btn" id="show-toc-btn" onclick="showToc();" style="display:none">
        <span class="btn-bg"></span>
        <span class="btn-text">文章导航</span>
        </p>
<div id="toc-article" class="toc-article">
    <span id="toc-close" class="toc-close" title="隐藏导航" onclick="showBtn();">×</span>
  <strong class="toc-title">文章目录</strong>
         <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-SSL-TLS%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">0x01 SSL&#x2F;TLS部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AF%81%E4%B9%A6%E5%92%8C%E7%A7%81%E9%92%A5"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 证书和私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E4%BD%BF%E7%94%A8-2048-%E4%BD%8D%E7%A7%81%E9%92%A5"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1.1 使用 2048 位私钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E4%BF%9D%E6%8A%A4%E4%BD%A0%E7%9A%84%E7%A7%81%E9%92%A5"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.1.2 保护你的私钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E8%A6%86%E7%9B%96%E6%82%A8%E7%9A%84%E5%9F%9F%E5%90%8D"><span class="toc-number">2.1.3.</span> <span class="toc-text">1.1.3 覆盖您的域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-%E4%BB%8E%E5%8F%AF%E4%BF%A1-CA-%E8%8E%B7%E5%8F%96%E8%AF%81%E4%B9%A6"><span class="toc-number">2.1.4.</span> <span class="toc-text">1.1.4 从可信 CA 获取证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-5-%E4%BD%BF%E7%94%A8%E5%BC%BA%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95"><span class="toc-number">2.1.5.</span> <span class="toc-text">1.1.5 使用强签名算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%95%B4%E7%9A%84%E8%AF%81%E4%B9%A6%E9%93%BE"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.2.1 使用完整的证书链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.2.2 使用安全的协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E4%BD%BF%E7%94%A8%E5%AE%89%E5%85%A8%E7%9A%84%E5%A5%97%E4%BB%B6"><span class="toc-number">2.2.3.</span> <span class="toc-text">1.2.3 使用安全的套件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.2.4.</span> <span class="toc-text">1.2.4 选择合适的协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-%E4%BD%BF%E7%94%A8-FS"><span class="toc-number">2.2.5.</span> <span class="toc-text">1.2.5 使用 FS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-%E4%BD%BF%E7%94%A8%E5%BC%BA%E7%9A%84%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E7%AE%97%E6%B3%95"><span class="toc-number">2.2.6.</span> <span class="toc-text">1.2.6 使用强的密钥交换算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%87%8F%E8%BD%BB%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 减轻已知问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E6%80%A7%E8%83%BD"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 性能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-%E9%81%BF%E5%85%8D%E8%BF%87%E5%BA%A6%E5%AE%89%E5%85%A8"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.4.1 避免过度安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-%E4%BD%BF%E7%94%A8-session-%E6%81%A2%E5%A4%8D"><span class="toc-number">2.4.2.</span> <span class="toc-text">1.4.2 使用 session 恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-%E4%BD%BF%E7%94%A8-WAN-%E4%BC%98%E5%8C%96%E5%92%8C-HTTP-2"><span class="toc-number">2.4.3.</span> <span class="toc-text">1.4.3 使用 WAN 优化和 HTTP&#x2F;2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-4-%E9%9A%90%E8%97%8F%E5%85%AC%E5%85%B1%E5%86%85%E5%AE%B9"><span class="toc-number">2.4.4.</span> <span class="toc-text">1.4.4 隐藏公共内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-5-%E4%BD%BF%E7%94%A8-OCSP-Stapling"><span class="toc-number">2.4.5.</span> <span class="toc-text">1.4.5 使用 OCSP Stapling</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-6-%E4%BD%BF%E7%94%A8%E5%BF%AB%E9%80%9F%E5%8A%A0%E5%AF%86"><span class="toc-number">2.4.6.</span> <span class="toc-text">1.4.6 使用快速加密</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-HTTP-%E5%92%8C-%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 HTTP 和 应用安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-%E5%8A%A0%E5%AF%86%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8"><span class="toc-number">2.5.1.</span> <span class="toc-text">1.5.1 加密无处不在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-%E6%B6%88%E9%99%A4%E6%B7%B7%E5%90%88%E5%86%85%E5%AE%B9"><span class="toc-number">2.5.2.</span> <span class="toc-text">1.5.2 消除混合内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-3-%E4%BD%BF%E7%94%A8%E5%8F%AF%E4%BF%A1%E7%AC%AC%E4%B8%89%E6%96%B9"><span class="toc-number">2.5.3.</span> <span class="toc-text">1.5.3 使用可信第三方</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-4-%E5%AE%89%E5%85%A8-cookie"><span class="toc-number">2.5.4.</span> <span class="toc-text">1.5.4 安全 cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-5-%E5%AE%89%E5%85%A8-HTTP-%E5%8E%8B%E7%BC%A9"><span class="toc-number">2.5.5.</span> <span class="toc-text">1.5.5 安全 HTTP 压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-6-%E9%83%A8%E7%BD%B2-HSTS"><span class="toc-number">2.5.6.</span> <span class="toc-text">1.5.6 部署 HSTS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-7-%E9%83%A8%E7%BD%B2-CSP"><span class="toc-number">2.5.7.</span> <span class="toc-text">1.5.7 部署 CSP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-8-%E4%B8%8D%E8%A6%81%E7%BC%93%E5%AD%98%E6%95%8F%E6%84%9F%E5%86%85%E5%AE%B9"><span class="toc-number">2.5.8.</span> <span class="toc-text">1.5.8 不要缓存敏感内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-9-%E8%80%83%E8%99%91%E5%85%B6%E5%AE%83%E5%A8%81%E8%83%81"><span class="toc-number">2.5.9.</span> <span class="toc-text">1.5.9 考虑其它威胁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E9%AA%8C%E8%AF%81"><span class="toc-number">2.6.</span> <span class="toc-text">1.6 验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-1-%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98"><span class="toc-number">2.6.1.</span> <span class="toc-text">1.6.1 高级主题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-2-%E4%BD%BF%E7%94%A8-HPKP"><span class="toc-number">2.6.2.</span> <span class="toc-text">1.6.2 使用 HPKP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-2-%E4%BD%BF%E7%94%A8-DNSSEC-%E5%92%8C-DANE"><span class="toc-number">2.6.3.</span> <span class="toc-text">1.6.2 使用 DNSSEC 和 DANE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA"><span class="toc-number">3.</span> <span class="toc-text">0x02 安全加固</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%BF%9E%E6%8E%A5%E5%AE%89%E5%85%A8%E6%80%A7%E5%92%8C%E5%8A%A0%E5%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 连接安全性和加密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-SSL-TLS"><span class="toc-number">3.1.1.</span> <span class="toc-text">2.1.1 SSL&#x2F;TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-HTTP-Strict-Transport-Security-HSTS"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.1.2 HTTP Strict Transport Security (HSTS)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Public-Key-Pins"><span class="toc-number">3.1.3.</span> <span class="toc-text">2.1.3 Public Key Pins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Mixed-HTTPS-and-HTTP-Content"><span class="toc-number">3.1.4.</span> <span class="toc-text">2.1.4 Mixed HTTPS and HTTP Content</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Content-security"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 Content security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-Content-Security-Policy"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1 Content Security Policy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-Frame-Options"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2 Frame Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-XSS-Protection"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.2.3 XSS Protection</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-Cache-Control"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.2.4 Cache Control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-5-Content-Type-Options"><span class="toc-number">3.2.5.</span> <span class="toc-text">2.2.5 Content Type Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-6-Subresource-Integrity"><span class="toc-number">3.2.6.</span> <span class="toc-text">2.2.6 Subresource Integrity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-7-Iframe-Sandbox"><span class="toc-number">3.2.7.</span> <span class="toc-text">2.2.7 Iframe Sandbox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-8-Server-Clock"><span class="toc-number">3.2.8.</span> <span class="toc-text">2.2.8 Server Clock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Information-disclosure"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 Information disclosure</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-Server-Banner"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.3.1 Server Banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-Web-Framework-Information"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.3.2 Web Framework Information</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Cookies"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 Cookies</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-Cookie-Security"><span class="toc-number">3.4.1.</span> <span class="toc-text">2.4.1 Cookie Security</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8"><span class="toc-number">4.</span> <span class="toc-text">0x03 服务器软件安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%A6%82%E4%BD%95%E6%A3%80%E6%9F%A5OpenSSL%E7%89%88%E6%9C%AC"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 如何检查OpenSSL版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-nginx"><span class="toc-number">4.1.1.</span> <span class="toc-text">3.1.1 nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%BC%8F%E6%B4%9E%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 漏洞事件</span></a></li></ol></li></ol>
       </div>
 <script type="text/javascript">
function showToc(){
  var toc_article = document.getElementById("toc-article");
  var show_toc_btn = document.getElementById("show-toc-btn");
  toc_article.setAttribute("style","display:block");
  show_toc_btn.setAttribute("style","display:none");
  };
function showBtn(){
  var toc_article = document.getElementById("toc-article");
  var show_toc_btn = document.getElementById("show-toc-btn");
  toc_article.setAttribute("style","display:none");
  show_toc_btn.setAttribute("style","display:block");
  };
 </script>
    		
<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        
        
          <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://blog.myssl.com/ssl-and-tls-deployment-best-practices/">https://blog.myssl.com/ssl-and-tls-deployment-best-practices/</a></p>
</blockquote>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>SSL/TLS 是一种简单易懂的技术，它很容易部署及运行。但想要部署的安全通常是不容易的。这也使系统管理员和开发者不得不去了解 SSL 和 TLS 相关的技术，掌握如何配置一个安全的 web 服务器或应用。无疑会耗费很大的精力去看相关的技术文档，乏味且宽泛。</p>
<p>本篇文档的目的在于如何让系统管理员或开发者用尽可能少的时间部署一个安全的 web 站点或应用，即 SSL 和 TLS 部署最佳实践。</p>
<h2 id="0x01-SSL-TLS部署"><a href="#0x01-SSL-TLS部署" class="headerlink" title="0x01 SSL/TLS部署"></a>0x01 SSL/TLS部署</h2><h3 id="1-1-证书和私钥"><a href="#1-1-证书和私钥" class="headerlink" title="1.1 证书和私钥"></a>1.1 证书和私钥</h3><p>在TLS中，所有的安全性都从服务器的密码标识开始；需要一个强大的私钥来防止攻击者进行模拟攻击。同样重要的是要有一个有效的和强大的证书，这将授予私有密匙作为一个特定主机名的权利。没有这两个基本的构建块，就没有其他东西可以安全了。</p>
<h4 id="1-1-1-使用-2048-位私钥"><a href="#1-1-1-使用-2048-位私钥" class="headerlink" title="1.1.1 使用 2048 位私钥"></a>1.1.1 使用 2048 位私钥</h4><p>对于大多数的 web 站点，提供一个 2048 的 RSA key 是足够安全的。<span id="more"></span>RSA 的公钥算法是被普遍支持的，这使得这个类型的 key 作为默认是足够安全的。对于 2048 位，这些 key 提供了大约 112 位的安全性。如果您想要比这更多的安全性，请注意 RSA key 的伸缩性不太好。想要获得 128 位的安全性，你需要 3072 位 RSA key，这会很大的影响性能。ECDSA key 提供了一种提供更好安全性和更好性能的替代方法。对于 256 位，ECDSA key 提供 128 位安全性。少数古董客户端不支持 ECDSA，但现代客户端是支持的。如果您不介意管理这样一个设置的开销，那么您可以同时部署 RSA 和 ECDSA 密钥。</p>
<h4 id="1-1-2-保护你的私钥"><a href="#1-1-2-保护你的私钥" class="headerlink" title="1.1.2 保护你的私钥"></a>1.1.2 保护你的私钥</h4><p>把你的私钥视为一项重要的资产，尽可能最大的使用你的私钥，限制最小的员工的访问。建议的政策包括以下内容:</p>
<ul>
<li>在可信计算机上用足够的熵生成私有密钥。一些 CA 为您提供生成私钥的功能，请尽量不要这样做。</li>
<li>密码保护 key 最初就不要存储在备份系统中。私钥密码在生产环境中起不了什么作用，因为有知识的攻击者总是能够从进程内存中检索密钥。有硬件设备(被称为硬件安全模块，或 HSMs)，即使在服务器折衷的情况下，也可以保护私有密匙，但是它们是昂贵的，因此仅适用于具有严格安全性需求的组织。</li>
<li>妥协后，撤销旧证书并生成新密钥。</li>
<li>每年更新证书，如果您可以自动化过程，则更频繁。大多数网站都应该假定不可靠的妥协证书被撤销; 因此，具有较短使用寿命的证书在实践中更加安全。</li>
<li>除非保持相同的密钥对于公钥密钥很重要，否则每当获得新证书时，还应该生成新的私钥。</li>
</ul>
<h4 id="1-1-3-覆盖您的域名"><a href="#1-1-3-覆盖您的域名" class="headerlink" title="1.1.3 覆盖您的域名"></a>1.1.3 覆盖您的域名</h4><p>确保您的证书涵盖您希望与网站一起使用的所有名称。您的目标是避免无效的证书警告，这会混淆用户，削弱他们的信心。</p>
<p>即使您期望只使用一个域名，请记住，您无法控制用户到达该网站的方式或其他人如何链接到该网站。在大多数情况下，您应该确保该证书与 www 前缀有关（例如，它适用于 example.com 和<br><a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> ）。经验法则是，安全的 Web 服务器应该具有对配置为指向它的每个 DNS 名称有效的证书。</p>
<p>通配符证书能满足更广泛的需求，但如果准备将密钥暴露给更多的人员，特别是跨团队或部门，则避免使用它们。换句话说，访问私钥的人越少越好。还要注意，证书共享会创建一个可以被滥用的将漏洞从一个网站或服务器传输到使用相同证书的所有其他站点和服务器（即使底层私钥不同，只要证书域名匹配）的绑定。</p>
<h4 id="1-1-4-从可信-CA-获取证书"><a href="#1-1-4-从可信-CA-获取证书" class="headerlink" title="1.1.4 从可信 CA 获取证书"></a>1.1.4 从可信 CA 获取证书</h4><p>选择对其证书业务和安全性可靠和认真的认证中心（CA）。选择 CA 时，请考虑以下条件：</p>
<p><strong>安全状态</strong> 所有CA都经过定期审核，但有些则比其他 CA 更为严重。弄清哪些在这方面做的更好并不容易，但一个选择是检查他们的安全历史，更重要的是，他们如何反应妥协，如果他们从错误中学到了经验，这将更有利。</p>
<p><strong>业务重点</strong> CA 的活动构成其业务的重要组成部分，如果事情发生严重错误，其所有事情都将丢失，并且在其他地方追逐潜在的更有利可图的机会可能不会忽视其证书部门。</p>
<p><strong>提供的服务</strong> 至少，您选择的 CA 应提供对证书吊销列表（CRL）和在线证书状态协议（OCSP）撤销方法的支持，具有稳定的网络可用性和性能。许多网站对域验证的证书感到满意，但您也应该考虑是否需要扩展验证（EV）证书。在任一种情况下，您都应该选择公钥算法。大多数网站今天使用 RSA，但由于其性能优势，ECDSA 在未来可能会变得重要。</p>
<p><strong>证书管理</strong> 选项如果您需要大量证书并在复杂环境中运行，请选择一个 CA，为您提供良好的管理工具。</p>
<p>支持选择一个 CA，如果需要的话可以给您很好的支持。</p>
<blockquote>
<p>   注意<br/><br>   为了获得最佳效果，请提前获得证书，并在部署到生产之前至少一周。这种做法<br/>（1）有助于避免在计算机上没有正确时间的一些用户的证书警告;<br/>（2）有助于避免与 CA 需要额外时间的 CA 失败的撤销检查，以向 OCSP 响应者传播有效的新证书。<br/>随着时间的推移，尝试将这个“热身”期延长至 1-3 个月。同样，不要等到你的证书即将到期以替换它们。留下额外的几个月也会帮助时钟不正确的人在另一个方向。</p>
</blockquote>
<h4 id="1-1-5-使用强签名算法"><a href="#1-1-5-使用强签名算法" class="headerlink" title="1.1.5 使用强签名算法"></a>1.1.5 使用强签名算法</h4><p>证书安全性取决于</p>
<ol>
<li>用于签署证书的私钥的强度，</li>
<li>签名中使用的散列函数的强度。</li>
</ol>
<p>直到最近，大多数证书都依赖于 SHA1 散列函数，现在被认为是不安全的。因此，我们正在向 SHA256 转型。截至 2016 年 1 月，您无法从公共 CA 获取 SHA1 证书。现有的 SHA1 证书将继续工作（在某些浏览器中有警告），但只能到 2016 年底。</p>
<h3 id="1-2-配置"><a href="#1-2-配置" class="headerlink" title="1.2 配置"></a>1.2 配置</h3><p>使用正确的 TLS 服务器配置，您可以确保将凭据正确呈现给站点的访问者，仅使用安全的加密原语，并减轻所有已知的缺陷。</p>
<h4 id="1-2-1-使用完整的证书链"><a href="#1-2-1-使用完整的证书链" class="headerlink" title="1.2.1 使用完整的证书链"></a>1.2.1 使用完整的证书链</h4><p>在大多数部署中，仅服务器证书不够的; 需要两个或多个证书来建立完整的信任链。当部署具有有效证书但没有所有必要的中间证书的服务器时，会发生常见的配置问题。为避免这种情况，只需使用 CA 提供给您的所有证书。</p>
<p>无效的证书链有效地使服务器证书无效并导致浏览器警告。实际上，这个问题有时难以诊断，因为一些浏览器可以重构不完整的链，有些浏览器不能重建。所有浏览器都倾向于缓存和重用中间证书。</p>
<h4 id="1-2-2-使用安全的协议"><a href="#1-2-2-使用安全的协议" class="headerlink" title="1.2.2 使用安全的协议"></a>1.2.2 使用安全的协议</h4><p>SSL／TLS 系列中有五种协议：SSL v2，SSL v3，TLS v1.0，TLS v1.1和TLS v1.2：</p>
<ul>
<li>SSL v2 是不安全的，不能使用。此协议版本非常糟糕，即使它们位于完全不同的服务器（DROWN 攻击）上也可以用来攻击具有相同名称的RSA 密钥和站点。</li>
<li>当与 HTTP（POODLE 攻击）一起使用时，SSL v3 是不安全的，当与其他协议一起使用时，SSL v3 是弱的。它也是过时的，不应该被使用。</li>
<li>TLS v1.0 也是不应该使用的传统协议，但在实践中通常仍然是必需的。其主要弱点（BEAST）在现代浏览器中得到缓解，但其他问题仍然存在。</li>
<li>TLS v1.1 和 v1.2 都没有已知的安全问题，只有 v1.2 提供了现代的加密算法。</li>
</ul>
<p>TLS v1.2 应该是您的主要协议，因为它是唯一提供现代认证加密（也称为 AEAD）的版本。如果您今天不支持 TLS v1.2，则缺乏安全性。</p>
<p>为了支持较旧的客户端，您可能需要继续支持 TLS v1.0 和TLS v1.1。但是，您应该计划在不久的将来退出 TLS v1.0。例如，PCI DSS 标准将要求所有接受信用卡付款的网站在 2018 年 6 月之前移除对 TLS v1.0 的支持。</p>
<p>目前正在开展设计 TLS v1.3 的工作，其目的是消除所有过时和不安全的功能，并进行改进，以保持我们的通信在未来几十年内的安全。</p>
<h4 id="1-2-3-使用安全的套件"><a href="#1-2-3-使用安全的套件" class="headerlink" title="1.2.3 使用安全的套件"></a>1.2.3 使用安全的套件</h4><p>为了安全通信，您必须首先确定您正在与所需方（而不是通过将窃听的其他人）直接沟通并安全地交换数据。在 SSL 和 TLS 中，密码套件定义了如何进行安全通信。它们由不同的建筑组成，通过多样性实现安全。如果发现其中一个构建块软弱或不安全，那么您应该可以切换到另一个。</p>
<p>您应该主要依靠提供强身份验证和密钥交换，前向保密和至少 128 位加密的 AEAD 套件。还有一些其他较弱的套房可能仍然得到支持，只要它们只能与不支持任何更好的老客户进行协商。</p>
<p>有几个过时的加密原语必须避免：</p>
<ul>
<li>匿名 Diffie-Hellman（ADH）套件不提供身份验证。</li>
<li>NULL 密码套件不提供加密。</li>
<li>导出密码套件在连接中协商时不安全，但也可以针对更喜欢更强大的套件（FREAK攻击）的服务器使用。</li>
<li>弱密码（通常为 40 和 56 位）的套件使用可以轻松破坏的加密。</li>
<li>RC4 是不安全的。<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc7465.txt">rfc7465</a></li>
<li>3DES 缓慢而虚弱。</li>
</ul>
<p>使用以RSA和ECDSA键为基础的以下套件配置，作为起点：</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA384</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA384</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA256</span><br></pre></td></tr></table></figure>
<blockquote>
<p>警告<br/><br>我们建议您始终首先在分段环境中测试TLS配置，仅在确定所有内容按预期工作时将更改应用到生产环境。请注意，以上是一个通用列表，并不是所有系统（特别是较旧的）支持所有套件。这就是为什么测试很重要，推荐您使用《<a target="_blank" rel="noopener" href="https://myssl.com/">SSL/TLS安全评估</a>》进行检查。</p>
</blockquote>
<p>上述示例配置使用标准 TLS 套件名称。一些平台使用非标准名称; 有关详细信息，请参阅您的平台的文档。例如，以下套件名称将与OpenSSL 一起使用：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-SHA<span class="number">256</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-4-选择合适的协议"><a href="#1-2-4-选择合适的协议" class="headerlink" title="1.2.4 选择合适的协议"></a>1.2.4 选择合适的协议</h4><p>在SSL v3及更高版本的协议版本中，客户端提交他们支持的密码套件列表，服务器从列表中选择一个用于连接的套件。然而，并不是所有的服务器都做得很好，有些将从客户端列表中选择第一个支持的套件。使服务器主动选择最佳可用加密套件对于实现最佳安全性至关重要。</p>
<h4 id="1-2-5-使用-FS"><a href="#1-2-5-使用-FS" class="headerlink" title="1.2.5 使用 FS"></a>1.2.5 使用 FS</h4><p>前向保密（有时也称为完全前向保密）是一种协议功能，可实现不依赖服务器私钥的安全对话。对于不提前向保密的密码套件，可以恢复服务器的私钥的人就可以解密所有较早记录的加密对话（也就是可以先大量记录密文，再解密，比如您的证书到期后没有正确销毁，它的私钥就能用来解密非PFS的密文）。您需要支持并喜欢 ECDHE 套件，以便通过现代网络浏览器实现前向保密。为了支持更广泛的客户，您还应该使用 DHE 套件作为 ECDHE 后备。避免 RSA 密钥交换，除非绝对必要。我在2.3节中提出的默认配置只包含提供前向保密的套件。</p>
<h4 id="1-2-6-使用强的密钥交换算法"><a href="#1-2-6-使用强的密钥交换算法" class="headerlink" title="1.2.6 使用强的密钥交换算法"></a>1.2.6 使用强的密钥交换算法</h4><p>对于密钥交换，公共站点通常可以选择经典的短暂的 Diffie-Hellman密钥交换（DHE）和其椭圆曲线变体 ECDHE。还有其他的密钥交换算法，但是它们通常是以某种方式不安全的。RSA 密钥交换仍然很受欢迎，但不提供前向保密。</p>
<p>2015 年，一批研究人员发表了对 DHE 的新攻击; 他们的工作被称为Logjam 攻击。[2] 研究人员发现，较低强度的 DH 密钥交换（例如768 位）容易被破坏，一些知名的 1024 位 DH 组可被国家机构破坏。为了安全起见，如果部署 DHE，请至少配置 2048 位的安全性。一些较老的客户端（例如Java 6）可能不支持这种强度。出于性能原因，大多数服务器应该更喜欢 ECDHE，这是更强大和更快。在这种情况下，secp256r1命名曲线（也称为 P-256）是一个很好的选择。</p>
<h3 id="1-3-减轻已知问题"><a href="#1-3-减轻已知问题" class="headerlink" title="1.3 减轻已知问题"></a>1.3 减轻已知问题</h3><p>近几年来已经发生了几次严重的 SSL 和 TLS 攻击，但是如果您正在运行最新的软件并遵循本指南的建议，那么它们通常不会关心您。（如果没有，我建议您使用 MYSSL 测试您的系统，并从中进行测试）。但是，没有什么是完全安全的，所以为了保持对安全性的了解，这是一个很好的做法。如果供应商补丁可用，请及时提供; 否则，依靠解决方案进行缓解。</p>
<h3 id="1-4-性能"><a href="#1-4-性能" class="headerlink" title="1.4 性能"></a>1.4 性能</h3><p>安全是我们在本指南中的主要重点，但我们也要注意表现; 一个不符合性能标准的安全服务无疑将被丢弃。通过正确配置，TLS 可以相当快。使用现代协议（例如 HTTP/2），甚至可能比明文通信更快。</p>
<h4 id="1-4-1-避免过度安全"><a href="#1-4-1-避免过度安全" class="headerlink" title="1.4.1 避免过度安全"></a>1.4.1 避免过度安全</h4><p>用于建立安全连接的密码握手是一种操作，其费用受私钥大小的高度影响。使用太短的密钥是不安全的，但使用太长的密钥将导致“太多”的安全性和缓慢的操作。对于大多数网站，使用超过 2048 位的 RSA 密钥和强大于 256 位的 ECDSA 密钥会浪费 CPU 功耗，并可能会损害用户体验。类似地，增加短暂密钥交换的强度对于 DHE 为 2048 位以及 ECDHE 为 256 位几乎没有什么好处。使用高于 128 位的加密没有明显的好处。</p>
<h4 id="1-4-2-使用-session-恢复"><a href="#1-4-2-使用-session-恢复" class="headerlink" title="1.4.2 使用 session 恢复"></a>1.4.2 使用 session 恢复</h4><p>会话恢复是一种性能优化技术，可以节省昂贵的密码操作的结果，并重复使用一段时间。残疾或非功能性会话恢复机制可能会引起显着的性能损失。</p>
<h4 id="1-4-3-使用-WAN-优化和-HTTP-2"><a href="#1-4-3-使用-WAN-优化和-HTTP-2" class="headerlink" title="1.4.3 使用 WAN 优化和 HTTP/2"></a>1.4.3 使用 WAN 优化和 HTTP/2</h4><p>这些天，TLS 开销不是来自 CPU 饥饿的加密操作，而是来自网络延迟。只有在 TCP 握手完成后才能启动TLS握手，需要进一步交换数据包，并且离开服务器的距离更远。最小化延迟的最佳方法是避免创建新的连接 - 换句话说，保持现有的连接长时间（keep-alives）。提供良好结果的其他技术包括支持现代协议（如HTTP / 2）和使用WAN优化（通常通过内容传送网络）。</p>
<h4 id="1-4-4-隐藏公共内容"><a href="#1-4-4-隐藏公共内容" class="headerlink" title="1.4.4 隐藏公共内容"></a>1.4.4 隐藏公共内容</h4><p>通过TLS进行通信时，浏览器可能会认为所有流量都是敏感的。它们通常会使用内存来缓存某些资源，但一旦关闭浏览器，所有内容可能会丢失。为了获得性能提升，并能够长期缓存一些资源，将公共资源（例如图像）标记为公开。</p>
<h4 id="1-4-5-使用-OCSP-Stapling"><a href="#1-4-5-使用-OCSP-Stapling" class="headerlink" title="1.4.5 使用 OCSP Stapling"></a>1.4.5 使用 OCSP Stapling</h4><p>OCSP 装订是 OCSP 协议的扩展，可以直接从服务器提供撤销信息作为 TLS 握手的一部分。因此，客户端不需要联系 OCSP 服务器进行带外验证，并且总体 TLS 连接时间显着减少。OCSP 装订是一种重要的优化技术，但您应该注意，并不是所有的网络服务器都提供了可靠的 OCSP 装订实现。结合具有缓慢或不可靠的 OCSP 响应者的 CA，这样的 Web 服务器可能会产生性能问题。为了获得最佳效果，请模拟故障条件，看看它们是否会影响您的可用性。</p>
<h4 id="1-4-6-使用快速加密"><a href="#1-4-6-使用快速加密" class="headerlink" title="1.4.6 使用快速加密"></a>1.4.6 使用快速加密</h4><p>除了提供最佳的安全性，我推荐的密码套件配置也提供了最好的性能。尽可能使用支持硬件加速 AES 的 CPU。之后，如果您真的想要进一步的性能优势（大多数网站可能不需要），请考虑使用 ECDSA 密钥。</p>
<h3 id="1-5-HTTP-和-应用安全"><a href="#1-5-HTTP-和-应用安全" class="headerlink" title="1.5 HTTP 和 应用安全"></a>1.5 HTTP 和 应用安全</h3><p>HTTP 协议和 Web 应用交付的周边平台在 SSL 诞生后继续快速发展。作为这一进化的结果，该平台现在包含可用于打败加密的功能。在本节中，我们列出了这些功能，以及安全使用它们的方法。</p>
<h4 id="1-5-1-加密无处不在"><a href="#1-5-1-加密无处不在" class="headerlink" title="1.5.1 加密无处不在"></a>1.5.1 加密无处不在</h4><p>加密是可选的事实可能是今天最大的安全问题之一。我们看到以下问题：</p>
<ul>
<li>没有 TLS 需要它的网站</li>
<li>具有 TLS 但不执行 TLS 的站点</li>
<li>混合 TLS 和非 TLS 内容的网站，有时甚至在同一网页内</li>
<li>编程错误的网站会颠覆 TLS</li>
</ul>
<p>尽管如果您确切了解您正在做的事情，许多这些问题可以被缓解，可靠地保护网站通信的唯一方法是无一例外地执行加密。</p>
<h4 id="1-5-2-消除混合内容"><a href="#1-5-2-消除混合内容" class="headerlink" title="1.5.2 消除混合内容"></a>1.5.2 消除混合内容</h4><p>混合内容页面是通过 TLS 传输但是包含不通过 TLS 传输的资源（例如，JavaScript 文件，images，CSS 文件）的页面。这样的页面不安全。一个活跃的中间人（MITM）攻击者可以搭载一个单独的未受保护的 JavaScript 资源，例如劫持整个用户会话。即使您遵循上一节的建议并对整个网站加密，您仍然可能会最终从第三方网站中检索未加密的一些资源。</p>
<h4 id="1-5-3-使用可信第三方"><a href="#1-5-3-使用可信第三方" class="headerlink" title="1.5.3 使用可信第三方"></a>1.5.3 使用可信第三方</h4><p>网站通常使用通过从另一个服务器下载的 JavaScript 代码激活的第三方服务。这种服务的一个很好的例子是 Google Analytics（分析），用于 Web 的大部分。这种包含第三方代码创建一个隐含的信任连接，有效地使对方完全控制您的网站。第三方可能不是恶意的，但是这些服务的大型提供商越来越被视为目标。推理很简单：如果大型提供程序受到威胁，攻击者将被自动访问所有依赖该服务的站点。</p>
<p>如果您遵循第4.2节的建议，至少您的第三方链接将被加密，从而避免 MITM 攻击。但是，您应该进一步了解：了解您使用的服务和删除服务，将其替换为更安全的替代方案，或接受其继续使用的风险。一种称为子资源完整性（SRI）的新技术可用于通过第三方资源来减少潜在的风险。[3]</p>
<h4 id="1-5-4-安全-cookie"><a href="#1-5-4-安全-cookie" class="headerlink" title="1.5.4 安全 cookie"></a>1.5.4 安全 cookie</h4><p>要正确安全，网站需要 TLS，而且所有的 Cookie 在创建时都被明确标记为安全的。未能保护 cookies 可以让活跃的 MITM 攻击者通过聪明的技巧来挑逗一些信息，即使在 100％ 加密的网站上也是如此。为了获得最佳效果，请考虑为您的 Cookie 添加加密完整性验证或甚至加密。</p>
<h4 id="1-5-5-安全-HTTP-压缩"><a href="#1-5-5-安全-HTTP-压缩" class="headerlink" title="1.5.5 安全 HTTP 压缩"></a>1.5.5 安全 HTTP 压缩</h4><p>2012 年 CRIME 攻击显示 TLS 压缩无法安全实施。唯一的解决方案是完全禁用 TLS 压缩。次年，随后再发生两次攻击。TIME 和 BREACH 专注于使用 HTTP 压缩压缩的 HTTP 响应实体中的秘密。与 TLS 压缩不同，HTTP 压缩是必需的，不能关闭。因此，为了解决这些攻击，需要对应用程序代码进行更改。[4]</p>
<p>TIME 和 BREACH 攻击并不容易实现，但是如果某人有足够的动力使用它们，则这种影响大致相当于成功的跨站点请求伪造（CSRF）攻击。</p>
<h4 id="1-5-6-部署-HSTS"><a href="#1-5-6-部署-HSTS" class="headerlink" title="1.5.6 部署 HSTS"></a>1.5.6 部署 HSTS</h4><p>HTTP 严格传输安全（HSTS）是 TLS 的安全网。它旨在确保即使在配置问题和实施错误的情况下，安全性仍然保持不变。要激活 HSTS 保护，您可以向您的网站添加一个新的响应头。之后，支持 HSTS（此时所有现代浏览器）的浏览器执行它。</p>
<p>HSTS 的目标很简单：激活后，它不允许与使用它的网站进行任何不安全的通信。通过自动将所有明文链接转换为安全的链接，实现了这一目标。作为奖励，它还会禁用点击式证书警告。（证书警告是活动的 MITM 攻击的指标，研究表明大多数用户点击这些警告，所以绝对不要让他们感兴趣）。</p>
<p>添加对 HSTS 的支持是您可以为您的网站的 TLS 安全性做出的最重要的改进。新站点始终应设计为 HSTS，旧站点转换为尽可能快地支持。为了获得最佳安全性，请考虑使用 HSTS 预加载[5]，将HSTS配置嵌入到现代浏览器中，从而使您的网站的第一个连接安全。</p>
<p>以下配置示例将在主主机名及其所有子域上激活一段时间为一年的 HSTS，同时还允许预加载：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: <span class="keyword">max</span>-age<span class="operator">=</span><span class="number">31536000</span><span class="comment">; includeSubDomains; preload</span></span><br></pre></td></tr></table></figure>
<h4 id="1-5-7-部署-CSP"><a href="#1-5-7-部署-CSP" class="headerlink" title="1.5.7 部署 CSP"></a>1.5.7 部署 CSP</h4><p>内容安全策略（CSP）是网站可以用来限制浏览器操作的安全机制。尽管最初旨在解决跨站点脚本（XSS），CSP 不断发展，并支持对增强TLS安全性有用的功能。特别地，它可以用于限制混合内容，当涉及到第三方网站，HSTS没有帮助。</p>
<p>要部署CSP以防止第三方混合内容，请使用以下配置：</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> https: <span class="string">&#x27;unsafe-inline&#x27;</span> <span class="string">&#x27;unsafe-eval&#x27;</span>;</span><br><span class="line">                         <span class="keyword">connect-src</span> https: wss:</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意<br/><br>这不是部署 CSP 的最佳方法。为了提供不破坏混合内容以外的任何内容的示例，我不得不禁用某些默认安全功能。随着时间的推移，当您了解 CSP 的更多信息时，您应该更改您的策略以使其恢复。</p>
</blockquote>
<h4 id="1-5-8-不要缓存敏感内容"><a href="#1-5-8-不要缓存敏感内容" class="headerlink" title="1.5.8 不要缓存敏感内容"></a>1.5.8 不要缓存敏感内容</h4><p>所有敏感内容必须仅传达给预定方，并由所有设备进行相应处理。虽然代理没有看到加密的流量，并且不能在用户之间共享内容，但是使用基于云的应用交付平台正在增加，这就是为什么在指定什么是公共的时候需要非常小心的是什么。</p>
<h4 id="1-5-9-考虑其它威胁"><a href="#1-5-9-考虑其它威胁" class="headerlink" title="1.5.9 考虑其它威胁"></a>1.5.9 考虑其它威胁</h4><p>TLS 旨在仅解决安全机密和您与用户之间通信的完整性的一个方面，但还有许多其他威胁需要处理。在大多数情况下，这意味着确保您的网站没有其他弱点。</p>
<h3 id="1-6-验证"><a href="#1-6-验证" class="headerlink" title="1.6 验证"></a>1.6 验证</h3><p>有许多配置参数可用于调整，预先知道某些变化会产生什么影响。此外，有时会意外地进行更改; 软件升级可以静默地引入更改。因此，我们建议您最初使用全面的 SSL/TLS 评估工具来验证您的配置，以确保您开始安全，然后定期确保您保持安全。对于公共网站，我们建议您免费使用SSL实验室服务器测试。[6]</p>
<h4 id="1-6-1-高级主题"><a href="#1-6-1-高级主题" class="headerlink" title="1.6.1 高级主题"></a>1.6.1 高级主题</h4><p>以下高级主题目前不在我们的指南范围之内。他们需要更深入地了解 SSL/TLS 和公钥基础设施（PKI），而且他们仍然被专家辩论。</p>
<h4 id="1-6-2-使用-HPKP"><a href="#1-6-2-使用-HPKP" class="headerlink" title="1.6.2 使用 HPKP"></a>1.6.2 使用 HPKP</h4><p>公共密钥固定旨在使网站运营商有权限制哪些 CA 可以为其网站颁发证书。Google 已经部署了这个功能了一段时间（硬编码到他们的浏览器，Chrome），并且已被证明是非常有用的，以防止攻击并使公众了解它们。在 2014 年，Firefox 还增加了对硬编码固定的支持。现在可以使用一种称为 HTTP [7]的公钥固定扩展标准。公钥绑定解决了 PKI 最大的弱点（事实上，任何 CA 都可以为任何网站发布证书），但是这是一个成本; 部署需要大量精力和专业知识，并造成失去对您站点控制的风险（如果最终导致无效的固定配置）。你应该考虑固定很大程度上只有当你</p>
<h4 id="1-6-2-使用-DNSSEC-和-DANE"><a href="#1-6-2-使用-DNSSEC-和-DANE" class="headerlink" title="1.6.2 使用 DNSSEC 和 DANE"></a>1.6.2 使用 DNSSEC 和 DANE</h4><p>域名系统安全扩展（DNSSEC）是一种增加域名系统完整性的技术。今天，一个活跃的网络攻击者可以轻松地劫持任何 DNS 请求并伪造任意的响应。使用 DNSSEC，所有响应都可以加密地跟踪到 DNS 根目录。命名实体的基于 DNS 的身份验证（DANE）是建立在 DNSSEC 之上的单独标准，用于提供 DNS 和 TLS 之间的绑定。DANE 可用于增强现有基于 CA 的 PKI 生态系统的安全性，或者完全绕过它。</p>
<p>即使不是每个人都同意，DNSSEC 是互联网的一个很好的方向，但对其的支持仍在继续改善。浏览器还不支持 DNSSEC 或 DANE（更喜欢 HSTS 和 HPKP 提供的类似功能），但有一些迹象表明它们正在开始用于提高电子邮件传递的安全性。</p>
<h2 id="0x02-安全加固"><a href="#0x02-安全加固" class="headerlink" title="0x02 安全加固"></a>0x02 安全加固</h2><p>当你的网站上了 HTTPS 以后，可否觉得网站已经安全了？这里 提供了一个 HTTPS 是否安全的检测工具，你可以试试。</p>
<p>在线检测工具-<a target="_blank" rel="noopener" href="https://myssl.com/">https://myssl.com/</a></p>
<p>本篇正文讲述的是 HTTP 安全的最佳实践，着重在于 HTTPS 网站的 Header 的相关配置。</p>
<h3 id="2-1-连接安全性和加密"><a href="#2-1-连接安全性和加密" class="headerlink" title="2.1 连接安全性和加密"></a>2.1 连接安全性和加密</h3><h4 id="2-1-1-SSL-TLS"><a href="#2-1-1-SSL-TLS" class="headerlink" title="2.1.1 SSL/TLS"></a>2.1.1 SSL/TLS</h4><p>传输层安全（TLS）及其前身安全套接字层（SSL），通过在浏览器和 web 服务器之间提供端到端加密来促进机密通信。没有 TLS，就谈不上什么安全。TLS 是 HTTP 安全性的基础。</p>
<p>想要部署 TLS 是非常容易的，但其难点在于如何使用安全的配置来保障站点的安全。<br>尤其是 Protocol 版本和 Cipher 需要小心选择和配置。你可以通过<a target="_blank" rel="noopener" href="https://myssl.com/">https://myssl.com/</a>体检你的网站，发现并解决这些细节的问题。</p>
<blockquote>
<p>建议<br/><br>所有本地和链接的资源需要正确的配置，且要使用 TLS。</p>
</blockquote>
<h4 id="2-1-2-HTTP-Strict-Transport-Security-HSTS"><a href="#2-1-2-HTTP-Strict-Transport-Security-HSTS" class="headerlink" title="2.1.2 HTTP Strict Transport Security (HSTS)"></a>2.1.2 HTTP Strict Transport Security (HSTS)</h4><p>指示浏览器只使用 HTTPS 连接到目标服务器。这可以防止一些潜在的中间人攻击，包括 SSL 剥离，会话 cookie 窃取（如果没有被 适当保护）。如果遇到任何与证书相关的错误，它还可以阻止浏览器连接到网站。当浏览器访问一个设置相应 HTTP header 的 HTTPS 网站时，HSTS 将被激活。</p>
<p>HSTS 有一个固定期限，由 max-age 字段值控制。这个值可以是静态的，也可以是相对于将来某个特定日期的，你可以设置成 SSL 证书的过期时间。</p>
<p>在浏览器中，HSTS 首选项可以通过提交到 <a target="_blank" rel="noopener" href="https://hstspreload.appspot.com/">Chromium’s HSTS preload list</a> 来硬编码，这是所有实现 HSTS 使用的浏览器。</p>
<p>注意，HSTS 确实有陷阱。它提供了 <code>include subdomains</code> 选项，这在实践中可能是太宽泛了。此外，客户端错误可能会造成严重的后果——客户端错误的时钟导致它认为服务器的 SSL 证书无效或过期，或者缺少根 CA 证书——将不再导致浏览器中的证书错误。浏览器将完全拒绝访问页面，并且可能会显示让安全专家之外的完全无法理解的错误。</p>
<blockquote>
<p>建议<br/><br>设置 HSTS header 长的生命周期，最好是半年及以上。</p>
</blockquote>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Strict</span>-Transport-Security: <span class="built_in">max</span>-age=<span class="number">31536000</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-Public-Key-Pins"><a href="#2-1-3-Public-Key-Pins" class="headerlink" title="2.1.3 Public Key Pins"></a>2.1.3 Public Key Pins</h4><p>HTTP PKP（HPKP）指示浏览器只与提供的 SSL/TLS 的 HASH 相符或存在于同一证书链的服务器相连接。换句话说，如果 SSL/TLS 证书以一种意想不到的方式发生了变化，浏览器就无法连接到主机。这主要是针对受信任证书颁发机构（CA）或流氓 CA 证书颁发的伪造证书，用户可能会被骗安装。</p>
<p>例如，浏览器连接到 <a target="_blank" rel="noopener" href="https://example.com,它存在这个头.header/">https://example.com，它存在这个头。header</a> 告诉浏览器，如果证书 key 匹配，或者在发出证书链中有一个 key 匹配，那么在将来才会再次连接。其他的指令组合是可能的。它们都极大地减少了攻击者在客户端和合法主机之间模拟主机或拦截通信的可能性。</p>
<p>像 HSTS 一样，HPKP 在实现之前需要仔细的思考和计划。错误可以将用户锁定在您的站点之外，并且不容易修复。</p>
<p>像 HSTS 一样，HPKP 在实现之前需要仔细的思考和计划。错误可以将用户锁定在您的站点之外，并且不容易修复。</p>
<blockquote>
<p>建议<br/><br>确定是否需要为您的站点使用 PKP。如果是这样的话，那么从一个较小的实践开始，如果在一段时间之后没有遇到问题，就增加它。如果 SSL/TLS 密钥需要更新，建立备份计划。优先创建备份密钥和离线存储。</p>
</blockquote>
<p>示例HTTP头:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Public-Key-Pins: <span class="attribute">max-age</span>=5184000; <span class="attribute">pin-sha256</span>=<span class="string">&quot;+oZq/vo3Kcv0CQPjpdwyInqVXmLiobmUJ3FaDpD/U6c=&quot;</span>; <span class="attribute">pin-sha256</span>=<span class="string">&quot;47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-4-Mixed-HTTPS-and-HTTP-Content"><a href="#2-1-4-Mixed-HTTPS-and-HTTP-Content" class="headerlink" title="2.1.4 Mixed HTTPS and HTTP Content"></a>2.1.4 Mixed HTTPS and HTTP Content</h4><p>主站点通过 HTTPS 安全地服务，但是在 HTTP 上加载一些文件（images、js、css）。这是一个巨大的安全漏洞，破坏了 HTTPS 提供的安全性。受影响的站点可能会泄漏会话 cookie 或用户行为信息。它们也可能容易受到注入和其他 MITM 攻击的攻击，而 HTTPS 通常会阻止这种攻击。</p>
<blockquote>
<p>建议<br><br>如果 HTTPS 部署在主站上，请将任何地方的所有内容都 HTTPS 化（全站 HTTPS）。</p>
</blockquote>
<h3 id="2-2-Content-security"><a href="#2-2-Content-security" class="headerlink" title="2.2 Content security"></a>2.2 Content security</h3><h4 id="2-2-1-Content-Security-Policy"><a href="#2-2-1-Content-Security-Policy" class="headerlink" title="2.2.1 Content Security Policy"></a>2.2.1 Content Security Policy</h4><p>为浏览器提供关于网站内容类型和行为的明确说明。良好的内容安全策略（CSP）可以帮助抵御跨站点脚本（XSS）和其他注入攻击等攻击。CSP 支持所有主要的浏览器，尽管只是部分地之前在 IE 11。</p>
<p>一个好的 CSP 是基于白名单的方法，不允许任何东西，除了明确允许的内容。它还限制了 javascript 的来源和允许操作。</p>
<p>CSP 很难启用遗留代码库。为了简化实现，CSP 提供了一个 <code>report-only</code> 模式，在浏览器中，CSP 的违规被发送到一个网站端点，但是该策略没有被强制执行。<br>新项目应该从一开始就使用 CSP。</p>
<blockquote>
<p>建议<br><br>从限制性政策开始，在必要时放松。禁止所有的例子:</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;none&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>现在让我们允许自托管 scripts、images、CSS、fonts 和 AJAX，以及 jQuery CDN 托管脚本和 Google Analytics:</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> <span class="string">&#x27;none&#x27;</span>; <span class="keyword">script-src</span> <span class="string">&#x27;self&#x27;</span> https://code.jquery.com https://www.google-analytics.com; <span class="keyword">img-src</span> <span class="string">&#x27;self&#x27;</span> https://www.google-analytics.com; <span class="keyword">connect-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">font-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">style-src</span> <span class="string">&#x27;self&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>要注意的是，不要让所有的东西都破坏你的网站，例如，如果你使用 <code>child-src</code> 指令，而浏览器不支持它。一个不那么严格的政策可能从以下开始:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>甚至更少的限制性政策甚至可以使用<code> default-src &#39;*&#39;</code>，然后添加限制。我建议你不要这么做，除非你完全明白其中的含义。否则，你可能会依赖 CSP，它只会给你一种错误的安全感。</p>
<h4 id="2-2-2-Frame-Options"><a href="#2-2-2-Frame-Options" class="headerlink" title="2.2.2 Frame Options"></a>2.2.2 Frame Options</h4><p>控制站点是否可以放置在 <code>&lt;iframe&gt;</code>，<code>&lt;frame&gt;</code> 或 <code>&lt;object&gt;</code> 标签。不允许使用框架可以防止 clickjacking 攻击。例如，从 2015 年 2 月起，<a target="_blank" rel="noopener" href="https://thehackernews.com/2015/02/internet-explorer-xss.html">Internet Explorer’s universal cross-site-scripting bug</a> 就被这个消息头减轻了。</p>
<p><code>X-Frame-Options</code> 是一个非标准的 header，在内容安全策略级别 2 中被 frame ancestor 指令所取代。然而，frame ancestor 还没有得到普遍的支持，而 <code>X-Frame-Options</code> 得到了广泛的支持。</p>
<blockquote>
<p>建议<br><br>确定你的网站是否需要被允许呈现在一个 frame 中。完全不允许使用 sameorigin 拒绝或允许同源框架的选项。避免由于受限或 bug 浏览器支持而允许的选项。示例 HTTP 头:</p>
</blockquote>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">X</span><span class="operator">-</span><span class="built_in">Frame</span><span class="operator">-</span><span class="built_in">Options</span><span class="operator">:</span> <span class="variable">deny</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-XSS-Protection"><a href="#2-2-3-XSS-Protection" class="headerlink" title="2.2.3 XSS Protection"></a>2.2.3 XSS Protection</h4><p>跨站点脚本（XSS 或 CSS）的保护被构建到大多数流行的浏览器中，除了 Firefox 之外。这种保护是用户可配置的，可以关闭。因此，明确要求浏览器在你的网站上使用它的 XSS 过滤器是个好主意。</p>
<p>相反，网站可以要求 XSS 保护在页面的基础上被禁用。这绝对不是一个好主意。</p>
<blockquote>
<p>建议<br><br>使用入校 HTTP header:</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Xss-Protection: <span class="number">1</span>; block</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-Cache-Control"><a href="#2-2-4-Cache-Control" class="headerlink" title="2.2.4 Cache Control"></a>2.2.4 Cache Control</h4><p>表示缓存页面输出的首选项。适当的值随网站数据的性质而变化，但强烈推荐使用偏好。否则，它取决于浏览器和代理来选择是否缓存内容。不恰当的选择可能会导致性能问题、安全问题，或者两者都有。</p>
<blockquote>
<p>建议<br><br>开发缓存策略，然后将缓存首选项包括为 HTTP 头。</p>
</blockquote>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Cache</span><span class="params">-Control</span>: <span class="keyword">public</span>*</span><br></pre></td></tr></table></figure>
<p>其中的一个 public，private，no-cache 或 no-store。如果允许缓存，则应该将 max-age 值包含在 Cache-Control 以及 Etag 头文件中，以允许客户端缓存验证。</p>
<h4 id="2-2-5-Content-Type-Options"><a href="#2-2-5-Content-Type-Options" class="headerlink" title="2.2.5 Content Type Options"></a>2.2.5 Content Type Options</h4><p>当浏览器以不同的方式处理来自服务器的文件时，MIME 嗅探就是服务器指令。当一个网站承载不受信任的内容（如用户提供的）时，这是很危险的。假设服务器允许用户上传 image。如果用户上传 HTML 文档，浏览器可能会将其呈现为 web 执行 scriptpage，即使服务器明确表示正在发送 image。非标准的标头 <code>X-Content-Type-Options</code> 选项指示浏览器不做任何模仿指定类型的 MIME。</p>
<blockquote>
<p>建议<br><br>总是设置 header:</p>
</blockquote>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Content-<span class="keyword">Type</span>-<span class="keyword">Options</span>: nosniff</span><br></pre></td></tr></table></figure>
<h4 id="2-2-6-Subresource-Integrity"><a href="#2-2-6-Subresource-Integrity" class="headerlink" title="2.2.6 Subresource Integrity"></a>2.2.6 Subresource Integrity</h4><p>浏览器通常从外部域加载大量资源、javascript 和样式表。内容交付网络经常被使用。如果外部资源被破坏，依赖站点的安全性也可以。子资源完整性允许浏览器验证 javascript 或样式表未被意外修改。</p>
<blockquote>
<p>建议<br><br>设置外部 javascript 和样式表的完整性属性。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js&quot;</span> integrity=<span class="string">&quot;sha384-6ePHh72Rl3hKio4HiJ841psfsRJveeS+aLoaEf3BWfS+gTF0XdAqku2ka8VddikM&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意<br><br>您应该始终提供外部脚本的本地副本，并实现一种方法，以便在外部负载失败的情况下重新加载它们。否则你的网站可能会崩溃。例子:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">window</span>.jQuery || <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script src=&quot;/jquery.min.js&quot;&gt;&lt;\/script&gt;&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-7-Iframe-Sandbox"><a href="#2-2-7-Iframe-Sandbox" class="headerlink" title="2.2.7 Iframe Sandbox"></a>2.2.7 Iframe Sandbox</h4><p>iframe 在 WWW 上随处可见。网站平均有 5.1 iframe，主要用于装载第三方内容。这些 iframe 有很多方法来伤害托管网站，包括运行脚本和插件和重新引导访问者。sandbox 属性允许对 iframe 中可以进行的操作进行限制。</p>
<blockquote>
<p>建议<br><br>设置 iframe 的 sandbox 属性，然后添加所需的权限。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">&quot;https://example.com&quot;</span> sandbox=<span class="string">&quot;allow-same-origin allow-scripts&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-8-Server-Clock"><a href="#2-2-8-Server-Clock" class="headerlink" title="2.2.8 Server Clock"></a>2.2.8 Server Clock</h4><p>服务器包括所有响应的时间戳。不准确的时钟不会给客户机浏览器带来问题。然而，当与其他系统或服务交互时，问题就会出现。</p>
<blockquote>
<p>建议<br><br>使用网络时间协议（NTP）来保持服务器时钟的准确性。</p>
</blockquote>
<h3 id="2-3-Information-disclosure"><a href="#2-3-Information-disclosure" class="headerlink" title="2.3 Information disclosure"></a>2.3 Information disclosure</h3><h4 id="2-3-1-Server-Banner"><a href="#2-3-1-Server-Banner" class="headerlink" title="2.3.1 Server Banner"></a>2.3.1 Server Banner</h4><p>大多数 web 服务器设置报头来识别自己和他们的版本号。这只服务于信息目的和实际用途是非常有限的。去掉整个头，而完全可以接受，通常是不必要的。但是，建议从头中删除版本号。在特定 web 服务器版本中存在 bug 的情况下，包括版本号可以作为对脚本 kiddy 的邀请来尝试对服务器的攻击。</p>
<blockquote>
<p>建议<br><br>包含服务器名称但去掉版本号；</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Server</span>: nginx</span><br></pre></td></tr></table></figure>
<h4 id="2-3-2-Web-Framework-Information"><a href="#2-3-2-Web-Framework-Information" class="headerlink" title="2.3.2 Web Framework Information"></a>2.3.2 Web Framework Information</h4><p>许多 web 框架设置 HTTP 头，识别框架或版本号。除了满足用户的好奇心，而且主要作为技术堆栈的广告，这几乎没有什么作用。这些头是不标准的，对浏览器渲染站点的方式没有影响。</p>
<p>虽然它们没有什么实际用途，但对于搜索运行过时版本的软件的机器人或蜘蛛来说，这些标头是无价的，因为这些软件可能包含安全漏洞。如果没有定期更新，这些头文件可以使网站的目标变得容易。</p>
<blockquote>
<p>建议<br><br>从服务器响应中删除这些标头: <code>X-Powered-By</code>, <code>X-Runtime</code>, <code>X-Version</code> 和 <code>X-AspNet-Version</code>。</p>
</blockquote>
<h3 id="2-4-Cookies"><a href="#2-4-Cookies" class="headerlink" title="2.4 Cookies"></a>2.4 Cookies</h3><h4 id="2-4-1-Cookie-Security"><a href="#2-4-1-Cookie-Security" class="headerlink" title="2.4.1 Cookie Security"></a>2.4.1 Cookie Security</h4><p>包含敏感信息的 cookie，特别是会话 id，需要标记为安全的，假设网站是通过 HTTPS 传输的。这会阻止 cookie 通过 HTTP 发送明文文本。另一种方法是通过 HSTS 来阻止非安全 cookie 在 HTTP 上传输。建议使用安全 cookie 和 HSTS。</p>
<p>会话 cookie 应该与 HttpOnly 值进行标记，以防止它们被 javascript 访问。这可以防止攻击者利用 XSS 窃取会话 cookie。其他 cookie 可能不需要这样标记。但是，除非有明确的需要从 javascript 中访问他们的值，否则最好还是呆在安全的一边，把所有cookie标记为 HttpOnly</p>
<blockquote>
<p>建议<br><br>标记所有 cookie 安全和 HttpOnly。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: <span class="attribute">Key</span>=Value; <span class="attribute">path</span>=/; secure; HttpOnly, <span class="attribute">Key2</span>=Value2; secure; HttpOnly</span><br></pre></td></tr></table></figure>
<h2 id="0x03-服务器软件安全"><a href="#0x03-服务器软件安全" class="headerlink" title="0x03 服务器软件安全"></a>0x03 服务器软件安全</h2><p>我们在最佳实践文章中建议大家如何去配置协议和密码套件，但是如果服务器软件（nginx、apache等）所使用的ssl协议库存在SSL漏洞，或者不支持那些现代化的密码套件和特性，那么无论你如何去修改配置都无法改善现在的安全问题。</p>
<p>所以我们在配置前，或者发现按照推荐配置进行了调整《<a target="_blank" rel="noopener" href="https://myssl.com/">SSL/TLS安全评估报告</a>》还是无法满足要求，那么可以检查下所使用的OpenSSL等加密库是否版本过低。</p>
<h3 id="3-1-如何检查OpenSSL版本"><a href="#3-1-如何检查OpenSSL版本" class="headerlink" title="3.1 如何检查OpenSSL版本"></a>3.1 如何检查OpenSSL版本</h3><h4 id="3-1-1-nginx"><a href="#3-1-1-nginx" class="headerlink" title="3.1.1 nginx"></a>3.1.1 nginx</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nginx</span> -V</span><br><span class="line"></span><br><span class="line"><span class="attribute">nginx</span> version: nginx/<span class="number">1</span>.<span class="number">10</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">built</span> by gcc <span class="number">4</span>.<span class="number">8</span>.<span class="number">5</span> <span class="number">20150623</span> (Red Hat <span class="number">4</span>.<span class="number">8</span>.<span class="number">5</span>-<span class="number">4</span>) (GCC)</span><br><span class="line"><span class="attribute">built</span> with OpenSSL <span class="number">1</span>.<span class="number">0</span>.<span class="number">1</span>e-fips <span class="number">11</span> Feb <span class="number">2013</span></span><br><span class="line"><span class="attribute">TLS</span> SNI support enabled</span><br></pre></td></tr></table></figure>
<p>或者通过openssl命令查看(适用于非自己通过openssl源码编译的）</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl <span class="built_in">version</span></span><br></pre></td></tr></table></figure>
<p>推荐的OpenSSL版本</p>
<ol>
<li>OpenSSL 1.0.2用户需更新到1.0.2h 以上。</li>
<li>OpenSSL 1.0.1用户需更新到1.0.1t 以上。</li>
<li>OpenSSL官方已停止对 0.9.8和 1.0.0 两个版本的升级维护，请使用这两个版本的用户将其升级至1.0.2h版本以上。</li>
</ol>
<blockquote>
<p>OpenSSL 1.0.1以下不支持tls1.2<br><br>升级前请做好测试</p>
</blockquote>
<h3 id="3-2-漏洞事件"><a href="#3-2-漏洞事件" class="headerlink" title="3.2 漏洞事件"></a>3.2 漏洞事件</h3><p><a target="_blank" rel="noopener" href="https://www.trustasia.com/openssl-heartbleed">https://www.trustasia.com/openssl-heartbleed</a></p>
<ul>
<li>OpenSSL 1.0.1g 已修复该漏洞</li>
<li>OpenSSL 1.0.0 分支版本不受此漏洞影响</li>
<li>OpenSSL 0.9.8 分支版本不受此漏洞影响</li>
<li>OpenSSL 1.0.2 Beta2 不受此漏洞影响<br><a target="_blank" rel="noopener" href="https://myssl.com/heartbleed.html">Heartbleed检测工具(使用多个工具测试，防止误报)</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.trustasia.com/OpenSSL-DROWN-attack">https://www.trustasia.com/OpenSSL-DROWN-attack</a></p>
<ul>
<li>OpenSSL 1.0.1h+</li>
<li>OpenSSL 1.0.0m+</li>
<li>OpenSSL 0.9.8za+</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.trustasia.com/OpenSSL-CVE-2016-2107-Padding-Oracle">https://www.trustasia.com/OpenSSL-CVE-2016-2107-Padding-Oracle</a></p>
<ul>
<li>OpenSSL 1.0.2用户需更新到1.0.2h 。</li>
<li>OpenSSL 1.0.1用户需更新到1.0.1t 。</li>
<li>使用包管理系统的用户可以直接更新到2016年5月3日 之后的版本。<br><a target="_blank" rel="noopener" href="https://myssl.com/cbc_oracle.html">CBC padding oracle检测 检测工具&gt;&gt;</a></li>
</ul>
<p>OpenSSL CCS漏洞<br><br>此漏洞是 OpenSSL ChangeCipherSpec 设计缺陷造成，被称为 CCS 注入漏洞。<br><br><a target="_blank" rel="noopener" href="https://www.trustasia.com/openssl-ccs">https://www.trustasia.com/openssl-ccs</a></p>
<ul>
<li>OpenSSL 1.1.0 应升级到 1.1.0a 或更高版本。</li>
<li>OpenSSL 1.0.2 应升级到 1.0.2i 或更高版本。</li>
<li>OpenSSL 1.0.1 应升级到 1.0.1u 或更高版本。<br><a target="_blank" rel="noopener" href="https://myssl.com/ccs.html">OpenSSL CCS 检测工具&gt;&gt;</a></li>
</ul>
<blockquote>
<p>注意：<br><br>OpenSSL官方已停止对 0.9.8和 1.0.0 两个版本的升级维护，请使用这两个版本的用户将其升级至更高版本。</p>
</blockquote>

        
<!--
        </br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://blog.myssl.com/ssl-and-tls-deployment-best-practices/">https://blog.myssl.com/ssl-and-tls-deployment-best-practices/</a></p>
</blockquote>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>SSL/TLS 是一种简单易懂的技术，它很容易部署及运行。但想要部署的安全通常是不容易的。这也使系统管理员和开发者不得不去了解 SSL 和 TLS 相关的技术，掌握如何配置一个安全的 web 服务器或应用。无疑会耗费很大的精力去看相关的技术文档，乏味且宽泛。</p>
<p>本篇文档的目的在于如何让系统管理员或开发者用尽可能少的时间部署一个安全的 web 站点或应用，即 SSL 和 TLS 部署最佳实践。</p>
<h2 id="0x01-SSL-TLS部署"><a href="#0x01-SSL-TLS部署" class="headerlink" title="0x01 SSL/TLS部署"></a>0x01 SSL/TLS部署</h2><h3 id="1-1-证书和私钥"><a href="#1-1-证书和私钥" class="headerlink" title="1.1 证书和私钥"></a>1.1 证书和私钥</h3><p>在TLS中，所有的安全性都从服务器的密码标识开始；需要一个强大的私钥来防止攻击者进行模拟攻击。同样重要的是要有一个有效的和强大的证书，这将授予私有密匙作为一个特定主机名的权利。没有这两个基本的构建块，就没有其他东西可以安全了。</p>
<h4 id="1-1-1-使用-2048-位私钥"><a href="#1-1-1-使用-2048-位私钥" class="headerlink" title="1.1.1 使用 2048 位私钥"></a>1.1.1 使用 2048 位私钥</h4><p>对于大多数的 web 站点，提供一个 2048 的 RSA key 是足够安全的。<span id="more"></span>RSA 的公钥算法是被普遍支持的，这使得这个类型的 key 作为默认是足够安全的。对于 2048 位，这些 key 提供了大约 112 位的安全性。如果您想要比这更多的安全性，请注意 RSA key 的伸缩性不太好。想要获得 128 位的安全性，你需要 3072 位 RSA key，这会很大的影响性能。ECDSA key 提供了一种提供更好安全性和更好性能的替代方法。对于 256 位，ECDSA key 提供 128 位安全性。少数古董客户端不支持 ECDSA，但现代客户端是支持的。如果您不介意管理这样一个设置的开销，那么您可以同时部署 RSA 和 ECDSA 密钥。</p>
<h4 id="1-1-2-保护你的私钥"><a href="#1-1-2-保护你的私钥" class="headerlink" title="1.1.2 保护你的私钥"></a>1.1.2 保护你的私钥</h4><p>把你的私钥视为一项重要的资产，尽可能最大的使用你的私钥，限制最小的员工的访问。建议的政策包括以下内容:</p>
<ul>
<li>在可信计算机上用足够的熵生成私有密钥。一些 CA 为您提供生成私钥的功能，请尽量不要这样做。</li>
<li>密码保护 key 最初就不要存储在备份系统中。私钥密码在生产环境中起不了什么作用，因为有知识的攻击者总是能够从进程内存中检索密钥。有硬件设备(被称为硬件安全模块，或 HSMs)，即使在服务器折衷的情况下，也可以保护私有密匙，但是它们是昂贵的，因此仅适用于具有严格安全性需求的组织。</li>
<li>妥协后，撤销旧证书并生成新密钥。</li>
<li>每年更新证书，如果您可以自动化过程，则更频繁。大多数网站都应该假定不可靠的妥协证书被撤销; 因此，具有较短使用寿命的证书在实践中更加安全。</li>
<li>除非保持相同的密钥对于公钥密钥很重要，否则每当获得新证书时，还应该生成新的私钥。</li>
</ul>
<h4 id="1-1-3-覆盖您的域名"><a href="#1-1-3-覆盖您的域名" class="headerlink" title="1.1.3 覆盖您的域名"></a>1.1.3 覆盖您的域名</h4><p>确保您的证书涵盖您希望与网站一起使用的所有名称。您的目标是避免无效的证书警告，这会混淆用户，削弱他们的信心。</p>
<p>即使您期望只使用一个域名，请记住，您无法控制用户到达该网站的方式或其他人如何链接到该网站。在大多数情况下，您应该确保该证书与 www 前缀有关（例如，它适用于 example.com 和<br><a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> ）。经验法则是，安全的 Web 服务器应该具有对配置为指向它的每个 DNS 名称有效的证书。</p>
<p>通配符证书能满足更广泛的需求，但如果准备将密钥暴露给更多的人员，特别是跨团队或部门，则避免使用它们。换句话说，访问私钥的人越少越好。还要注意，证书共享会创建一个可以被滥用的将漏洞从一个网站或服务器传输到使用相同证书的所有其他站点和服务器（即使底层私钥不同，只要证书域名匹配）的绑定。</p>
<h4 id="1-1-4-从可信-CA-获取证书"><a href="#1-1-4-从可信-CA-获取证书" class="headerlink" title="1.1.4 从可信 CA 获取证书"></a>1.1.4 从可信 CA 获取证书</h4><p>选择对其证书业务和安全性可靠和认真的认证中心（CA）。选择 CA 时，请考虑以下条件：</p>
<p><strong>安全状态</strong> 所有CA都经过定期审核，但有些则比其他 CA 更为严重。弄清哪些在这方面做的更好并不容易，但一个选择是检查他们的安全历史，更重要的是，他们如何反应妥协，如果他们从错误中学到了经验，这将更有利。</p>
<p><strong>业务重点</strong> CA 的活动构成其业务的重要组成部分，如果事情发生严重错误，其所有事情都将丢失，并且在其他地方追逐潜在的更有利可图的机会可能不会忽视其证书部门。</p>
<p><strong>提供的服务</strong> 至少，您选择的 CA 应提供对证书吊销列表（CRL）和在线证书状态协议（OCSP）撤销方法的支持，具有稳定的网络可用性和性能。许多网站对域验证的证书感到满意，但您也应该考虑是否需要扩展验证（EV）证书。在任一种情况下，您都应该选择公钥算法。大多数网站今天使用 RSA，但由于其性能优势，ECDSA 在未来可能会变得重要。</p>
<p><strong>证书管理</strong> 选项如果您需要大量证书并在复杂环境中运行，请选择一个 CA，为您提供良好的管理工具。</p>
<p>支持选择一个 CA，如果需要的话可以给您很好的支持。</p>
<blockquote>
<p>   注意<br/><br>   为了获得最佳效果，请提前获得证书，并在部署到生产之前至少一周。这种做法<br/>（1）有助于避免在计算机上没有正确时间的一些用户的证书警告;<br/>（2）有助于避免与 CA 需要额外时间的 CA 失败的撤销检查，以向 OCSP 响应者传播有效的新证书。<br/>随着时间的推移，尝试将这个“热身”期延长至 1-3 个月。同样，不要等到你的证书即将到期以替换它们。留下额外的几个月也会帮助时钟不正确的人在另一个方向。</p>
</blockquote>
<h4 id="1-1-5-使用强签名算法"><a href="#1-1-5-使用强签名算法" class="headerlink" title="1.1.5 使用强签名算法"></a>1.1.5 使用强签名算法</h4><p>证书安全性取决于</p>
<ol>
<li>用于签署证书的私钥的强度，</li>
<li>签名中使用的散列函数的强度。</li>
</ol>
<p>直到最近，大多数证书都依赖于 SHA1 散列函数，现在被认为是不安全的。因此，我们正在向 SHA256 转型。截至 2016 年 1 月，您无法从公共 CA 获取 SHA1 证书。现有的 SHA1 证书将继续工作（在某些浏览器中有警告），但只能到 2016 年底。</p>
<h3 id="1-2-配置"><a href="#1-2-配置" class="headerlink" title="1.2 配置"></a>1.2 配置</h3><p>使用正确的 TLS 服务器配置，您可以确保将凭据正确呈现给站点的访问者，仅使用安全的加密原语，并减轻所有已知的缺陷。</p>
<h4 id="1-2-1-使用完整的证书链"><a href="#1-2-1-使用完整的证书链" class="headerlink" title="1.2.1 使用完整的证书链"></a>1.2.1 使用完整的证书链</h4><p>在大多数部署中，仅服务器证书不够的; 需要两个或多个证书来建立完整的信任链。当部署具有有效证书但没有所有必要的中间证书的服务器时，会发生常见的配置问题。为避免这种情况，只需使用 CA 提供给您的所有证书。</p>
<p>无效的证书链有效地使服务器证书无效并导致浏览器警告。实际上，这个问题有时难以诊断，因为一些浏览器可以重构不完整的链，有些浏览器不能重建。所有浏览器都倾向于缓存和重用中间证书。</p>
<h4 id="1-2-2-使用安全的协议"><a href="#1-2-2-使用安全的协议" class="headerlink" title="1.2.2 使用安全的协议"></a>1.2.2 使用安全的协议</h4><p>SSL／TLS 系列中有五种协议：SSL v2，SSL v3，TLS v1.0，TLS v1.1和TLS v1.2：</p>
<ul>
<li>SSL v2 是不安全的，不能使用。此协议版本非常糟糕，即使它们位于完全不同的服务器（DROWN 攻击）上也可以用来攻击具有相同名称的RSA 密钥和站点。</li>
<li>当与 HTTP（POODLE 攻击）一起使用时，SSL v3 是不安全的，当与其他协议一起使用时，SSL v3 是弱的。它也是过时的，不应该被使用。</li>
<li>TLS v1.0 也是不应该使用的传统协议，但在实践中通常仍然是必需的。其主要弱点（BEAST）在现代浏览器中得到缓解，但其他问题仍然存在。</li>
<li>TLS v1.1 和 v1.2 都没有已知的安全问题，只有 v1.2 提供了现代的加密算法。</li>
</ul>
<p>TLS v1.2 应该是您的主要协议，因为它是唯一提供现代认证加密（也称为 AEAD）的版本。如果您今天不支持 TLS v1.2，则缺乏安全性。</p>
<p>为了支持较旧的客户端，您可能需要继续支持 TLS v1.0 和TLS v1.1。但是，您应该计划在不久的将来退出 TLS v1.0。例如，PCI DSS 标准将要求所有接受信用卡付款的网站在 2018 年 6 月之前移除对 TLS v1.0 的支持。</p>
<p>目前正在开展设计 TLS v1.3 的工作，其目的是消除所有过时和不安全的功能，并进行改进，以保持我们的通信在未来几十年内的安全。</p>
<h4 id="1-2-3-使用安全的套件"><a href="#1-2-3-使用安全的套件" class="headerlink" title="1.2.3 使用安全的套件"></a>1.2.3 使用安全的套件</h4><p>为了安全通信，您必须首先确定您正在与所需方（而不是通过将窃听的其他人）直接沟通并安全地交换数据。在 SSL 和 TLS 中，密码套件定义了如何进行安全通信。它们由不同的建筑组成，通过多样性实现安全。如果发现其中一个构建块软弱或不安全，那么您应该可以切换到另一个。</p>
<p>您应该主要依靠提供强身份验证和密钥交换，前向保密和至少 128 位加密的 AEAD 套件。还有一些其他较弱的套房可能仍然得到支持，只要它们只能与不支持任何更好的老客户进行协商。</p>
<p>有几个过时的加密原语必须避免：</p>
<ul>
<li>匿名 Diffie-Hellman（ADH）套件不提供身份验证。</li>
<li>NULL 密码套件不提供加密。</li>
<li>导出密码套件在连接中协商时不安全，但也可以针对更喜欢更强大的套件（FREAK攻击）的服务器使用。</li>
<li>弱密码（通常为 40 和 56 位）的套件使用可以轻松破坏的加密。</li>
<li>RC4 是不安全的。<a target="_blank" rel="noopener" href="http://www.rfc-editor.org/rfc/rfc7465.txt">rfc7465</a></li>
<li>3DES 缓慢而虚弱。</li>
</ul>
<p>使用以RSA和ECDSA键为基础的以下套件配置，作为起点：</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_ECDHE_ECDS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA384</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_ECDHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA384</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_GCM_SHA256</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_GCM_SHA384</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_128_CBC_SHA256</span><br><span class="line">TLS_DHE_RS<span class="built_in">A_WITH</span>_AES_256_CBC_SHA256</span><br></pre></td></tr></table></figure>
<blockquote>
<p>警告<br/><br>我们建议您始终首先在分段环境中测试TLS配置，仅在确定所有内容按预期工作时将更改应用到生产环境。请注意，以上是一个通用列表，并不是所有系统（特别是较旧的）支持所有套件。这就是为什么测试很重要，推荐您使用《<a target="_blank" rel="noopener" href="https://myssl.com/">SSL/TLS安全评估</a>》进行检查。</p>
</blockquote>
<p>上述示例配置使用标准 TLS 套件名称。一些平台使用非标准名称; 有关详细信息，请参阅您的平台的文档。例如，以下套件名称将与OpenSSL 一起使用：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-ECDSA-AES<span class="number">256</span>-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">ECDHE</span>-RSA-AES<span class="number">256</span>-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-SHA</span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-SHA</span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">128</span>-SHA<span class="number">256</span></span><br><span class="line"><span class="attribute">DHE</span>-RSA-AES<span class="number">256</span>-SHA<span class="number">256</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-4-选择合适的协议"><a href="#1-2-4-选择合适的协议" class="headerlink" title="1.2.4 选择合适的协议"></a>1.2.4 选择合适的协议</h4><p>在SSL v3及更高版本的协议版本中，客户端提交他们支持的密码套件列表，服务器从列表中选择一个用于连接的套件。然而，并不是所有的服务器都做得很好，有些将从客户端列表中选择第一个支持的套件。使服务器主动选择最佳可用加密套件对于实现最佳安全性至关重要。</p>
<h4 id="1-2-5-使用-FS"><a href="#1-2-5-使用-FS" class="headerlink" title="1.2.5 使用 FS"></a>1.2.5 使用 FS</h4><p>前向保密（有时也称为完全前向保密）是一种协议功能，可实现不依赖服务器私钥的安全对话。对于不提前向保密的密码套件，可以恢复服务器的私钥的人就可以解密所有较早记录的加密对话（也就是可以先大量记录密文，再解密，比如您的证书到期后没有正确销毁，它的私钥就能用来解密非PFS的密文）。您需要支持并喜欢 ECDHE 套件，以便通过现代网络浏览器实现前向保密。为了支持更广泛的客户，您还应该使用 DHE 套件作为 ECDHE 后备。避免 RSA 密钥交换，除非绝对必要。我在2.3节中提出的默认配置只包含提供前向保密的套件。</p>
<h4 id="1-2-6-使用强的密钥交换算法"><a href="#1-2-6-使用强的密钥交换算法" class="headerlink" title="1.2.6 使用强的密钥交换算法"></a>1.2.6 使用强的密钥交换算法</h4><p>对于密钥交换，公共站点通常可以选择经典的短暂的 Diffie-Hellman密钥交换（DHE）和其椭圆曲线变体 ECDHE。还有其他的密钥交换算法，但是它们通常是以某种方式不安全的。RSA 密钥交换仍然很受欢迎，但不提供前向保密。</p>
<p>2015 年，一批研究人员发表了对 DHE 的新攻击; 他们的工作被称为Logjam 攻击。[2] 研究人员发现，较低强度的 DH 密钥交换（例如768 位）容易被破坏，一些知名的 1024 位 DH 组可被国家机构破坏。为了安全起见，如果部署 DHE，请至少配置 2048 位的安全性。一些较老的客户端（例如Java 6）可能不支持这种强度。出于性能原因，大多数服务器应该更喜欢 ECDHE，这是更强大和更快。在这种情况下，secp256r1命名曲线（也称为 P-256）是一个很好的选择。</p>
<h3 id="1-3-减轻已知问题"><a href="#1-3-减轻已知问题" class="headerlink" title="1.3 减轻已知问题"></a>1.3 减轻已知问题</h3><p>近几年来已经发生了几次严重的 SSL 和 TLS 攻击，但是如果您正在运行最新的软件并遵循本指南的建议，那么它们通常不会关心您。（如果没有，我建议您使用 MYSSL 测试您的系统，并从中进行测试）。但是，没有什么是完全安全的，所以为了保持对安全性的了解，这是一个很好的做法。如果供应商补丁可用，请及时提供; 否则，依靠解决方案进行缓解。</p>
<h3 id="1-4-性能"><a href="#1-4-性能" class="headerlink" title="1.4 性能"></a>1.4 性能</h3><p>安全是我们在本指南中的主要重点，但我们也要注意表现; 一个不符合性能标准的安全服务无疑将被丢弃。通过正确配置，TLS 可以相当快。使用现代协议（例如 HTTP/2），甚至可能比明文通信更快。</p>
<h4 id="1-4-1-避免过度安全"><a href="#1-4-1-避免过度安全" class="headerlink" title="1.4.1 避免过度安全"></a>1.4.1 避免过度安全</h4><p>用于建立安全连接的密码握手是一种操作，其费用受私钥大小的高度影响。使用太短的密钥是不安全的，但使用太长的密钥将导致“太多”的安全性和缓慢的操作。对于大多数网站，使用超过 2048 位的 RSA 密钥和强大于 256 位的 ECDSA 密钥会浪费 CPU 功耗，并可能会损害用户体验。类似地，增加短暂密钥交换的强度对于 DHE 为 2048 位以及 ECDHE 为 256 位几乎没有什么好处。使用高于 128 位的加密没有明显的好处。</p>
<h4 id="1-4-2-使用-session-恢复"><a href="#1-4-2-使用-session-恢复" class="headerlink" title="1.4.2 使用 session 恢复"></a>1.4.2 使用 session 恢复</h4><p>会话恢复是一种性能优化技术，可以节省昂贵的密码操作的结果，并重复使用一段时间。残疾或非功能性会话恢复机制可能会引起显着的性能损失。</p>
<h4 id="1-4-3-使用-WAN-优化和-HTTP-2"><a href="#1-4-3-使用-WAN-优化和-HTTP-2" class="headerlink" title="1.4.3 使用 WAN 优化和 HTTP/2"></a>1.4.3 使用 WAN 优化和 HTTP/2</h4><p>这些天，TLS 开销不是来自 CPU 饥饿的加密操作，而是来自网络延迟。只有在 TCP 握手完成后才能启动TLS握手，需要进一步交换数据包，并且离开服务器的距离更远。最小化延迟的最佳方法是避免创建新的连接 - 换句话说，保持现有的连接长时间（keep-alives）。提供良好结果的其他技术包括支持现代协议（如HTTP / 2）和使用WAN优化（通常通过内容传送网络）。</p>
<h4 id="1-4-4-隐藏公共内容"><a href="#1-4-4-隐藏公共内容" class="headerlink" title="1.4.4 隐藏公共内容"></a>1.4.4 隐藏公共内容</h4><p>通过TLS进行通信时，浏览器可能会认为所有流量都是敏感的。它们通常会使用内存来缓存某些资源，但一旦关闭浏览器，所有内容可能会丢失。为了获得性能提升，并能够长期缓存一些资源，将公共资源（例如图像）标记为公开。</p>
<h4 id="1-4-5-使用-OCSP-Stapling"><a href="#1-4-5-使用-OCSP-Stapling" class="headerlink" title="1.4.5 使用 OCSP Stapling"></a>1.4.5 使用 OCSP Stapling</h4><p>OCSP 装订是 OCSP 协议的扩展，可以直接从服务器提供撤销信息作为 TLS 握手的一部分。因此，客户端不需要联系 OCSP 服务器进行带外验证，并且总体 TLS 连接时间显着减少。OCSP 装订是一种重要的优化技术，但您应该注意，并不是所有的网络服务器都提供了可靠的 OCSP 装订实现。结合具有缓慢或不可靠的 OCSP 响应者的 CA，这样的 Web 服务器可能会产生性能问题。为了获得最佳效果，请模拟故障条件，看看它们是否会影响您的可用性。</p>
<h4 id="1-4-6-使用快速加密"><a href="#1-4-6-使用快速加密" class="headerlink" title="1.4.6 使用快速加密"></a>1.4.6 使用快速加密</h4><p>除了提供最佳的安全性，我推荐的密码套件配置也提供了最好的性能。尽可能使用支持硬件加速 AES 的 CPU。之后，如果您真的想要进一步的性能优势（大多数网站可能不需要），请考虑使用 ECDSA 密钥。</p>
<h3 id="1-5-HTTP-和-应用安全"><a href="#1-5-HTTP-和-应用安全" class="headerlink" title="1.5 HTTP 和 应用安全"></a>1.5 HTTP 和 应用安全</h3><p>HTTP 协议和 Web 应用交付的周边平台在 SSL 诞生后继续快速发展。作为这一进化的结果，该平台现在包含可用于打败加密的功能。在本节中，我们列出了这些功能，以及安全使用它们的方法。</p>
<h4 id="1-5-1-加密无处不在"><a href="#1-5-1-加密无处不在" class="headerlink" title="1.5.1 加密无处不在"></a>1.5.1 加密无处不在</h4><p>加密是可选的事实可能是今天最大的安全问题之一。我们看到以下问题：</p>
<ul>
<li>没有 TLS 需要它的网站</li>
<li>具有 TLS 但不执行 TLS 的站点</li>
<li>混合 TLS 和非 TLS 内容的网站，有时甚至在同一网页内</li>
<li>编程错误的网站会颠覆 TLS</li>
</ul>
<p>尽管如果您确切了解您正在做的事情，许多这些问题可以被缓解，可靠地保护网站通信的唯一方法是无一例外地执行加密。</p>
<h4 id="1-5-2-消除混合内容"><a href="#1-5-2-消除混合内容" class="headerlink" title="1.5.2 消除混合内容"></a>1.5.2 消除混合内容</h4><p>混合内容页面是通过 TLS 传输但是包含不通过 TLS 传输的资源（例如，JavaScript 文件，images，CSS 文件）的页面。这样的页面不安全。一个活跃的中间人（MITM）攻击者可以搭载一个单独的未受保护的 JavaScript 资源，例如劫持整个用户会话。即使您遵循上一节的建议并对整个网站加密，您仍然可能会最终从第三方网站中检索未加密的一些资源。</p>
<h4 id="1-5-3-使用可信第三方"><a href="#1-5-3-使用可信第三方" class="headerlink" title="1.5.3 使用可信第三方"></a>1.5.3 使用可信第三方</h4><p>网站通常使用通过从另一个服务器下载的 JavaScript 代码激活的第三方服务。这种服务的一个很好的例子是 Google Analytics（分析），用于 Web 的大部分。这种包含第三方代码创建一个隐含的信任连接，有效地使对方完全控制您的网站。第三方可能不是恶意的，但是这些服务的大型提供商越来越被视为目标。推理很简单：如果大型提供程序受到威胁，攻击者将被自动访问所有依赖该服务的站点。</p>
<p>如果您遵循第4.2节的建议，至少您的第三方链接将被加密，从而避免 MITM 攻击。但是，您应该进一步了解：了解您使用的服务和删除服务，将其替换为更安全的替代方案，或接受其继续使用的风险。一种称为子资源完整性（SRI）的新技术可用于通过第三方资源来减少潜在的风险。[3]</p>
<h4 id="1-5-4-安全-cookie"><a href="#1-5-4-安全-cookie" class="headerlink" title="1.5.4 安全 cookie"></a>1.5.4 安全 cookie</h4><p>要正确安全，网站需要 TLS，而且所有的 Cookie 在创建时都被明确标记为安全的。未能保护 cookies 可以让活跃的 MITM 攻击者通过聪明的技巧来挑逗一些信息，即使在 100％ 加密的网站上也是如此。为了获得最佳效果，请考虑为您的 Cookie 添加加密完整性验证或甚至加密。</p>
<h4 id="1-5-5-安全-HTTP-压缩"><a href="#1-5-5-安全-HTTP-压缩" class="headerlink" title="1.5.5 安全 HTTP 压缩"></a>1.5.5 安全 HTTP 压缩</h4><p>2012 年 CRIME 攻击显示 TLS 压缩无法安全实施。唯一的解决方案是完全禁用 TLS 压缩。次年，随后再发生两次攻击。TIME 和 BREACH 专注于使用 HTTP 压缩压缩的 HTTP 响应实体中的秘密。与 TLS 压缩不同，HTTP 压缩是必需的，不能关闭。因此，为了解决这些攻击，需要对应用程序代码进行更改。[4]</p>
<p>TIME 和 BREACH 攻击并不容易实现，但是如果某人有足够的动力使用它们，则这种影响大致相当于成功的跨站点请求伪造（CSRF）攻击。</p>
<h4 id="1-5-6-部署-HSTS"><a href="#1-5-6-部署-HSTS" class="headerlink" title="1.5.6 部署 HSTS"></a>1.5.6 部署 HSTS</h4><p>HTTP 严格传输安全（HSTS）是 TLS 的安全网。它旨在确保即使在配置问题和实施错误的情况下，安全性仍然保持不变。要激活 HSTS 保护，您可以向您的网站添加一个新的响应头。之后，支持 HSTS（此时所有现代浏览器）的浏览器执行它。</p>
<p>HSTS 的目标很简单：激活后，它不允许与使用它的网站进行任何不安全的通信。通过自动将所有明文链接转换为安全的链接，实现了这一目标。作为奖励，它还会禁用点击式证书警告。（证书警告是活动的 MITM 攻击的指标，研究表明大多数用户点击这些警告，所以绝对不要让他们感兴趣）。</p>
<p>添加对 HSTS 的支持是您可以为您的网站的 TLS 安全性做出的最重要的改进。新站点始终应设计为 HSTS，旧站点转换为尽可能快地支持。为了获得最佳安全性，请考虑使用 HSTS 预加载[5]，将HSTS配置嵌入到现代浏览器中，从而使您的网站的第一个连接安全。</p>
<p>以下配置示例将在主主机名及其所有子域上激活一段时间为一年的 HSTS，同时还允许预加载：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: <span class="keyword">max</span>-age<span class="operator">=</span><span class="number">31536000</span><span class="comment">; includeSubDomains; preload</span></span><br></pre></td></tr></table></figure>
<h4 id="1-5-7-部署-CSP"><a href="#1-5-7-部署-CSP" class="headerlink" title="1.5.7 部署 CSP"></a>1.5.7 部署 CSP</h4><p>内容安全策略（CSP）是网站可以用来限制浏览器操作的安全机制。尽管最初旨在解决跨站点脚本（XSS），CSP 不断发展，并支持对增强TLS安全性有用的功能。特别地，它可以用于限制混合内容，当涉及到第三方网站，HSTS没有帮助。</p>
<p>要部署CSP以防止第三方混合内容，请使用以下配置：</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> https: <span class="string">&#x27;unsafe-inline&#x27;</span> <span class="string">&#x27;unsafe-eval&#x27;</span>;</span><br><span class="line">                         <span class="keyword">connect-src</span> https: wss:</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意<br/><br>这不是部署 CSP 的最佳方法。为了提供不破坏混合内容以外的任何内容的示例，我不得不禁用某些默认安全功能。随着时间的推移，当您了解 CSP 的更多信息时，您应该更改您的策略以使其恢复。</p>
</blockquote>
<h4 id="1-5-8-不要缓存敏感内容"><a href="#1-5-8-不要缓存敏感内容" class="headerlink" title="1.5.8 不要缓存敏感内容"></a>1.5.8 不要缓存敏感内容</h4><p>所有敏感内容必须仅传达给预定方，并由所有设备进行相应处理。虽然代理没有看到加密的流量，并且不能在用户之间共享内容，但是使用基于云的应用交付平台正在增加，这就是为什么在指定什么是公共的时候需要非常小心的是什么。</p>
<h4 id="1-5-9-考虑其它威胁"><a href="#1-5-9-考虑其它威胁" class="headerlink" title="1.5.9 考虑其它威胁"></a>1.5.9 考虑其它威胁</h4><p>TLS 旨在仅解决安全机密和您与用户之间通信的完整性的一个方面，但还有许多其他威胁需要处理。在大多数情况下，这意味着确保您的网站没有其他弱点。</p>
<h3 id="1-6-验证"><a href="#1-6-验证" class="headerlink" title="1.6 验证"></a>1.6 验证</h3><p>有许多配置参数可用于调整，预先知道某些变化会产生什么影响。此外，有时会意外地进行更改; 软件升级可以静默地引入更改。因此，我们建议您最初使用全面的 SSL/TLS 评估工具来验证您的配置，以确保您开始安全，然后定期确保您保持安全。对于公共网站，我们建议您免费使用SSL实验室服务器测试。[6]</p>
<h4 id="1-6-1-高级主题"><a href="#1-6-1-高级主题" class="headerlink" title="1.6.1 高级主题"></a>1.6.1 高级主题</h4><p>以下高级主题目前不在我们的指南范围之内。他们需要更深入地了解 SSL/TLS 和公钥基础设施（PKI），而且他们仍然被专家辩论。</p>
<h4 id="1-6-2-使用-HPKP"><a href="#1-6-2-使用-HPKP" class="headerlink" title="1.6.2 使用 HPKP"></a>1.6.2 使用 HPKP</h4><p>公共密钥固定旨在使网站运营商有权限制哪些 CA 可以为其网站颁发证书。Google 已经部署了这个功能了一段时间（硬编码到他们的浏览器，Chrome），并且已被证明是非常有用的，以防止攻击并使公众了解它们。在 2014 年，Firefox 还增加了对硬编码固定的支持。现在可以使用一种称为 HTTP [7]的公钥固定扩展标准。公钥绑定解决了 PKI 最大的弱点（事实上，任何 CA 都可以为任何网站发布证书），但是这是一个成本; 部署需要大量精力和专业知识，并造成失去对您站点控制的风险（如果最终导致无效的固定配置）。你应该考虑固定很大程度上只有当你</p>
<h4 id="1-6-2-使用-DNSSEC-和-DANE"><a href="#1-6-2-使用-DNSSEC-和-DANE" class="headerlink" title="1.6.2 使用 DNSSEC 和 DANE"></a>1.6.2 使用 DNSSEC 和 DANE</h4><p>域名系统安全扩展（DNSSEC）是一种增加域名系统完整性的技术。今天，一个活跃的网络攻击者可以轻松地劫持任何 DNS 请求并伪造任意的响应。使用 DNSSEC，所有响应都可以加密地跟踪到 DNS 根目录。命名实体的基于 DNS 的身份验证（DANE）是建立在 DNSSEC 之上的单独标准，用于提供 DNS 和 TLS 之间的绑定。DANE 可用于增强现有基于 CA 的 PKI 生态系统的安全性，或者完全绕过它。</p>
<p>即使不是每个人都同意，DNSSEC 是互联网的一个很好的方向，但对其的支持仍在继续改善。浏览器还不支持 DNSSEC 或 DANE（更喜欢 HSTS 和 HPKP 提供的类似功能），但有一些迹象表明它们正在开始用于提高电子邮件传递的安全性。</p>
<h2 id="0x02-安全加固"><a href="#0x02-安全加固" class="headerlink" title="0x02 安全加固"></a>0x02 安全加固</h2><p>当你的网站上了 HTTPS 以后，可否觉得网站已经安全了？这里 提供了一个 HTTPS 是否安全的检测工具，你可以试试。</p>
<p>在线检测工具-<a target="_blank" rel="noopener" href="https://myssl.com/">https://myssl.com/</a></p>
<p>本篇正文讲述的是 HTTP 安全的最佳实践，着重在于 HTTPS 网站的 Header 的相关配置。</p>
<h3 id="2-1-连接安全性和加密"><a href="#2-1-连接安全性和加密" class="headerlink" title="2.1 连接安全性和加密"></a>2.1 连接安全性和加密</h3><h4 id="2-1-1-SSL-TLS"><a href="#2-1-1-SSL-TLS" class="headerlink" title="2.1.1 SSL/TLS"></a>2.1.1 SSL/TLS</h4><p>传输层安全（TLS）及其前身安全套接字层（SSL），通过在浏览器和 web 服务器之间提供端到端加密来促进机密通信。没有 TLS，就谈不上什么安全。TLS 是 HTTP 安全性的基础。</p>
<p>想要部署 TLS 是非常容易的，但其难点在于如何使用安全的配置来保障站点的安全。<br>尤其是 Protocol 版本和 Cipher 需要小心选择和配置。你可以通过<a target="_blank" rel="noopener" href="https://myssl.com/">https://myssl.com/</a>体检你的网站，发现并解决这些细节的问题。</p>
<blockquote>
<p>建议<br/><br>所有本地和链接的资源需要正确的配置，且要使用 TLS。</p>
</blockquote>
<h4 id="2-1-2-HTTP-Strict-Transport-Security-HSTS"><a href="#2-1-2-HTTP-Strict-Transport-Security-HSTS" class="headerlink" title="2.1.2 HTTP Strict Transport Security (HSTS)"></a>2.1.2 HTTP Strict Transport Security (HSTS)</h4><p>指示浏览器只使用 HTTPS 连接到目标服务器。这可以防止一些潜在的中间人攻击，包括 SSL 剥离，会话 cookie 窃取（如果没有被 适当保护）。如果遇到任何与证书相关的错误，它还可以阻止浏览器连接到网站。当浏览器访问一个设置相应 HTTP header 的 HTTPS 网站时，HSTS 将被激活。</p>
<p>HSTS 有一个固定期限，由 max-age 字段值控制。这个值可以是静态的，也可以是相对于将来某个特定日期的，你可以设置成 SSL 证书的过期时间。</p>
<p>在浏览器中，HSTS 首选项可以通过提交到 <a target="_blank" rel="noopener" href="https://hstspreload.appspot.com/">Chromium’s HSTS preload list</a> 来硬编码，这是所有实现 HSTS 使用的浏览器。</p>
<p>注意，HSTS 确实有陷阱。它提供了 <code>include subdomains</code> 选项，这在实践中可能是太宽泛了。此外，客户端错误可能会造成严重的后果——客户端错误的时钟导致它认为服务器的 SSL 证书无效或过期，或者缺少根 CA 证书——将不再导致浏览器中的证书错误。浏览器将完全拒绝访问页面，并且可能会显示让安全专家之外的完全无法理解的错误。</p>
<blockquote>
<p>建议<br/><br>设置 HSTS header 长的生命周期，最好是半年及以上。</p>
</blockquote>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Strict</span>-Transport-Security: <span class="built_in">max</span>-age=<span class="number">31536000</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-Public-Key-Pins"><a href="#2-1-3-Public-Key-Pins" class="headerlink" title="2.1.3 Public Key Pins"></a>2.1.3 Public Key Pins</h4><p>HTTP PKP（HPKP）指示浏览器只与提供的 SSL/TLS 的 HASH 相符或存在于同一证书链的服务器相连接。换句话说，如果 SSL/TLS 证书以一种意想不到的方式发生了变化，浏览器就无法连接到主机。这主要是针对受信任证书颁发机构（CA）或流氓 CA 证书颁发的伪造证书，用户可能会被骗安装。</p>
<p>例如，浏览器连接到 <a target="_blank" rel="noopener" href="https://example.com,它存在这个头.header/">https://example.com，它存在这个头。header</a> 告诉浏览器，如果证书 key 匹配，或者在发出证书链中有一个 key 匹配，那么在将来才会再次连接。其他的指令组合是可能的。它们都极大地减少了攻击者在客户端和合法主机之间模拟主机或拦截通信的可能性。</p>
<p>像 HSTS 一样，HPKP 在实现之前需要仔细的思考和计划。错误可以将用户锁定在您的站点之外，并且不容易修复。</p>
<p>像 HSTS 一样，HPKP 在实现之前需要仔细的思考和计划。错误可以将用户锁定在您的站点之外，并且不容易修复。</p>
<blockquote>
<p>建议<br/><br>确定是否需要为您的站点使用 PKP。如果是这样的话，那么从一个较小的实践开始，如果在一段时间之后没有遇到问题，就增加它。如果 SSL/TLS 密钥需要更新，建立备份计划。优先创建备份密钥和离线存储。</p>
</blockquote>
<p>示例HTTP头:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Public-Key-Pins: <span class="attribute">max-age</span>=5184000; <span class="attribute">pin-sha256</span>=<span class="string">&quot;+oZq/vo3Kcv0CQPjpdwyInqVXmLiobmUJ3FaDpD/U6c=&quot;</span>; <span class="attribute">pin-sha256</span>=<span class="string">&quot;47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-4-Mixed-HTTPS-and-HTTP-Content"><a href="#2-1-4-Mixed-HTTPS-and-HTTP-Content" class="headerlink" title="2.1.4 Mixed HTTPS and HTTP Content"></a>2.1.4 Mixed HTTPS and HTTP Content</h4><p>主站点通过 HTTPS 安全地服务，但是在 HTTP 上加载一些文件（images、js、css）。这是一个巨大的安全漏洞，破坏了 HTTPS 提供的安全性。受影响的站点可能会泄漏会话 cookie 或用户行为信息。它们也可能容易受到注入和其他 MITM 攻击的攻击，而 HTTPS 通常会阻止这种攻击。</p>
<blockquote>
<p>建议<br><br>如果 HTTPS 部署在主站上，请将任何地方的所有内容都 HTTPS 化（全站 HTTPS）。</p>
</blockquote>
<h3 id="2-2-Content-security"><a href="#2-2-Content-security" class="headerlink" title="2.2 Content security"></a>2.2 Content security</h3><h4 id="2-2-1-Content-Security-Policy"><a href="#2-2-1-Content-Security-Policy" class="headerlink" title="2.2.1 Content Security Policy"></a>2.2.1 Content Security Policy</h4><p>为浏览器提供关于网站内容类型和行为的明确说明。良好的内容安全策略（CSP）可以帮助抵御跨站点脚本（XSS）和其他注入攻击等攻击。CSP 支持所有主要的浏览器，尽管只是部分地之前在 IE 11。</p>
<p>一个好的 CSP 是基于白名单的方法，不允许任何东西，除了明确允许的内容。它还限制了 javascript 的来源和允许操作。</p>
<p>CSP 很难启用遗留代码库。为了简化实现，CSP 提供了一个 <code>report-only</code> 模式，在浏览器中，CSP 的违规被发送到一个网站端点，但是该策略没有被强制执行。<br>新项目应该从一开始就使用 CSP。</p>
<blockquote>
<p>建议<br><br>从限制性政策开始，在必要时放松。禁止所有的例子:</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;none&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>现在让我们允许自托管 scripts、images、CSS、fonts 和 AJAX，以及 jQuery CDN 托管脚本和 Google Analytics:</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> <span class="string">&#x27;none&#x27;</span>; <span class="keyword">script-src</span> <span class="string">&#x27;self&#x27;</span> https://code.jquery.com https://www.google-analytics.com; <span class="keyword">img-src</span> <span class="string">&#x27;self&#x27;</span> https://www.google-analytics.com; <span class="keyword">connect-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">font-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">style-src</span> <span class="string">&#x27;self&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>要注意的是，不要让所有的东西都破坏你的网站，例如，如果你使用 <code>child-src</code> 指令，而浏览器不支持它。一个不那么严格的政策可能从以下开始:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>甚至更少的限制性政策甚至可以使用<code> default-src &#39;*&#39;</code>，然后添加限制。我建议你不要这么做，除非你完全明白其中的含义。否则，你可能会依赖 CSP，它只会给你一种错误的安全感。</p>
<h4 id="2-2-2-Frame-Options"><a href="#2-2-2-Frame-Options" class="headerlink" title="2.2.2 Frame Options"></a>2.2.2 Frame Options</h4><p>控制站点是否可以放置在 <code>&lt;iframe&gt;</code>，<code>&lt;frame&gt;</code> 或 <code>&lt;object&gt;</code> 标签。不允许使用框架可以防止 clickjacking 攻击。例如，从 2015 年 2 月起，<a target="_blank" rel="noopener" href="https://thehackernews.com/2015/02/internet-explorer-xss.html">Internet Explorer’s universal cross-site-scripting bug</a> 就被这个消息头减轻了。</p>
<p><code>X-Frame-Options</code> 是一个非标准的 header，在内容安全策略级别 2 中被 frame ancestor 指令所取代。然而，frame ancestor 还没有得到普遍的支持，而 <code>X-Frame-Options</code> 得到了广泛的支持。</p>
<blockquote>
<p>建议<br><br>确定你的网站是否需要被允许呈现在一个 frame 中。完全不允许使用 sameorigin 拒绝或允许同源框架的选项。避免由于受限或 bug 浏览器支持而允许的选项。示例 HTTP 头:</p>
</blockquote>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">X</span><span class="operator">-</span><span class="built_in">Frame</span><span class="operator">-</span><span class="built_in">Options</span><span class="operator">:</span> <span class="variable">deny</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-XSS-Protection"><a href="#2-2-3-XSS-Protection" class="headerlink" title="2.2.3 XSS Protection"></a>2.2.3 XSS Protection</h4><p>跨站点脚本（XSS 或 CSS）的保护被构建到大多数流行的浏览器中，除了 Firefox 之外。这种保护是用户可配置的，可以关闭。因此，明确要求浏览器在你的网站上使用它的 XSS 过滤器是个好主意。</p>
<p>相反，网站可以要求 XSS 保护在页面的基础上被禁用。这绝对不是一个好主意。</p>
<blockquote>
<p>建议<br><br>使用入校 HTTP header:</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Xss-Protection: <span class="number">1</span>; block</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-Cache-Control"><a href="#2-2-4-Cache-Control" class="headerlink" title="2.2.4 Cache Control"></a>2.2.4 Cache Control</h4><p>表示缓存页面输出的首选项。适当的值随网站数据的性质而变化，但强烈推荐使用偏好。否则，它取决于浏览器和代理来选择是否缓存内容。不恰当的选择可能会导致性能问题、安全问题，或者两者都有。</p>
<blockquote>
<p>建议<br><br>开发缓存策略，然后将缓存首选项包括为 HTTP 头。</p>
</blockquote>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Cache</span><span class="params">-Control</span>: <span class="keyword">public</span>*</span><br></pre></td></tr></table></figure>
<p>其中的一个 public，private，no-cache 或 no-store。如果允许缓存，则应该将 max-age 值包含在 Cache-Control 以及 Etag 头文件中，以允许客户端缓存验证。</p>
<h4 id="2-2-5-Content-Type-Options"><a href="#2-2-5-Content-Type-Options" class="headerlink" title="2.2.5 Content Type Options"></a>2.2.5 Content Type Options</h4><p>当浏览器以不同的方式处理来自服务器的文件时，MIME 嗅探就是服务器指令。当一个网站承载不受信任的内容（如用户提供的）时，这是很危险的。假设服务器允许用户上传 image。如果用户上传 HTML 文档，浏览器可能会将其呈现为 web 执行 scriptpage，即使服务器明确表示正在发送 image。非标准的标头 <code>X-Content-Type-Options</code> 选项指示浏览器不做任何模仿指定类型的 MIME。</p>
<blockquote>
<p>建议<br><br>总是设置 header:</p>
</blockquote>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Content-<span class="keyword">Type</span>-<span class="keyword">Options</span>: nosniff</span><br></pre></td></tr></table></figure>
<h4 id="2-2-6-Subresource-Integrity"><a href="#2-2-6-Subresource-Integrity" class="headerlink" title="2.2.6 Subresource Integrity"></a>2.2.6 Subresource Integrity</h4><p>浏览器通常从外部域加载大量资源、javascript 和样式表。内容交付网络经常被使用。如果外部资源被破坏，依赖站点的安全性也可以。子资源完整性允许浏览器验证 javascript 或样式表未被意外修改。</p>
<blockquote>
<p>建议<br><br>设置外部 javascript 和样式表的完整性属性。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js&quot;</span> integrity=<span class="string">&quot;sha384-6ePHh72Rl3hKio4HiJ841psfsRJveeS+aLoaEf3BWfS+gTF0XdAqku2ka8VddikM&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意<br><br>您应该始终提供外部脚本的本地副本，并实现一种方法，以便在外部负载失败的情况下重新加载它们。否则你的网站可能会崩溃。例子:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">window</span>.jQuery || <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script src=&quot;/jquery.min.js&quot;&gt;&lt;\/script&gt;&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-7-Iframe-Sandbox"><a href="#2-2-7-Iframe-Sandbox" class="headerlink" title="2.2.7 Iframe Sandbox"></a>2.2.7 Iframe Sandbox</h4><p>iframe 在 WWW 上随处可见。网站平均有 5.1 iframe，主要用于装载第三方内容。这些 iframe 有很多方法来伤害托管网站，包括运行脚本和插件和重新引导访问者。sandbox 属性允许对 iframe 中可以进行的操作进行限制。</p>
<blockquote>
<p>建议<br><br>设置 iframe 的 sandbox 属性，然后添加所需的权限。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">&quot;https://example.com&quot;</span> sandbox=<span class="string">&quot;allow-same-origin allow-scripts&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-8-Server-Clock"><a href="#2-2-8-Server-Clock" class="headerlink" title="2.2.8 Server Clock"></a>2.2.8 Server Clock</h4><p>服务器包括所有响应的时间戳。不准确的时钟不会给客户机浏览器带来问题。然而，当与其他系统或服务交互时，问题就会出现。</p>
<blockquote>
<p>建议<br><br>使用网络时间协议（NTP）来保持服务器时钟的准确性。</p>
</blockquote>
<h3 id="2-3-Information-disclosure"><a href="#2-3-Information-disclosure" class="headerlink" title="2.3 Information disclosure"></a>2.3 Information disclosure</h3><h4 id="2-3-1-Server-Banner"><a href="#2-3-1-Server-Banner" class="headerlink" title="2.3.1 Server Banner"></a>2.3.1 Server Banner</h4><p>大多数 web 服务器设置报头来识别自己和他们的版本号。这只服务于信息目的和实际用途是非常有限的。去掉整个头，而完全可以接受，通常是不必要的。但是，建议从头中删除版本号。在特定 web 服务器版本中存在 bug 的情况下，包括版本号可以作为对脚本 kiddy 的邀请来尝试对服务器的攻击。</p>
<blockquote>
<p>建议<br><br>包含服务器名称但去掉版本号；</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Server</span>: nginx</span><br></pre></td></tr></table></figure>
<h4 id="2-3-2-Web-Framework-Information"><a href="#2-3-2-Web-Framework-Information" class="headerlink" title="2.3.2 Web Framework Information"></a>2.3.2 Web Framework Information</h4><p>许多 web 框架设置 HTTP 头，识别框架或版本号。除了满足用户的好奇心，而且主要作为技术堆栈的广告，这几乎没有什么作用。这些头是不标准的，对浏览器渲染站点的方式没有影响。</p>
<p>虽然它们没有什么实际用途，但对于搜索运行过时版本的软件的机器人或蜘蛛来说，这些标头是无价的，因为这些软件可能包含安全漏洞。如果没有定期更新，这些头文件可以使网站的目标变得容易。</p>
<blockquote>
<p>建议<br><br>从服务器响应中删除这些标头: <code>X-Powered-By</code>, <code>X-Runtime</code>, <code>X-Version</code> 和 <code>X-AspNet-Version</code>。</p>
</blockquote>
<h3 id="2-4-Cookies"><a href="#2-4-Cookies" class="headerlink" title="2.4 Cookies"></a>2.4 Cookies</h3><h4 id="2-4-1-Cookie-Security"><a href="#2-4-1-Cookie-Security" class="headerlink" title="2.4.1 Cookie Security"></a>2.4.1 Cookie Security</h4><p>包含敏感信息的 cookie，特别是会话 id，需要标记为安全的，假设网站是通过 HTTPS 传输的。这会阻止 cookie 通过 HTTP 发送明文文本。另一种方法是通过 HSTS 来阻止非安全 cookie 在 HTTP 上传输。建议使用安全 cookie 和 HSTS。</p>
<p>会话 cookie 应该与 HttpOnly 值进行标记，以防止它们被 javascript 访问。这可以防止攻击者利用 XSS 窃取会话 cookie。其他 cookie 可能不需要这样标记。但是，除非有明确的需要从 javascript 中访问他们的值，否则最好还是呆在安全的一边，把所有cookie标记为 HttpOnly</p>
<blockquote>
<p>建议<br><br>标记所有 cookie 安全和 HttpOnly。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: <span class="attribute">Key</span>=Value; <span class="attribute">path</span>=/; secure; HttpOnly, <span class="attribute">Key2</span>=Value2; secure; HttpOnly</span><br></pre></td></tr></table></figure>
<h2 id="0x03-服务器软件安全"><a href="#0x03-服务器软件安全" class="headerlink" title="0x03 服务器软件安全"></a>0x03 服务器软件安全</h2><p>我们在最佳实践文章中建议大家如何去配置协议和密码套件，但是如果服务器软件（nginx、apache等）所使用的ssl协议库存在SSL漏洞，或者不支持那些现代化的密码套件和特性，那么无论你如何去修改配置都无法改善现在的安全问题。</p>
<p>所以我们在配置前，或者发现按照推荐配置进行了调整《<a target="_blank" rel="noopener" href="https://myssl.com/">SSL/TLS安全评估报告</a>》还是无法满足要求，那么可以检查下所使用的OpenSSL等加密库是否版本过低。</p>
<h3 id="3-1-如何检查OpenSSL版本"><a href="#3-1-如何检查OpenSSL版本" class="headerlink" title="3.1 如何检查OpenSSL版本"></a>3.1 如何检查OpenSSL版本</h3><h4 id="3-1-1-nginx"><a href="#3-1-1-nginx" class="headerlink" title="3.1.1 nginx"></a>3.1.1 nginx</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nginx</span> -V</span><br><span class="line"></span><br><span class="line"><span class="attribute">nginx</span> version: nginx/<span class="number">1</span>.<span class="number">10</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">built</span> by gcc <span class="number">4</span>.<span class="number">8</span>.<span class="number">5</span> <span class="number">20150623</span> (Red Hat <span class="number">4</span>.<span class="number">8</span>.<span class="number">5</span>-<span class="number">4</span>) (GCC)</span><br><span class="line"><span class="attribute">built</span> with OpenSSL <span class="number">1</span>.<span class="number">0</span>.<span class="number">1</span>e-fips <span class="number">11</span> Feb <span class="number">2013</span></span><br><span class="line"><span class="attribute">TLS</span> SNI support enabled</span><br></pre></td></tr></table></figure>
<p>或者通过openssl命令查看(适用于非自己通过openssl源码编译的）</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl <span class="built_in">version</span></span><br></pre></td></tr></table></figure>
<p>推荐的OpenSSL版本</p>
<ol>
<li>OpenSSL 1.0.2用户需更新到1.0.2h 以上。</li>
<li>OpenSSL 1.0.1用户需更新到1.0.1t 以上。</li>
<li>OpenSSL官方已停止对 0.9.8和 1.0.0 两个版本的升级维护，请使用这两个版本的用户将其升级至1.0.2h版本以上。</li>
</ol>
<blockquote>
<p>OpenSSL 1.0.1以下不支持tls1.2<br><br>升级前请做好测试</p>
</blockquote>
<h3 id="3-2-漏洞事件"><a href="#3-2-漏洞事件" class="headerlink" title="3.2 漏洞事件"></a>3.2 漏洞事件</h3><p><a target="_blank" rel="noopener" href="https://www.trustasia.com/openssl-heartbleed">https://www.trustasia.com/openssl-heartbleed</a></p>
<ul>
<li>OpenSSL 1.0.1g 已修复该漏洞</li>
<li>OpenSSL 1.0.0 分支版本不受此漏洞影响</li>
<li>OpenSSL 0.9.8 分支版本不受此漏洞影响</li>
<li>OpenSSL 1.0.2 Beta2 不受此漏洞影响<br><a target="_blank" rel="noopener" href="https://myssl.com/heartbleed.html">Heartbleed检测工具(使用多个工具测试，防止误报)</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.trustasia.com/OpenSSL-DROWN-attack">https://www.trustasia.com/OpenSSL-DROWN-attack</a></p>
<ul>
<li>OpenSSL 1.0.1h+</li>
<li>OpenSSL 1.0.0m+</li>
<li>OpenSSL 0.9.8za+</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.trustasia.com/OpenSSL-CVE-2016-2107-Padding-Oracle">https://www.trustasia.com/OpenSSL-CVE-2016-2107-Padding-Oracle</a></p>
<ul>
<li>OpenSSL 1.0.2用户需更新到1.0.2h 。</li>
<li>OpenSSL 1.0.1用户需更新到1.0.1t 。</li>
<li>使用包管理系统的用户可以直接更新到2016年5月3日 之后的版本。<br><a target="_blank" rel="noopener" href="https://myssl.com/cbc_oracle.html">CBC padding oracle检测 检测工具&gt;&gt;</a></li>
</ul>
<p>OpenSSL CCS漏洞<br><br>此漏洞是 OpenSSL ChangeCipherSpec 设计缺陷造成，被称为 CCS 注入漏洞。<br><br><a target="_blank" rel="noopener" href="https://www.trustasia.com/openssl-ccs">https://www.trustasia.com/openssl-ccs</a></p>
<ul>
<li>OpenSSL 1.1.0 应升级到 1.1.0a 或更高版本。</li>
<li>OpenSSL 1.0.2 应升级到 1.0.2i 或更高版本。</li>
<li>OpenSSL 1.0.1 应升级到 1.0.1u 或更高版本。<br><a target="_blank" rel="noopener" href="https://myssl.com/ccs.html">OpenSSL CCS 检测工具&gt;&gt;</a></li>
</ul>
<blockquote>
<p>注意：<br><br>OpenSSL官方已停止对 0.9.8和 1.0.0 两个版本的升级维护，请使用这两个版本的用户将其升级至更高版本。</p>
</blockquote>
-->
      

    </div>


    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>


    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.online/2018/12/12/https-sec-deploy/" data-id="ckroigi8500apjgsw54necp8d" class="article-share-link" data-share="baidu" data-title="HTTPS 安全最佳实践（转发）">分享到</a>
      

      
        <a href="http://www.pa55w0rd.online/2018/12/12/https-sec-deploy/#gitalk-container" class="article-comment-link">留言</a>
      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web%E5%AE%89%E5%85%A8/" rel="tag">web安全</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/05/encrypt-test/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">← 上一篇</strong>
      <div class="article-nav-title">encrypt_test</div>
    </a>
  
  
    <a href="/2018/12/13/burp/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇 →</strong>
      <div class="article-nav-title">
        
          Burp Suite使用中的一些技巧
        
      </div>
    </a>
  
</nav>


  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->


  <section class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section> 




  <script type="text/javascript">document.write(unescape("%3Cdiv id='reward' %3E%3C/div%3E%3Cscript src='/js/reward.min.js' type='text/javascript'%3E%3C/script%3E"));</script>
  <div id="gitalk-container"></div>


</section>
      
      <aside   id="sidebar">
  
    
  <div class="widget-wrap">

    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-file-text-o"></i>近期文章</h3>
    <div class="widget">
      <ul>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/2021/07/15/oss/">阿里云OSS Bucket 劫持</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/2021/06/04/awvs-vul/">AWVS漏洞复现小记</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/2021/05/14/iast/">洞态IAST落地实践</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/2021/05/14/netsparker-iast/">Netsparker扫描器IAST使用</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/2021/05/14/awvs-iast/">AWVS扫描器IAST使用</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s" ><i class="fa fa-tasks"></i>分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web%E5%AE%89%E5%85%A8/">web安全</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%BE/">安全建设</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%AE%89%E5%85%A8/">开发安全</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/">移动安全</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  <script>
  $(document).on("click", "ul.category-list li.category-list-item", function () {
    window.location.href = $(this).find('a').attr('href')
  })
  </script>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s" ><i class="fa fa-cloud"></i>标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 11.43px;">Android</a> <a href="/tags/Android-%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">Android - 安全测试 - 工具使用</a> <a href="/tags/DevSecOps/" style="font-size: 10px;">DevSecOps</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/PHPstudy/" style="font-size: 10px;">PHPstudy</a> <a href="/tags/SDL/" style="font-size: 17.14px;">SDL</a> <a href="/tags/TRS/" style="font-size: 10px;">TRS</a> <a href="/tags/algolia/" style="font-size: 10px;">algolia</a> <a href="/tags/checklist/" style="font-size: 11.43px;">checklist</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/hexo/" style="font-size: 12.86px;">hexo</a> <a href="/tags/iso27001/" style="font-size: 10px;">iso27001</a> <a href="/tags/jsonp%E5%8A%AB%E6%8C%81/" style="font-size: 10px;">jsonp劫持</a> <a href="/tags/linux/" style="font-size: 11.43px;">linux</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/note/" style="font-size: 20px;">note</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">sql注入</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 12.86px;">web安全</a> <a href="/tags/windows-%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">windows 审计工具</a> <a href="/tags/xunfeng/" style="font-size: 10px;">xunfeng</a> <a href="/tags/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" style="font-size: 10px;">业务安全</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 10px;">代码审计</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/" style="font-size: 10px;">代码扫描</a> <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 10px;">信息收集</a> <a href="/tags/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" style="font-size: 10px;">内网安全</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%88%86%E6%9E%90/" style="font-size: 10px;">分析</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/" style="font-size: 10px;">前端加密</a> <a href="/tags/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/" style="font-size: 10px;">名词解释</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 11.43px;">基础</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 14.29px;">基础知识</a> <a href="/tags/%E5%9F%BA%E7%BA%BF%E5%8A%A0%E5%9B%BA/" style="font-size: 10px;">基线加固</a> <a href="/tags/%E5%A4%87%E5%BF%98%E5%BD%95/" style="font-size: 10px;">备忘录</a> <a href="/tags/%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%BE/" style="font-size: 18.57px;">安全建设</a> <a href="/tags/%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">安全架构</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%A7%84%E5%88%92/" style="font-size: 10px;">安全规划</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%A7%84%E8%8C%83/" style="font-size: 12.86px;">安全规范</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 15.71px;">安全设计</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1%E8%AF%84%E5%AE%A1/" style="font-size: 10px;">安全设计评审</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%AF%84%E4%BC%B0/" style="font-size: 10px;">安全评估</a> <a href="/tags/%E5%AE%89%E5%85%A8%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">安全运维</a> <a href="/tags/%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4/" style="font-size: 12.86px;">安全防护</a> <a href="/tags/%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" style="font-size: 11.43px;">安装使用</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 18.57px;">工具使用</a> <a href="/tags/%E5%B9%B3%E5%8F%B0%E5%BB%BA%E8%AE%BE/" style="font-size: 11.43px;">平台建设</a> <a href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" style="font-size: 12.86px;">应急响应</a> <a href="/tags/%E5%BC%80%E5%8F%91%E5%AE%89%E5%85%A8/" style="font-size: 14.29px;">开发安全</a> <a href="/tags/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">开源工具</a> <a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 11.43px;">技巧</a> <a href="/tags/%E6%8C%87%E5%8D%97/" style="font-size: 10px;">指南</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">操作记录</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8/" style="font-size: 10px;">数据安全</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" style="font-size: 10px;">未授权访问</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" style="font-size: 12.86px;">漏洞利用</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E7%AE%A1%E7%90%86/" style="font-size: 10px;">漏洞管理</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/" style="font-size: 10px;">移动安全</a> <a href="/tags/%E7%AD%89%E7%BA%A7%E4%BF%9D%E6%8A%A4/" style="font-size: 10px;">等级保护</a> <a href="/tags/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/" style="font-size: 10px;">红蓝对抗</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">编程基础</a> <a href="/tags/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" style="font-size: 18.57px;">解决方法</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E8%B5%84%E4%BA%A7%E6%89%AB%E6%8F%8F/" style="font-size: 10px;">资产扫描</a> <a href="/tags/%E8%BF%81%E7%A7%BB/" style="font-size: 10px;">迁移</a> <a href="/tags/%E9%80%9F%E6%9F%A5%E8%A1%A8/" style="font-size: 10px;">速查表</a> <a href="/tags/%E9%9D%9Eweb%E5%9E%8Bxss/" style="font-size: 10px;">非web型xss</a> <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8/" style="font-size: 10px;">验证码安全</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s" ><i class="fa fa-archive"></i>归档</h3>
    <div class="widget">
      <!-- <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">15</span></li></ul> -->
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">2021年07月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">2021年06月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">2021年05月</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">2019年11月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">2019年10月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">2019年09月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">2019年08月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019年07月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">2019年06月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">2019年05月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">2019年04月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019年03月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">2019年01月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">2018年12月</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">2018年11月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018年10月</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018年09月</a><span class="archive-list-count">15</span></li></ul>
    </div>
  </div>


<script>
$(document).on("click", "ul.archive-list li.archive-list-item", function () {
  window.location.href = $(this).find('a').attr('href')
})
</script>

  
    
  <style>
  *{ margin: 0; padding: 0;}
  .tooltips{ border-width: 1px; border-style: solid; position: absolute; display: none; border-radius: 3px; opacity: 0; filter:alpha( opacity = 0) ; z-index: 999;}
  .tooltips p.content{ padding: 5px; }
  .tooltips .triangle-front,.tooltips .triangle-back{ width: 0; height: 0; overflow: hidden; border-width: 8px; border-style: solid; position: absolute; border-color: transparent ; top: 100%; left: 50%; margin-left: -8px;}
  .tooltips .triangle-back{ margin-top: -1px;}

  .toolTipInfo{ border-color: #000; background-color: #EEEEEE;}
  .toolTipInfo .triangle-front{ border-top-color: #EEEEEE;}
  .toolTipInfo .triangle-back{ border-top-color: #EEEEEE;}


  .icoSize{font-size: 2em}
  </style>



  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s" ><i class="fa fa-link"></i>链接</h3>
    <div class="widget" style="z-index: 1;">





      <!-- <ul> -->
        
          <!-- <li> -->
          

          

                  <a id="github-alt-icon-color" class="weight-icon-link" target="_blank"  href="https://github.com/Pa55w0rd">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          
            <a id="weixin-icon-color" class="weight-icon-link"  href="javascript:;"   id="weixin-icon" target="_blank" tooltips="<img src='/img/weixin.png'>">
                <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-weixin  fa-stack-1x fa-inverse"></i>
                  </span>
              </a>
          

          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          
            <a id="qq-icon-color" class="weight-icon-link"  href="javascript:;"   id="qq-icon" target="_blank" tooltips="<img src='/img/qq.png'>">
                <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-qq  fa-stack-1x fa-inverse"></i>
                  </span>
              </a>
          

          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          

          

          

          

          

          

          

          


          
                  <a id="envelope-o-icon-color" class="weight-icon-link" target="_blank"  href="mailto:pa55w0rd@aliyun.com" data-toggle="tooltip" data-placement="top" title="请多多交流！">
                  <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o  fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          


          <!-- </li> -->
        
      <!-- </ul> -->
    </div>
  </div>


  <script>
  $.fn.extend({
    hoverTips : function (){
      var self = $(this);
      var sw = self.get(0).switch;
      if( !sw ) {
        sw = true;
        var content = self.attr("tooltips");
        var htmlDom = $("<div class='tooltips'>")
            .addClass("toolTipInfo")
            .html("<p class='content'></p>"
                + "<p class='triangle-front'></p>"
                + "<p class='triangle-back'></p>");
        htmlDom.find("p.content").html( content );
      }
      self.on("mouseover",function(){
        $("body").append( htmlDom );
        var left = self.offset().left - htmlDom.outerWidth()/2 + self.outerWidth()/2;
        var top = self.offset().top - htmlDom.outerHeight() - parseInt(htmlDom.find(".triangle-front").css("border-width"));
        htmlDom.css({"left":left,"top":top - 10,"display":"block"});
        htmlDom.stop().animate({ "top" : top ,"opacity" : 1},300);
      });
      self.on("mouseout",function(){
        var top = parseInt(htmlDom.css("top"));
        htmlDom.stop().animate({ "top" : top - 10 ,"opacity" : 0},300,function(){
          htmlDom.remove();
          sw = false;
        });
      });
    },

  });

  $("#weixin-icon-color").hoverTips();
  $("#qq-icon-color").hoverTips();
  </script>



  
    
    <div class="widget-wrap">
  
      <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-group"></i>友情链接『不分先后』</h3>
      <div class="widget">
        <ul>
        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="https://firexun.github.io"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>青衫磊落</a>
            </li>

        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="http://www.weiho.xyz"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>Weiho</a>
            </li>

        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="http://pirogue.org"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>pirogue</a>
            </li>

        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="http://www.mianhuage.com"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>Cotton&#39;s Blog</a>
            </li>

        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="https://www.lovesec.com"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>超级菜鸟</a>
            </li>

        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" target="_blank" rel="noopener" href="https://my.oschina.net/9199771"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>超级大熊猫</a>
            </li>

        
        </ul>
      </div>
    </div>
  
  
  
</aside>

      
    </div>
    <footer  id="footer">
  
  <div  data-scroll-reveal="enter bottom"  class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Pa55w0rd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/HipHopCoderS/Landscape-x" target="_blank">Landscape-x</a>
    </div>

    <div id="footer-info" class="inner">
      <!-- id 将作为查询条件 
      <span id="<Your/Path/Name>" class="leancloud-visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">阅读量 </em>
        <i class="leancloud-visitors-count">1000000</i>
      </span>
-->
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <div class="powered-by">
        <i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
        我的网站的访问总数:<span id="busuanzi_value_site_pv"></span>次
        </span>
      </div>

      
    </div>
  </div>

</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
  
    <a href="/archives" class="mobile-nav-link"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
  
    <a href="/about" class="mobile-nav-link"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
  
    <a href="/comments" class="mobile-nav-link"><i class="fa fa-comments" aria-hidden="true"></i>留言</a>
  
    <a href="/404.html" class="mobile-nav-link"><i class="fa fa-heart" aria-hidden="true"></i>公益404</a>
  
</nav>

  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/betop.png"/></a>
</div>

<!-- totop end -->



  <script>
    const gitalk = new Gitalk({
      clientID: "992fba235eb173826494",
      clientSecret: "d133f6427763be2cf4048e4d146a22043e745f22",
      repo: "pa55w0rd.github.io",
      owner: "Pa55w0rd",
      admin: "Pa55w0rd",
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: "Wed Dec 12 2018 18:39:23 GMT+0800",      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
  </script>




<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>


<!-- 百度分享 end -->

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="https://cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<script src="/js/script.js"></script>



</div>
</body>
</html>



<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>


<script>
$(document).ready(function(){
window.scrollReveal = new scrollReveal({ reset: true});
//
})
</script>
